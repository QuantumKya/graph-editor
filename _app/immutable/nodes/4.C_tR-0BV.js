import"../chunks/CWj6FrbW.js";import{o as B}from"../chunks/DsjGDbIo.js";import{p as V,k as R,l as Z,f as q,a as H,c as K,s as m,t as Y,b as Q,n as X,d as _,g as n,r as oo}from"../chunks/BeWt66ZE.js";import{d as eo,e as to}from"../chunks/9tEt_Nny.js";import{V as j,s as ao,C as no,g as O,a as v,c as so,b as ro}from"../chunks/D3AxRAeF.js";import{b as P}from"../chunks/D_Y7g2-O.js";const lo=(g,h)=>{_(h,!1)};var io=g=>g.preventDefault(),co=q('<canvas tabindex="0"></canvas> <div class="absolute right-2.5 bottom-2.5"><button class="bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700" aria-label="Save Image">Save Image</button> <button class="bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700" aria-label="Save Graph">Save Graph</button> <button class="bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700" aria-label="Load Graph">Load Graph</button> <input type="file" accept=".json"/></div> <!>',1);function bo(g,h){V(h,!0);let l,d=new j(0,0),i=1;const G=.5,N=2;let p=R(!1),y,x,s=R(Z({nodes:[{id:0,name:"Node",image:"",position:[200,300]}],links:[]})),u=[];const k=()=>{const o=l.getContext("2d");if(o===null)throw new Error("DRAW LOOP - ctx is null");l.width=window.innerWidth,l.height=window.innerHeight,o.clearRect(0,0,l.width,l.height),o.setTransform(i,0,0,i,-d.x,-d.y),n(s).links.forEach(e=>{o.beginPath();const a=n(s).nodes.find(r=>r.id===e.from)??n(s).nodes[0],t=n(s).nodes.find(r=>r.id===e.to)??n(s).nodes[0];o.moveTo(a.position[0],a.position[1]),o.lineTo(t.position[0],t.position[1]),o.lineWidth=10,o.strokeStyle="black",o.stroke()}),n(s).nodes.forEach((e,a)=>{const t=j.fromArray(e.position),r=25;o.beginPath(),o.arc(t.x,t.y,20,0,Math.PI*2),o.fillStyle="black",o.fill(),e.image!==""&&o.drawImage(u[a],t.x-r/2,t.y-r/2,r,r)}),requestAnimationFrame(k)},C=o=>{O(o,l,d,i),o.button===0&&(_(p,!0),y=v(o,l),x=d.clone())},T=o=>{if(O(o,l,d,i),n(p)){const a=v(o,l).clone().subtract(y);d=x.clone().subtract(a)}},U=o=>{o.preventDefault();const e=v(o,l),a=e.clone().add(d).divideScalar(i),t=Math.sign(o.deltaY);i-=t*.125,i=Math.max(G,Math.min(N,i)),d=a.clone().multiplyScalar(i).subtract(e)},W=o=>{o.ctrlKey&&(o.key==="o"&&(o.preventDefault(),f.click()),o.key==="s"&&(o.preventDefault(),S()))},A=()=>{if(u.length!==n(s).nodes.length){for(;u.length<n(s).nodes.length;)u.push(new Image);for(;u.length>n(s).nodes.length;)u.pop()}n(s).nodes.forEach((o,e)=>{u[e].src=o.image})},$=o=>{const e=o.target;if(!e.files||e.files.length===0)return;const a=e.files[0],t=new FileReader;t.onload=()=>{if(typeof t.result=="string")try{const r=JSON.parse(t.result);if(!r.nodes||!r.links)throw new Error("Invalid graph data");_(s,so(r),!0),J(),A()}catch(r){alert("Failed to load graph: "+r.message)}console.log(n(s))},t.readAsText(a)},S=()=>{if(window.confirm("Download new JSON?")){const o=JSON.stringify(n(s),null,4),e=new Blob([o],{type:"application/json"}),a=URL.createObjectURL(e),t=document.createElement("a");t.href=a,t.download="graph.json",t.click(),URL.revokeObjectURL(a)}},F=()=>{if(window.confirm("Download image? It will look as your canvas does now.")){const o=document.createElement("a");o.href=l.toDataURL("image/png"),o.download="graph.png",o.click()}},J=()=>{const o=new Map(n(s).nodes.map((e,a)=>[e.id,a]));n(s).nodes.forEach((e,a)=>e.id=a),n(s).links.forEach(e=>{console.log(`${e.from}, ${e.to}`),e.from=o.get(e.from)??e.from,e.to=o.get(e.to)??e.to,console.log(`${e.from}, ${e.to}`)})};let f;B(()=>{k()});var D=co(),c=H(D);let M;c.__mousemove=T,c.__mousedown=C,c.__mouseup=[lo,p],c.__keydown=W,c.__contextmenu=[io],P(c,o=>l=o,()=>l);var b=m(c,2),E=K(b);E.__click=F;var I=m(E,2);I.__click=S;var L=m(I,2);L.__click=o=>f.click();var w=m(L,2);w.__change=$,ao(w,"",{},{display:"none"}),P(w,o=>f=o,()=>f),oo(b);var z=m(b,2);no(z,{mode:-1,controls:{"Left Click and Drag":"move viewport","Scroll Wheel":"zoom in and out"}}),Y(o=>M=ro(c,1,"bg-neutral-100 w-full h-full",null,M,o),[()=>({"cursor-grabbing":n(p)})]),to("wheel",c,U),Q(g,D),X()}eo(["mousemove","mousedown","mouseup","keydown","contextmenu","click","change"]);export{bo as component};
