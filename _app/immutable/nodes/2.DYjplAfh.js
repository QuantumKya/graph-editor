import"../chunks/CWj6FrbW.js";import"../chunks/D7cazMEl.js";import{a as Vt,l as Wt,d as ot,o as vt,c as Gt,e as Jt}from"../chunks/B3yv-37r.js";import{a4 as Kt,b as Zt,s as ut,h as I,W as Qt,a as te,A as a,ak as ee,r as ne,c as re,d as wt,f as dt,j as et,X as oe,_ as ie,g as Xt,i as Lt,p as ae,aw as ft,a2 as zt,P as At,ax as se,as as le,ay as Mt,az as ue,aA as de,a1 as fe,aB as ce,aC as he,aD as pe,aE as ye,Y as ge,T as ve,aF as xe,aG as me,aH as be,aI as _e,aJ as we,aK as Ae,u as Me,l as ke,D as it,at as z,al as tt,F as $,J as W,L as X,am as E,K as F,G as nt,au as Ee,t as H,I as at,x as Ct,aL as kt}from"../chunks/BDwwFv7O.js";import{b as Q,i as Ot}from"../chunks/BMHNcDe1.js";import{b as Pt}from"../chunks/Bk5xgCDy.js";function Se(n,r){return r}function De(n,r,e,o){for(var i=[],s=r.length,f=0;f<s;f++)de(r[f].e,i,!0);var t=s>0&&i.length===0&&e!==null;if(t){var u=e.parentNode;fe(u),u.append(e),o.clear(),B(n,r[0].prev,r[s-1].next)}ce(i,()=>{for(var p=0;p<s;p++){var h=r[p];t||(o.delete(h.k),B(n,h.prev,h.next)),he(h.e,!t)}})}function Ne(n,r,e,o,i,s=null){var f=n,t={flags:r,items:new Map,first:null};{var u=n;f=I?ut(Qt(u)):u.appendChild(Kt())}I&&te();var p=null,h=!1,_=ee(()=>{var l=e();return ve(l)?l:l==null?[]:zt(l)});Zt(()=>{var l=a(_),m=l.length;if(h&&m===0)return;h=m===0;let y=!1;if(I){var M=ne(f)===re;M!==(m===0)&&(f=wt(),ut(f),dt(!1),y=!0)}if(I){for(var x=null,v,w=0;w<m;w++){if(et.nodeType===oe&&et.data===ie){f=et,y=!0,dt(!1);break}var Y=l[w],N=o(Y,w);v=Rt(et,t,x,null,Y,N,w,i,r,e),t.items.set(N,v),x=v}m>0&&ut(wt())}I||Te(l,t,f,i,r,o,e),s!==null&&(m===0?p?Xt(p):p=Lt(()=>s(f)):p!==null&&ae(p,()=>{p=null})),y&&dt(!0),a(_)}),I&&(f=et)}function Te(n,r,e,o,i,s,f){var t=n.length,u=r.items,p=r.first,h=p,_,l=null,m=[],y=[],M,x,v,w;for(w=0;w<t;w+=1){if(M=n[w],x=s(M,w),v=u.get(x),v===void 0){var Y=h?h.e.nodes_start:e;l=Rt(Y,r,l,l===null?r.first:l.next,M,x,w,o,i,f),u.set(x,l),m=[],y=[],h=l.next;continue}if(Ie(v,M,w),(v.e.f&ft)!==0&&Xt(v.e),v!==h){if(_!==void 0&&_.has(v)){if(m.length<y.length){var N=y[0],D;l=N.prev;var k=m[0],O=m[m.length-1];for(D=0;D<m.length;D+=1)Et(m[D],N,e);for(D=0;D<y.length;D+=1)_.delete(y[D]);B(r,k.prev,O.next),B(r,l,k),B(r,O,N),h=N,l=O,w-=1,m=[],y=[]}else _.delete(v),Et(v,h,e),B(r,v.prev,v.next),B(r,v,l===null?r.first:l.next),B(r,l,v),l=v;continue}for(m=[],y=[];h!==null&&h.k!==x;)(h.e.f&ft)===0&&(_??(_=new Set)).add(h),y.push(h),h=h.next;if(h===null)continue;v=h}m.push(v),l=v,h=v.next}if(h!==null||_!==void 0){for(var P=_===void 0?[]:zt(_);h!==null;)(h.e.f&ft)===0&&P.push(h),h=h.next;var j=P.length;if(j>0){var G=t===0?e:null;De(r,P,G,u)}}At.first=r.first&&r.first.e,At.last=l&&l.e}function Ie(n,r,e,o){se(n.v,r),n.i=e}function Rt(n,r,e,o,i,s,f,t,u,p){var h=(u&pe)!==0,_=(u&ye)===0,l=h?_?le(i,!1,!1):Mt(i):i,m=(u&ue)===0?f:Mt(f),y={i:m,v:l,k:s,a:null,e:null,prev:e,next:o};try{return y.e=Lt(()=>t(n,l,m,p),I),y.e.prev=e&&e.e,y.e.next=o&&o.e,e===null?r.first=y:(e.next=y,e.e.next=y.e),o!==null&&(o.prev=y,o.e.prev=y.e),y}finally{}}function Et(n,r,e){for(var o=n.next?n.next.e.nodes_start:e,i=r?r.e.nodes_start:e,s=n.e.nodes_start;s!==o;){var f=ge(s);i.before(s),s=f}}function B(n,r,e){r===null?n.first=e:(r.next=e,r.e.next=e&&e.e),e!==null&&(e.prev=r,e.e.prev=r&&r.e)}function Ut(n){var r,e,o="";if(typeof n=="string"||typeof n=="number")o+=n;else if(typeof n=="object")if(Array.isArray(n)){var i=n.length;for(r=0;r<i;r++)n[r]&&(e=Ut(n[r]))&&(o&&(o+=" "),o+=e)}else for(e in n)n[e]&&(o&&(o+=" "),o+=e);return o}function Ye(){for(var n,r,e=0,o="",i=arguments.length;e<i;e++)(n=arguments[e])&&(r=Ut(n))&&(o&&(o+=" "),o+=r);return o}function Xe(n){return typeof n=="object"?Ye(n):n??""}const St=[...` 	
\r\fÂ \v\uFEFF`];function Le(n,r,e){var o=n==null?"":""+n;if(r&&(o=o?o+" "+r:r),e){for(var i in e)if(e[i])o=o?o+" "+i:i;else if(o.length)for(var s=i.length,f=0;(f=o.indexOf(i,f))>=0;){var t=f+s;(f===0||St.includes(o[f-1]))&&(t===o.length||St.includes(o[t]))?o=(f===0?"":o.substring(0,f))+o.substring(t+1):f=t}}return o===""?null:o}function Dt(n,r=!1){var e=r?" !important;":";",o="";for(var i in n){var s=n[i];s!=null&&s!==""&&(o+=" "+i+": "+s+e)}return o}function ze(n,r){if(r){var e="",o,i;return Array.isArray(r)?(o=r[0],i=r[1]):o=r,o&&(e+=Dt(o)),i&&(e+=Dt(i,!0)),e=e.trim(),e===""?null:e}return String(n)}function C(n,r,e,o,i,s){var f=n.__className;if(I||f!==e||f===void 0){var t=Le(e,o,s);(!I||t!==n.getAttribute("class"))&&(t==null?n.removeAttribute("class"):n.className=t),n.__className=e}else if(s&&i!==s)for(var u in s){var p=!!s[u];(i==null||p!==!!i[u])&&n.classList.toggle(u,p)}return s}function ct(n,r={},e,o){for(var i in e){var s=e[i];r[i]!==s&&(e[i]==null?n.style.removeProperty(i):n.style.setProperty(i,s,o))}}function Ce(n,r,e,o){var i=n.__style;if(I||i!==r){var s=ze(r,o);(!I||s!==n.getAttribute("style"))&&(s==null?n.removeAttribute("style"):n.style.cssText=s),n.__style=r}else o&&(Array.isArray(o)?(ct(n,e==null?void 0:e[0],o[0]),ct(n,e==null?void 0:e[1],o[1],"important")):ct(n,e,o));return o}const Oe=Symbol("is custom element"),Pe=Symbol("is html");function Nt(n){if(I){var r=!1,e=()=>{if(!r){if(r=!0,n.hasAttribute("value")){var o=n.value;V(n,"value",null),n.value=o}if(n.hasAttribute("checked")){var i=n.checked;V(n,"checked",null),n.checked=i}}};n.__on_r=e,_e(e),Vt()}}function V(n,r,e,o){var i=Re(n);I&&(i[r]=n.getAttribute(r),r==="src"||r==="srcset"||r==="href"&&n.nodeName==="LINK")||i[r]!==(i[r]=e)&&(r==="loading"&&(n[xe]=e),e==null?n.removeAttribute(r):typeof e!="string"&&Ue(n).includes(r)?n[r]=e:n.setAttribute(r,e))}function Re(n){return n.__attributes??(n.__attributes={[Oe]:n.nodeName.includes("-"),[Pe]:n.namespaceURI===me})}var Tt=new Map;function Ue(n){var r=Tt.get(n.nodeName);if(r)return r;Tt.set(n.nodeName,r=[]);for(var e,o=n,i=Element.prototype;i!==o;){e=we(o);for(var s in e)e[s].set&&r.push(s);o=be(o)}return r}function It(n,r,e=r){var o=Ae();Wt(n,"input",i=>{var s=i?n.defaultValue:n.value;if(s=ht(n)?pt(s):s,e(s),o&&s!==(s=r())){var f=n.selectionStart,t=n.selectionEnd;n.value=s??"",t!==null&&(n.selectionStart=f,n.selectionEnd=Math.min(t,n.value.length))}}),(I&&n.defaultValue!==n.value||Me(r)==null&&n.value)&&e(ht(n)?pt(n.value):n.value),ke(()=>{var i=r();ht(n)&&i===pt(n.value)||n.type==="date"&&!i&&!n.value||i!==n.value&&(n.value=i??"")})}function ht(n){var r=n.type;return r==="number"||r==="range"}function pt(n){return n===""?null:+n}var qe=$('<img alt="Uploaded Icon" class="rounded-lg w-[300px]"/>'),Be=$('<img alt="Uploaded Icon" class="rounded-lg w-[300px]"/>'),He=$('<div class="flex flex-col gap-3.5 max-w-[350px] h-fit bg-neutral-950 text-white p-2.5 rounded-xl"><input type="text" placeholder="Node Title"/> <button>Upload Image</button> <input type="file" accept="image/*"/> <!> <input type="text" placeholder="Link Addend"/> <a class="underline">Wikipedia</a> <div class="relative inline-block h-fit"><button>Save</button> <button>Exit</button></div></div>');function Fe(n,r){it(r,!0);const e=r.nodes[r.node_id];let o=z(tt(e.name)),i=z(""),s=Ee(()=>{var J;if(a(o).length===0)return"";let A=a(o);A=((J=A.at(0))==null?void 0:J.toUpperCase())+A.slice(1).toLowerCase();let T=A.split(" ");return a(i)!==""&&T.push(a(i)),T.join("_")}),f=z(tt(e.image)),t,u,p,h=!1,_=!1;vt(()=>{u.value=e.name,p.value=e.addend});const l=()=>{h=!0},m="bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700",y="font-mono text-lg bg-neutral-800 text-white rounded-xl p-2 pl-3 transition duration-300 focus:bg-gray-700 focus:ring-2 focus:ring-blue-500 outline-none";var M=He(),x=W(M);Nt(x),C(x,1,y),x.__change=l,Q(x,A=>u=A,()=>u);var v=X(x,2);C(v,1,m),v.__click=A=>{t.click()};var w=X(v,2);w.__change=A=>{const T=A.target;if(!T.files||T.files.length===0)return;const J=T.files[0],K=new FileReader;K.onload=()=>{typeof K.result=="string"&&E(f,K.result,!0)},K.readAsDataURL(J),l()},Ce(w,"",{},{display:"none"}),Q(w,A=>t=A,()=>t);var Y=X(w,2);{var N=A=>{var T=qe();nt(()=>V(T,"src",a(f))),H(A,T)},D=A=>{var T=Be();nt(()=>V(T,"src",`${Pt??""}/landscape-placeholder.svg`)),H(A,T)};Ot(Y,A=>{a(f)!=""?A(N):A(D,!1)})}var k=X(Y,2);Nt(k),C(k,1,y),k.__change=l,Q(k,A=>p=A,()=>p);var O=X(k,2),P=X(O,2),j=W(P);C(j,1,"bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700 float-left"),j.__click=()=>{_=r.saveNode(r.node_id,a(o),a(i),a(f))};var G=X(j,2);C(G,1,"bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700 float-right"),G.__click=()=>r.exitNode(_,h),F(P),F(M),nt(()=>V(O,"href",`https://en.wikipedia.org/wiki/${a(s)??""}`)),It(x,()=>a(o),A=>E(o,A)),It(k,()=>a(i),A=>E(i,A)),H(n,M),at()}ot(["change","click"]);var $e=$("<button><img/></button>"),je=$('<div class="flex absolute rounded-xl bg-neutral-200 border-blue-300 border-2 p-[15px] pt-[5px] pb-[5px] h-fit bottom-6 left-[50%] transform -translate-[50%]"></div>');function Ve(n,r){it(r,!0);let e=z(2),o=["node_add.png","node_edit.png","node_drag.png","link.png"];const i=Gt();Ct(()=>{i("modeChanged",a(e))});var s=je();Ne(s,21,()=>o,Se,(f,t,u)=>{var p=$e();p.__click=()=>E(e,u,!0);var h=W(p);F(p),nt(_=>{C(p,1,`p-2.5 rounded-xl border-none outline-none transition duration-200 hover:bg-blue-300 ${a(e)===u?"bg-gray-500 mt-auto mb-auto":"mt-[10px] mb-[10px]"}`),V(h,"src",`${Pt??""}/mode_icons/${a(t)??""}`),V(h,"alt",_),C(h,1,Xe(a(e)===u?"max-w-[40px] rounded-xl":"max-w-[30px] rounded-lg"))},[()=>o[a(e)].split(".")[0]]),H(f,p)}),F(s),H(n,s),at()}ot(["click"]);function We(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var yt={exports:{}},Yt;function Ge(){return Yt||(Yt=1,function(n,r){n.exports=e;function e(t,u){if(!(this instanceof e))return new e(t,u);this.x=t||0,this.y=u||0}e.fromArray=function(t){return new e(t[0]||0,t[1]||0)},e.fromObject=function(t){return new e(t.x||0,t.y||0)},e.prototype.addX=function(t){return this.x+=t.x,this},e.prototype.addY=function(t){return this.y+=t.y,this},e.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},e.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this},e.prototype.addScalarX=function(t){return this.x+=t,this},e.prototype.addScalarY=function(t){return this.y+=t,this},e.prototype.subtractX=function(t){return this.x-=t.x,this},e.prototype.subtractY=function(t){return this.y-=t.y,this},e.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},e.prototype.subtractScalar=function(t){return this.x-=t,this.y-=t,this},e.prototype.subtractScalarX=function(t){return this.x-=t,this},e.prototype.subtractScalarY=function(t){return this.y-=t,this},e.prototype.divideX=function(t){return this.x/=t.x,this},e.prototype.divideY=function(t){return this.y/=t.y,this},e.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this},e.prototype.divideScalar=function(t){return t!==0?(this.x/=t,this.y/=t):(this.x=0,this.y=0),this},e.prototype.divideScalarX=function(t){return t!==0?this.x/=t:this.x=0,this},e.prototype.divideScalarY=function(t){return t!==0?this.y/=t:this.y=0,this},e.prototype.invertX=function(){return this.x*=-1,this},e.prototype.invertY=function(){return this.y*=-1,this},e.prototype.invert=function(){return this.invertX(),this.invertY(),this},e.prototype.multiplyX=function(t){return this.x*=t.x,this},e.prototype.multiplyY=function(t){return this.y*=t.y,this},e.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},e.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},e.prototype.multiplyScalarX=function(t){return this.x*=t,this},e.prototype.multiplyScalarY=function(t){return this.y*=t,this},e.prototype.normalize=function(){var t=this.length();return t===0?(this.x=1,this.y=0):this.divide(e(t,t)),this},e.prototype.norm=e.prototype.normalize,e.prototype.limit=function(t,u){return Math.abs(this.x)>t&&(this.x*=u),Math.abs(this.y)>t&&(this.y*=u),this},e.prototype.randomize=function(t,u){return this.randomizeX(t,u),this.randomizeY(t,u),this},e.prototype.randomizeX=function(t,u){var p=Math.min(t.x,u.x),h=Math.max(t.x,u.x);return this.x=i(p,h),this},e.prototype.randomizeY=function(t,u){var p=Math.min(t.y,u.y),h=Math.max(t.y,u.y);return this.y=i(p,h),this},e.prototype.randomizeAny=function(t,u){return Math.round(Math.random())?this.randomizeX(t,u):this.randomizeY(t,u),this},e.prototype.unfloat=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},e.prototype.toFixed=function(t){return typeof t>"u"&&(t=8),this.x=this.x.toFixed(t),this.y=this.y.toFixed(t),this},e.prototype.mixX=function(t,u){return typeof u>"u"&&(u=.5),this.x=(1-u)*this.x+u*t.x,this},e.prototype.mixY=function(t,u){return typeof u>"u"&&(u=.5),this.y=(1-u)*this.y+u*t.y,this},e.prototype.mix=function(t,u){return this.mixX(t,u),this.mixY(t,u),this},e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.copyX=function(t){return this.x=t.x,this},e.prototype.copyY=function(t){return this.y=t.y,this},e.prototype.copy=function(t){return this.copyX(t),this.copyY(t),this},e.prototype.zero=function(){return this.x=this.y=0,this},e.prototype.dot=function(t){return this.x*t.x+this.y*t.y},e.prototype.cross=function(t){return this.x*t.y-this.y*t.x},e.prototype.projectOnto=function(t){var u=(this.x*t.x+this.y*t.y)/(t.x*t.x+t.y*t.y);return this.x=u*t.x,this.y=u*t.y,this},e.prototype.horizontalAngle=function(){return Math.atan2(this.y,this.x)},e.prototype.horizontalAngleDeg=function(){return s(this.horizontalAngle())},e.prototype.verticalAngle=function(){return Math.atan2(this.x,this.y)},e.prototype.verticalAngleDeg=function(){return s(this.verticalAngle())},e.prototype.angle=e.prototype.horizontalAngle,e.prototype.angleDeg=e.prototype.horizontalAngleDeg,e.prototype.direction=e.prototype.horizontalAngle,e.prototype.rotate=function(t){var u=this.x*Math.cos(t)-this.y*Math.sin(t),p=this.x*Math.sin(t)+this.y*Math.cos(t);return this.x=u,this.y=p,this},e.prototype.rotateDeg=function(t){return t=f(t),this.rotate(t)},e.prototype.rotateTo=function(t){return this.rotate(t-this.angle())},e.prototype.rotateToDeg=function(t){return t=f(t),this.rotateTo(t)},e.prototype.rotateBy=function(t){var u=this.angle()+t;return this.rotate(u)},e.prototype.rotateByDeg=function(t){return t=f(t),this.rotateBy(t)},e.prototype.distanceX=function(t){return this.x-t.x},e.prototype.absDistanceX=function(t){return Math.abs(this.distanceX(t))},e.prototype.distanceY=function(t){return this.y-t.y},e.prototype.absDistanceY=function(t){return Math.abs(this.distanceY(t))},e.prototype.distance=function(t){return Math.sqrt(this.distanceSq(t))},e.prototype.distanceSq=function(t){var u=this.distanceX(t),p=this.distanceY(t);return u*u+p*p},e.prototype.length=function(){return Math.sqrt(this.lengthSq())},e.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},e.prototype.magnitude=e.prototype.length,e.prototype.isZero=function(){return this.x===0&&this.y===0},e.prototype.isEqualTo=function(t){return this.x===t.x&&this.y===t.y},e.prototype.toString=function(){return"x:"+this.x+", y:"+this.y},e.prototype.toArray=function(){return[this.x,this.y]},e.prototype.toObject=function(){return{x:this.x,y:this.y}};var o=180/Math.PI;function i(t,u){return Math.floor(Math.random()*(u-t+1)+t)}function s(t){return t*o}function f(t){return t/o}}(yt)),yt.exports}var Je=Ge();const q=We(Je),Ke=[{id:0,name:"Addition",addend:"",image:"",position:[100,100]},{id:1,name:"Subtraction",addend:"",image:"",position:[300,150]},{id:2,name:"Multiplication",addend:"",image:"",position:[200,300]},{id:3,name:"Division",addend:"",image:"",position:[300,450]}],Ze=[{from:0,to:1},{from:0,to:2},{from:2,to:3}],gt={nodes:Ke,links:Ze};var Qe=$(`<div class="flex flex-col gap-0 absolute w-fit p-1 rounded-xl bottom-1 left-1 font-mono text-blue-300 bg-gray-700"><p class="text-center">------------------ Edit Log ------------------</p> <textarea class="resize-none overflow-y-scroll text-wrap outline-none" readonly="" cols="48" rows="8">
    </textarea></div>`);function tn(n,r){it(r,!0);let e=tt([]),o,i=z(0),s=tt([]);const f=(_,l)=>{a(i)>0&&(e.splice(-a(i),a(i)),E(i,0)),s.push(_),e.push(l===void 0?_:_+`:
	`+l)},t=()=>{a(i)>s.length-1||(kt(i),e.push("Undo: "+s.at(-a(i))))},u=()=>{a(i)<1||(e.push("Redo: "+s.at(-a(i))),kt(i,-1))};Ct(()=>{o.value+=`
`+e.at(-1),o.scrollTop=o.scrollHeight}),vt(()=>{o.value=""});var p=Qe(),h=X(W(p),2);return Q(h,_=>o=_,()=>o),F(p),H(n,p),at({log:f,undo:t,redo:u})}var en=$('<div class="flex flex-row gap-3 w-min h-min p-3 absolute top-1 left-1 text-2xl"><button aria-label="Undo"><i class="fas fa-undo"></i></button> <button aria-label="Redo"><i class="fas fa-redo"></i></button></div>');function nn(n,r){const e="border-none rounded-full w-fit h-fit bg-gray-300 p-2 pt-0.5 pb-1 text-center";var o=en(),i=W(o);C(i,1,e),i.__click=function(...f){var t;(t=r.undo)==null||t.apply(this,f)};var s=X(i,2);C(s,1,e),s.__click=function(...f){var t;(t=r.redo)==null||t.apply(this,f)},F(o),H(n,o)}ot(["click"]);const rn=(n,r,e)=>{if(n.key==="Escape"&&a(r)&&E(r,!1),n.key==="o"&&window.confirm("Download new JSON?")){const o=JSON.stringify(a(e),null,4),i=new Blob([o],{type:"application/json"}),s=URL.createObjectURL(i),f=document.createElement("a");f.href=s,f.download="data.json",f.click(),URL.revokeObjectURL(s)}};var on=n=>n.preventDefault(),an=$('<div id="canvas-box" class="relative inline-block overflow-hidden"><canvas tabindex="0"></canvas> <div class="absolute right-2.5 top-2.5"><!></div> <!> <!> <!></div>');function sn(n,r){it(r,!0);const e=d=>({nodes:d.nodes.map(c=>({...c,position:[...c.position]})),links:d.links.map(c=>({...c}))}),o=()=>{const d=m.at(-y)??a(l);if(E(l,e(d),!0),M.length!==a(l).nodes.length){for(;M.length<a(l).nodes.length;)M.push(new Image);for(;M.length>a(l).nodes.length;)M.pop()}a(l).nodes.forEach((g,b)=>{M[b].src=g.image});const c=a(l).nodes.find(g=>g.id===a(x).id);c?E(x,c,!0):E(x,a(l).nodes[0],!0)};let i,s=new q(0,0),f=1,t=z(!1),u,p,h,_=new q(0,0),l=z(tt(e(gt))),m=[e(gt)],y=1,M=[],x=z(tt(gt.nodes[0])),v=z(!1),w=z(!1),Y,N=z(!1),D=0,k;const O=()=>{const d=i.getContext("2d");if(d===null)throw new Error("DRAW LOOP - ctx is null");i.width=window.innerWidth,i.height=window.innerHeight,d.clearRect(0,0,i.width,i.height),a(N)&&(d.beginPath(),d.moveTo(a(x).position[0]-s.x,a(x).position[1]-s.y),d.lineTo(h.x,h.y),d.lineWidth=10,d.strokeStyle="rgba(0, 0, 0, 0.35)",d.stroke()),a(l).links.forEach(c=>{d.beginPath();const g=a(l).nodes.find(S=>S.id===c.from)??a(l).nodes[0],b=a(l).nodes.find(S=>S.id===c.to)??a(l).nodes[0];d.moveTo(g.position[0]-s.x,g.position[1]-s.y),d.lineTo(b.position[0]-s.x,b.position[1]-s.y),d.lineWidth=10,d.strokeStyle="black",d.stroke()}),a(l).nodes.forEach((c,g)=>{const b=q.fromArray(c.position).subtract(s),S=25;d.beginPath(),d.arc(b.x,b.y,20,0,Math.PI*2),d.fillStyle="black",d.fill(),d.drawImage(M[g],b.x-S/2,b.y-S/2,S,S)}),requestAnimationFrame(O)},P=d=>{const c=i.getBoundingClientRect(),g=(d.clientX-c.left+s.x)/f,b=(d.clientY-c.top+s.y)/f;return new q(g,b)},j=(d,c,g)=>{const b=c.clone().subtract(d),L=g.clone().subtract(d).dot(b)/b.lengthSq();if(L<0||L>1)return 1e6;const U=Math.abs(c.clone().subtract(d).cross(g.clone().subtract(d))),rt=c.clone().subtract(d).length();return U/rt},G=d=>{if(a(w))return;const c=P(d);let g=a(l).nodes.find(b=>q.fromArray(b.position).distanceSq(c)<400);if(E(x,g??a(x),!0),d.button===0){if(D===0){if(!g)a(l).nodes.push({id:-1,name:"",addend:"",image:"",position:c.toArray()}),xt(),M.push(new Image),Z(),k.log("Create node");else if(window.confirm("Delete node and its links?")){const b=g.id;a(l).nodes.splice(b,1),E(x,a(l).nodes[0],!0),M.splice(b,1);let S=[];a(l).links.forEach((L,U)=>{(L.from===b||L.to===b)&&S.push(U)});for(const L of S)a(l).links.splice(L,1);xt(),Z(),k.log("Delete node",`Node ID: ${b}, ${S.length} links destroyed`)}}else if(D===1){if(!g)return;E(w,!0)}else if(D===2){if(!g)return;_=c.clone().subtract(q.fromArray(a(x).position)),E(v,!0)}else if(D===3)if(g)if(a(N)){if(Y.id===a(x).id)return;a(l).links.push({from:Y.id,to:a(x).id}),E(N,!1),Z(),k.log("Create link",`node ${Y.id} -> ${a(x).id}`)}else Y=g,E(N,!0),h=c;else{const b=a(l).links.findIndex(S=>{const L=a(l).nodes[S.from],U=a(l).nodes[S.to];return j(q.fromArray(L.position),q.fromArray(U.position),c)<10});b!==-1&&(a(l).links.splice(b,1),Z(),k.log("Delete link",`node ${Y.id} -> ${a(x).id}`))}}d.button===2&&(E(t,!0),u=c,p=s.clone())},A=d=>{if(a(w))return;const c=P(d);if(h=c,a(v)){let g=a(l).nodes.find(b=>b.id===a(x).id);if(g===void 0)throw new Error("uhhh focusNode error, it's not in the list...");g.position=c.clone().subtract(_).toArray()}else if(a(t)){const g=c.clone().subtract(u);s=p.clone().subtract(g)}},T=d=>{a(w)||(a(v)&&(E(v,!1),Z(),k.log("Set node position")),E(t,!1))},J=d=>{d.preventDefault()},K=(d,c,g,b)=>{let S=[a(l).nodes[d].name===c?"":"name",a(l).nodes[d].addend===g?"":"addend",a(l).nodes[d].image===b?"":"image"],L=[];S.forEach(rt=>{rt!==""&&L.push(rt)});const U=L.join(", ");return U===""||!window.confirm("Save this node with new contents?")?!1:(a(l).nodes[d].name=c,a(l).nodes[d].addend=g,a(l).nodes[d].image=b,Z(),k.log("Update node contents",U),!0)},qt=(d,c)=>{!d&&c&&!window.confirm("Stop editing without saving?")||E(w,!1)},Z=()=>{y>1&&(m.splice(-y+1,y-1),y=1),m.push(e(a(l))),console.log(m),console.log(y)},Bt=()=>{y>m.length-1||(y++,o(),k.undo(),console.log(m),console.log(y))},Ht=()=>{y<2||(y--,o(),k.redo(),console.log(m),console.log(y))},xt=()=>{const d=new Map(a(l).nodes.map((c,g)=>[c.id,g]));a(l).nodes.forEach((c,g)=>c.id=g),a(l).links.forEach(c=>{console.log(`${c.from}, ${c.to}`),c.from=d.get(c.from)??c.from,c.to=d.get(c.to)??c.to,console.log(`${c.from}, ${c.to}`)})};vt(()=>{M=a(l).nodes.map(d=>{let c=new Image;return c.src=d.image,c}),O()});var st=an(),R=W(st);let mt;R.__mousemove=A,R.__mousedown=G,R.__mouseup=T,R.__keydown=[rn,N,l],R.__contextmenu=[on],Q(R,d=>i=d,()=>i);var lt=X(R,2),Ft=W(lt);{var $t=d=>{Fe(d,{get node_id(){return a(x).id},saveNode:K,exitNode:qt,get nodes(){return a(l).nodes}})};Ot(Ft,d=>{a(w)&&d($t)})}F(lt);var bt=X(lt,2);Q(tn(bt,{}),d=>k=d,()=>k);var _t=X(bt,2);nn(_t,{undo:Bt,redo:Ht});var jt=X(_t,2);Ve(jt,{$$events:{modeChanged:d=>D=d.detail}}),F(st),nt(d=>mt=C(R,1,"bg-neutral-100",null,mt,d),[()=>({"cursor-grabbing":a(v)||a(t)})]),Jt("wheel",R,J),H(n,st),at()}ot(["mousemove","mousedown","mouseup","keydown","contextmenu"]);function pn(n){sn(n,{})}export{pn as component};
