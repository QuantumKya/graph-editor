import"../chunks/CWj6FrbW.js";import"../chunks/CwZKfcDM.js";import{a as $t,l as te,d as rt,o as lt,c as ee,r as ne,e as re}from"../chunks/BYhcaexx.js";import{a4 as oe,b as ie,s as dt,h as Y,M as ae,a as se,A as a,ak as le,r as ue,c as fe,d as At,f as ct,j as et,Y as de,$ as ce,g as Yt,i as Xt,p as he,aw as ht,a2 as zt,R as Mt,ax as pe,as as ge,ay as St,az as ye,aA as ve,N as xe,aB as me,aC as be,aD as _e,aE as we,Z as ke,W as Ae,aF as Me,aG as Se,aH as Ee,aI as De,aJ as Ne,aK as Te,u as Le,l as Ie,D as ot,at as L,al as Z,F,J as j,L as T,am as S,K as q,G as nt,au as Ye,t as H,I as it,x as Ot,aL as Et}from"../chunks/BKZJkl96.js";import{b as G,i as xt}from"../chunks/4slWvAw0.js";import{b as Ct}from"../chunks/DvHJ3KEJ.js";function Xe(n,r){return r}function ze(n,r,e,o){for(var i=[],s=r.length,c=0;c<s;c++)ve(r[c].e,i,!0);var t=s>0&&i.length===0&&e!==null;if(t){var u=e.parentNode;xe(u),u.append(e),o.clear(),W(n,r[0].prev,r[s-1].next)}me(i,()=>{for(var p=0;p<s;p++){var h=r[p];t||(o.delete(h.k),W(n,h.prev,h.next)),be(h.e,!t)}})}function Oe(n,r,e,o,i,s=null){var c=n,t={flags:r,items:new Map,first:null};{var u=n;c=Y?dt(ae(u)):u.appendChild(oe())}Y&&se();var p=null,h=!1,x=le(()=>{var f=e();return Ae(f)?f:f==null?[]:zt(f)});ie(()=>{var f=a(x),m=f.length;if(h&&m===0)return;h=m===0;let g=!1;if(Y){var k=ue(c)===fe;k!==(m===0)&&(c=At(),dt(c),ct(!1),g=!0)}if(Y){for(var y=null,b,A=0;A<m;A++){if(et.nodeType===de&&et.data===ce){c=et,g=!0,ct(!1);break}var R=f[A],z=o(R,A);b=Rt(et,t,y,null,R,z,A,i,r,e),t.items.set(z,b),y=b}m>0&&dt(At())}Y||Ce(f,t,c,i,r,o,e),s!==null&&(m===0?p?Yt(p):p=Xt(()=>s(c)):p!==null&&he(p,()=>{p=null})),g&&ct(!0),a(x)}),Y&&(c=et)}function Ce(n,r,e,o,i,s,c){var t=n.length,u=r.items,p=r.first,h=p,x,f=null,m=[],g=[],k,y,b,A;for(A=0;A<t;A+=1){if(k=n[A],y=s(k,A),b=u.get(y),b===void 0){var R=h?h.e.nodes_start:e;f=Rt(R,r,f,f===null?r.first:f.next,k,y,A,o,i,c),u.set(y,f),m=[],g=[],h=f.next;continue}if(Re(b,k,A),(b.e.f&ht)!==0&&Yt(b.e),b!==h){if(x!==void 0&&x.has(b)){if(m.length<g.length){var z=g[0],E;f=z.prev;var P=m[0],O=m[m.length-1];for(E=0;E<m.length;E+=1)Dt(m[E],z,e);for(E=0;E<g.length;E+=1)x.delete(g[E]);W(r,P.prev,O.next),W(r,f,P),W(r,O,z),h=z,f=O,A-=1,m=[],g=[]}else x.delete(b),Dt(b,h,e),W(r,b.prev,b.next),W(r,b,f===null?r.first:f.next),W(r,f,b),f=b;continue}for(m=[],g=[];h!==null&&h.k!==y;)(h.e.f&ht)===0&&(x??(x=new Set)).add(h),g.push(h),h=h.next;if(h===null)continue;b=h}m.push(b),f=b,h=b.next}if(h!==null||x!==void 0){for(var D=x===void 0?[]:zt(x);h!==null;)(h.e.f&ht)===0&&D.push(h),h=h.next;var J=D.length;if(J>0){var _=t===0?e:null;ze(r,D,_,u)}}Mt.first=r.first&&r.first.e,Mt.last=f&&f.e}function Re(n,r,e,o){pe(n.v,r),n.i=e}function Rt(n,r,e,o,i,s,c,t,u,p){var h=(u&_e)!==0,x=(u&we)===0,f=h?x?ge(i,!1,!1):St(i):i,m=(u&ye)===0?c:St(c),g={i:m,v:f,k:s,a:null,e:null,prev:e,next:o};try{return g.e=Xt(()=>t(n,f,m,p),Y),g.e.prev=e&&e.e,g.e.next=o&&o.e,e===null?r.first=g:(e.next=g,e.e.next=g.e),o!==null&&(o.prev=g,o.e.prev=g.e),g}finally{}}function Dt(n,r,e){for(var o=n.next?n.next.e.nodes_start:e,i=r?r.e.nodes_start:e,s=n.e.nodes_start;s!==o;){var c=ke(s);i.before(s),s=c}}function W(n,r,e){r===null?n.first=e:(r.next=e,r.e.next=e&&e.e),e!==null&&(e.prev=r,e.e.prev=r&&r.e)}function Pt(n){var r,e,o="";if(typeof n=="string"||typeof n=="number")o+=n;else if(typeof n=="object")if(Array.isArray(n)){var i=n.length;for(r=0;r<i;r++)n[r]&&(e=Pt(n[r]))&&(o&&(o+=" "),o+=e)}else for(e in n)n[e]&&(o&&(o+=" "),o+=e);return o}function Pe(){for(var n,r,e=0,o="",i=arguments.length;e<i;e++)(n=arguments[e])&&(r=Pt(n))&&(o&&(o+=" "),o+=r);return o}function Ue(n){return typeof n=="object"?Pe(n):n??""}const Nt=[...` 	
\r\fÂ \v\uFEFF`];function qe(n,r,e){var o=n==null?"":""+n;if(r&&(o=o?o+" "+r:r),e){for(var i in e)if(e[i])o=o?o+" "+i:i;else if(o.length)for(var s=i.length,c=0;(c=o.indexOf(i,c))>=0;){var t=c+s;(c===0||Nt.includes(o[c-1]))&&(t===o.length||Nt.includes(o[t]))?o=(c===0?"":o.substring(0,c))+o.substring(t+1):c=t}}return o===""?null:o}function Tt(n,r=!1){var e=r?" !important;":";",o="";for(var i in n){var s=n[i];s!=null&&s!==""&&(o+=" "+i+": "+s+e)}return o}function Be(n,r){if(r){var e="",o,i;return Array.isArray(r)?(o=r[0],i=r[1]):o=r,o&&(e+=Tt(o)),i&&(e+=Tt(i,!0)),e=e.trim(),e===""?null:e}return String(n)}function X(n,r,e,o,i,s){var c=n.__className;if(Y||c!==e||c===void 0){var t=qe(e,o,s);(!Y||t!==n.getAttribute("class"))&&(t==null?n.removeAttribute("class"):n.className=t),n.__className=e}else if(s&&i!==s)for(var u in s){var p=!!s[u];(i==null||p!==!!i[u])&&n.classList.toggle(u,p)}return s}function pt(n,r={},e,o){for(var i in e){var s=e[i];r[i]!==s&&(e[i]==null?n.style.removeProperty(i):n.style.setProperty(i,s,o))}}function He(n,r,e,o){var i=n.__style;if(Y||i!==r){var s=Be(r,o);(!Y||s!==n.getAttribute("style"))&&(s==null?n.removeAttribute("style"):n.style.cssText=s),n.__style=r}else o&&(Array.isArray(o)?(pt(n,e==null?void 0:e[0],o[0]),pt(n,e==null?void 0:e[1],o[1],"important")):pt(n,e,o));return o}const je=Symbol("is custom element"),Fe=Symbol("is html");function mt(n){if(Y){var r=!1,e=()=>{if(!r){if(r=!0,n.hasAttribute("value")){var o=n.value;Q(n,"value",null),n.value=o}if(n.hasAttribute("checked")){var i=n.checked;Q(n,"checked",null),n.checked=i}}};n.__on_r=e,De(e),$t()}}function Q(n,r,e,o){var i=Ve(n);Y&&(i[r]=n.getAttribute(r),r==="src"||r==="srcset"||r==="href"&&n.nodeName==="LINK")||i[r]!==(i[r]=e)&&(r==="loading"&&(n[Me]=e),e==null?n.removeAttribute(r):typeof e!="string"&&We(n).includes(r)?n[r]=e:n.setAttribute(r,e))}function Ve(n){return n.__attributes??(n.__attributes={[je]:n.nodeName.includes("-"),[Fe]:n.namespaceURI===Se})}var Lt=new Map;function We(n){var r=Lt.get(n.nodeName);if(r)return r;Lt.set(n.nodeName,r=[]);for(var e,o=n,i=Element.prototype;i!==o;){e=Ne(o);for(var s in e)e[s].set&&r.push(s);o=Ee(o)}return r}function st(n,r,e=r){var o=Te();te(n,"input",i=>{var s=i?n.defaultValue:n.value;if(s=gt(n)?yt(s):s,e(s),o&&s!==(s=r())){var c=n.selectionStart,t=n.selectionEnd;n.value=s??"",t!==null&&(n.selectionStart=c,n.selectionEnd=Math.min(t,n.value.length))}}),(Y&&n.defaultValue!==n.value||Le(r)==null&&n.value)&&e(gt(n)?yt(n.value):n.value),Ie(()=>{var i=r();gt(n)&&i===yt(n.value)||n.type==="date"&&!i&&!n.value||i!==n.value&&(n.value=i??"")})}function gt(n){var r=n.type;return r==="number"||r==="range"}function yt(n){return n===""?null:+n}var Ge=F('<img alt="Uploaded Icon" class="rounded-lg w-[300px]"/>'),Je=F('<img alt="Uploaded Icon" class="rounded-lg w-[300px]"/>'),Ke=F('<div class="flex flex-col gap-3.5 max-w-[350px] h-fit bg-neutral-950 text-white p-2.5 rounded-xl"><input type="text" placeholder="Node Title"/> <button>Upload Image</button> <input type="file" accept="image/*"/> <!> <input type="text" placeholder="Link Addend"/> <a class="underline">Wikipedia</a> <div class="relative inline-block h-fit"><button>Save</button> <button>Exit</button></div></div>');function Ze(n,r){ot(r,!0);let e=L(Z(r.node.name)),o=L(""),i=Ye(()=>{var $;if(a(e).length===0)return"";let _=a(e);_=(($=_.at(0))==null?void 0:$.toUpperCase())+_.slice(1).toLowerCase();let I=_.split(" ");return a(o)!==""&&I.push(a(o)),I.join("_")}),s=L(Z(r.node.image)),c,t,u,p=!1,h=!1;lt(()=>{t.value=r.node.name,u.value=r.node.addend});const x=()=>{p=!0},f="bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700",m="font-mono text-lg bg-neutral-800 text-white rounded-xl p-2 pl-3 transition duration-300 focus:bg-gray-700 focus:ring-2 focus:ring-blue-500 outline-none";var g=Ke(),k=j(g);mt(k),X(k,1,m),k.__change=x,G(k,_=>t=_,()=>t);var y=T(k,2);X(y,1,f),y.__click=_=>{c.click()};var b=T(y,2);b.__change=_=>{const I=_.target;if(!I.files||I.files.length===0)return;const $=I.files[0],tt=new FileReader;tt.onload=()=>{typeof tt.result=="string"&&S(s,tt.result,!0)},tt.readAsDataURL($),x()},He(b,"",{},{display:"none"}),G(b,_=>c=_,()=>c);var A=T(b,2);{var R=_=>{var I=Ge();nt(()=>Q(I,"src",a(s))),H(_,I)},z=_=>{var I=Je();nt(()=>Q(I,"src",`${Ct??""}/landscape-placeholder.svg`)),H(_,I)};xt(A,_=>{a(s)!=""?_(R):_(z,!1)})}var E=T(A,2);mt(E),X(E,1,m),E.__change=x,G(E,_=>u=_,()=>u);var P=T(E,2),O=T(P,2),D=j(O);X(D,1,"bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700 float-left"),D.__click=()=>{h=r.saveNode(r.node,a(e),a(o),a(s))};var J=T(D,2);X(J,1,"bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700 float-right"),J.__click=()=>r.exitNode(h,p),q(O),q(g),nt(()=>Q(P,"href",`https://en.wikipedia.org/wiki/${a(i)??""}`)),st(k,()=>a(e),_=>S(e,_)),st(E,()=>a(o),_=>S(o,_)),H(n,g),it()}rt(["change","click"]);var Qe=F("<button><img/></button>"),$e=F('<div class="flex absolute rounded-xl bg-neutral-200 border-blue-300 border-2 p-[10px] pt-[5px] pb-[5px] h-fit bottom-6 left-[50%] transform -translate-[50%]"></div>');function tn(n,r){ot(r,!0);let e=L(2),o=["node_add.png","node_edit.png","node_drag.png","link_add.png","link_edit.png"];const i=ee();Ot(()=>{i("modeChanged",a(e))});var s=$e();Oe(s,21,()=>o,Xe,(c,t,u)=>{var p=Qe();p.__click=()=>S(e,u,!0);var h=j(p);q(p),nt(x=>{X(p,1,`p-2.5 rounded-xl border-none outline-none transition duration-200 hover:bg-blue-300 ${a(e)===u?"bg-gray-500 mt-auto mb-auto":"mt-[10px] mb-[10px]"}`),Q(h,"src",`${Ct??""}/mode_icons/${a(t)??""}`),Q(h,"alt",x),X(h,1,Ue(a(e)===u?"max-w-[40px] rounded-xl":"max-w-[30px] rounded-lg"))},[()=>o[u].split(".")[0]]),H(c,p)}),q(s),H(n,s),it()}rt(["click"]);function en(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var vt={exports:{}},It;function nn(){return It||(It=1,function(n,r){n.exports=e;function e(t,u){if(!(this instanceof e))return new e(t,u);this.x=t||0,this.y=u||0}e.fromArray=function(t){return new e(t[0]||0,t[1]||0)},e.fromObject=function(t){return new e(t.x||0,t.y||0)},e.prototype.addX=function(t){return this.x+=t.x,this},e.prototype.addY=function(t){return this.y+=t.y,this},e.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},e.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this},e.prototype.addScalarX=function(t){return this.x+=t,this},e.prototype.addScalarY=function(t){return this.y+=t,this},e.prototype.subtractX=function(t){return this.x-=t.x,this},e.prototype.subtractY=function(t){return this.y-=t.y,this},e.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},e.prototype.subtractScalar=function(t){return this.x-=t,this.y-=t,this},e.prototype.subtractScalarX=function(t){return this.x-=t,this},e.prototype.subtractScalarY=function(t){return this.y-=t,this},e.prototype.divideX=function(t){return this.x/=t.x,this},e.prototype.divideY=function(t){return this.y/=t.y,this},e.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this},e.prototype.divideScalar=function(t){return t!==0?(this.x/=t,this.y/=t):(this.x=0,this.y=0),this},e.prototype.divideScalarX=function(t){return t!==0?this.x/=t:this.x=0,this},e.prototype.divideScalarY=function(t){return t!==0?this.y/=t:this.y=0,this},e.prototype.invertX=function(){return this.x*=-1,this},e.prototype.invertY=function(){return this.y*=-1,this},e.prototype.invert=function(){return this.invertX(),this.invertY(),this},e.prototype.multiplyX=function(t){return this.x*=t.x,this},e.prototype.multiplyY=function(t){return this.y*=t.y,this},e.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},e.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},e.prototype.multiplyScalarX=function(t){return this.x*=t,this},e.prototype.multiplyScalarY=function(t){return this.y*=t,this},e.prototype.normalize=function(){var t=this.length();return t===0?(this.x=1,this.y=0):this.divide(e(t,t)),this},e.prototype.norm=e.prototype.normalize,e.prototype.limit=function(t,u){return Math.abs(this.x)>t&&(this.x*=u),Math.abs(this.y)>t&&(this.y*=u),this},e.prototype.randomize=function(t,u){return this.randomizeX(t,u),this.randomizeY(t,u),this},e.prototype.randomizeX=function(t,u){var p=Math.min(t.x,u.x),h=Math.max(t.x,u.x);return this.x=i(p,h),this},e.prototype.randomizeY=function(t,u){var p=Math.min(t.y,u.y),h=Math.max(t.y,u.y);return this.y=i(p,h),this},e.prototype.randomizeAny=function(t,u){return Math.round(Math.random())?this.randomizeX(t,u):this.randomizeY(t,u),this},e.prototype.unfloat=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},e.prototype.toFixed=function(t){return typeof t>"u"&&(t=8),this.x=this.x.toFixed(t),this.y=this.y.toFixed(t),this},e.prototype.mixX=function(t,u){return typeof u>"u"&&(u=.5),this.x=(1-u)*this.x+u*t.x,this},e.prototype.mixY=function(t,u){return typeof u>"u"&&(u=.5),this.y=(1-u)*this.y+u*t.y,this},e.prototype.mix=function(t,u){return this.mixX(t,u),this.mixY(t,u),this},e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.copyX=function(t){return this.x=t.x,this},e.prototype.copyY=function(t){return this.y=t.y,this},e.prototype.copy=function(t){return this.copyX(t),this.copyY(t),this},e.prototype.zero=function(){return this.x=this.y=0,this},e.prototype.dot=function(t){return this.x*t.x+this.y*t.y},e.prototype.cross=function(t){return this.x*t.y-this.y*t.x},e.prototype.projectOnto=function(t){var u=(this.x*t.x+this.y*t.y)/(t.x*t.x+t.y*t.y);return this.x=u*t.x,this.y=u*t.y,this},e.prototype.horizontalAngle=function(){return Math.atan2(this.y,this.x)},e.prototype.horizontalAngleDeg=function(){return s(this.horizontalAngle())},e.prototype.verticalAngle=function(){return Math.atan2(this.x,this.y)},e.prototype.verticalAngleDeg=function(){return s(this.verticalAngle())},e.prototype.angle=e.prototype.horizontalAngle,e.prototype.angleDeg=e.prototype.horizontalAngleDeg,e.prototype.direction=e.prototype.horizontalAngle,e.prototype.rotate=function(t){var u=this.x*Math.cos(t)-this.y*Math.sin(t),p=this.x*Math.sin(t)+this.y*Math.cos(t);return this.x=u,this.y=p,this},e.prototype.rotateDeg=function(t){return t=c(t),this.rotate(t)},e.prototype.rotateTo=function(t){return this.rotate(t-this.angle())},e.prototype.rotateToDeg=function(t){return t=c(t),this.rotateTo(t)},e.prototype.rotateBy=function(t){var u=this.angle()+t;return this.rotate(u)},e.prototype.rotateByDeg=function(t){return t=c(t),this.rotateBy(t)},e.prototype.distanceX=function(t){return this.x-t.x},e.prototype.absDistanceX=function(t){return Math.abs(this.distanceX(t))},e.prototype.distanceY=function(t){return this.y-t.y},e.prototype.absDistanceY=function(t){return Math.abs(this.distanceY(t))},e.prototype.distance=function(t){return Math.sqrt(this.distanceSq(t))},e.prototype.distanceSq=function(t){var u=this.distanceX(t),p=this.distanceY(t);return u*u+p*p},e.prototype.length=function(){return Math.sqrt(this.lengthSq())},e.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},e.prototype.magnitude=e.prototype.length,e.prototype.isZero=function(){return this.x===0&&this.y===0},e.prototype.isEqualTo=function(t){return this.x===t.x&&this.y===t.y},e.prototype.toString=function(){return"x:"+this.x+", y:"+this.y},e.prototype.toArray=function(){return[this.x,this.y]},e.prototype.toObject=function(){return{x:this.x,y:this.y}};var o=180/Math.PI;function i(t,u){return Math.floor(Math.random()*(u-t+1)+t)}function s(t){return t*o}function c(t){return t/o}}(vt)),vt.exports}var rn=nn();const V=en(rn),on=[{id:0,name:"Addition",addend:"",image:"",position:[100,100]},{id:1,name:"Subtraction",addend:"",image:"",position:[300,150]},{id:2,name:"Multiplication",addend:"",image:"",position:[200,300]},{id:3,name:"Division",addend:"",image:"",position:[300,450]}],an=[{from:0,to:1,name:"",description:""},{from:0,to:2,name:"",description:""},{from:2,to:3,name:"",description:""}],at={nodes:on,links:an};var sn=F(`<div class="flex flex-col gap-0 absolute w-fit p-1 rounded-xl bottom-1 left-1 font-mono text-blue-300 bg-gray-700"><p class="text-center">------------------ Edit Log ------------------</p> <textarea class="resize-none overflow-y-scroll text-wrap outline-none" readonly="" cols="48" rows="8">
    </textarea></div>`);function ln(n,r){ot(r,!0);let e=Z([]),o,i=L(0),s=Z([]);const c=(x,f)=>{a(i)>0&&(e.splice(-a(i),a(i)),S(i,0)),s.push(x),e.push(f===void 0?x:x+`:
	`+f)},t=()=>{a(i)>s.length-1||(Et(i),e.push("Undo: "+s.at(-a(i))))},u=()=>{a(i)<1||(e.push("Redo: "+s.at(-a(i))),Et(i,-1))};Ot(()=>{o.value+=`
`+e.at(-1),o.scrollTop=o.scrollHeight}),lt(()=>{o.value=""});var p=sn(),h=T(j(p),2);return G(h,x=>o=x,()=>o),q(p),H(n,p),it({log:c,undo:t,redo:u})}var un=F('<div class="flex flex-row gap-3 w-min h-min p-3 absolute top-1 left-1 text-2xl"><button aria-label="Undo"><i class="fas fa-undo"></i></button> <button aria-label="Redo"><i class="fas fa-redo"></i></button></div>');function fn(n,r){const e="border-none rounded-full w-fit h-fit bg-gray-300 p-2 pt-0.5 pb-1 text-center";var o=un(),i=j(o);X(i,1,e),i.__click=function(...c){var t;(t=r.undo)==null||t.apply(this,c)};var s=T(i,2);X(s,1,e),s.__click=function(...c){var t;(t=r.redo)==null||t.apply(this,c)},q(o),H(n,o)}rt(["click"]);var dn=F('<div class="flex flex-col gap-3.5 max-w-[350px] h-fit bg-neutral-950 text-white p-2.5 rounded-xl"><input type="text" placeholder="Link Title"/> <textarea rows="6" maxlength="400" placeholder="Link Description"></textarea> <div class="relative inline-block h-fit"><button>Save</button> <button>Exit</button></div></div>');function cn(n,r){ot(r,!0);let e=L(""),o=L(""),i,s,c=!1,t=!1;lt(()=>{i.value=r.link.name,s.value=r.link.description});const u=()=>{t=!0},p="font-mono text-lg bg-neutral-800 text-white rounded-xl p-2 pl-3 transition duration-300 focus:bg-gray-700 focus:ring-2 focus:ring-blue-500 outline-none";var h=dn(),x=j(h);mt(x),X(x,1,p),x.__change=u,G(x,y=>i=y,()=>i);var f=T(x,2);ne(f),X(f,1,"font-mono text-lg bg-neutral-800 text-white rounded-xl p-2 pl-3 transition duration-300 focus:bg-gray-700 focus:ring-2 focus:ring-blue-500 outline-none placeholder:text-neutral-400 resize-none overflow-scroll"),f.__change=u,G(f,y=>s=y,()=>s);var m=T(f,2),g=j(m);X(g,1,"bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700 float-left"),g.__click=()=>{c=r.saveLink(r.link,a(e),a(o))};var k=T(g,2);X(k,1,"bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700 float-right"),k.__click=()=>r.exitLink(c,t),q(m),q(h),st(x,()=>a(e),y=>S(e,y)),st(f,()=>a(o),y=>S(o,y)),H(n,h),it()}rt(["change","click"]);const hn=(n,r,e)=>{if(n.key==="Escape"&&a(r)&&S(r,!1),n.key==="o"&&window.confirm("Download new JSON?")){const o=JSON.stringify(a(e),null,4),i=new Blob([o],{type:"application/json"}),s=URL.createObjectURL(i),c=document.createElement("a");c.href=s,c.download="data.json",c.click(),URL.revokeObjectURL(s)}};var pn=n=>n.preventDefault(),gn=F('<div id="canvas-box" class="relative inline-block overflow-hidden"><canvas tabindex="0"></canvas> <div class="absolute right-2.5 top-2.5"><!></div> <!> <!> <!></div>');function yn(n,r){ot(r,!0);const e=l=>({nodes:l.nodes.map(d=>({...d,position:[...d.position]})),links:l.links.map(d=>({...d}))}),o=()=>{const l=m.at(-g)??a(f);if(S(f,e(l),!0),k.length!==a(f).nodes.length){for(;k.length<a(f).nodes.length;)k.push(new Image);for(;k.length>a(f).nodes.length;)k.pop()}a(f).nodes.forEach((v,w)=>{k[w].src=v.image});const d=a(f).nodes.find(v=>v.id===a(y).id);d?S(y,d,!0):S(y,a(f).nodes[0],!0)};let i,s=new V(0,0),c=1,t=L(!1),u,p,h,x=new V(0,0),f=L(Z(e(at))),m=[e(at)],g=1,k=[],y=L(Z(at.nodes[0])),b=L(!1),A=L(!1),R=L(Z(at.links[0])),z=L(!1),E,P=L(!1),O=0,D;const J=()=>{const l=i.getContext("2d");if(l===null)throw new Error("DRAW LOOP - ctx is null");i.width=window.innerWidth,i.height=window.innerHeight,l.clearRect(0,0,i.width,i.height),a(P)&&(l.beginPath(),l.moveTo(a(y).position[0]-s.x,a(y).position[1]-s.y),l.lineTo(h.x,h.y),l.lineWidth=10,l.strokeStyle="rgba(0, 0, 0, 0.35)",l.stroke()),a(f).links.forEach(d=>{l.beginPath();const v=a(f).nodes.find(N=>N.id===d.from)??a(f).nodes[0],w=a(f).nodes.find(N=>N.id===d.to)??a(f).nodes[0];l.moveTo(v.position[0]-s.x,v.position[1]-s.y),l.lineTo(w.position[0]-s.x,w.position[1]-s.y),l.lineWidth=10,l.strokeStyle="black",l.stroke()}),a(f).nodes.forEach((d,v)=>{const w=V.fromArray(d.position).subtract(s),N=25;l.beginPath(),l.arc(w.x,w.y,20,0,Math.PI*2),l.fillStyle="black",l.fill(),l.drawImage(k[v],w.x-N/2,w.y-N/2,N,N)}),requestAnimationFrame(J)},_=l=>{const d=i.getBoundingClientRect(),v=(l.clientX-d.left+s.x)/c,w=(l.clientY-d.top+s.y)/c;return new V(v,w)},I=(l,d,v)=>{const w=d.clone().subtract(l),M=v.clone().subtract(l).dot(w)/w.lengthSq();if(M<0||M>1)return 1e6;const C=Math.abs(d.clone().subtract(l).cross(v.clone().subtract(l))),U=d.clone().subtract(l).length();return C/U},$=l=>{if(a(A))return;const d=_(l);let v=a(f).nodes.find(M=>V.fromArray(M.position).distanceSq(d)<400);S(y,v??a(y),!0);let w=a(f).links.find(M=>{const C=a(f).nodes[M.from],U=a(f).nodes[M.to];return I(V.fromArray(C.position),V.fromArray(U.position),d)<10});S(R,w??a(R),!0);const N=a(f).links.indexOf(a(R));if(l.button===0){if(O===0){if(!v)a(f).nodes.push({id:-1,name:"",addend:"",image:"",position:d.toArray()}),bt(),k.push(new Image),K(),D.log("Create node");else if(window.confirm("Delete node and its links?")){const M=v.id;a(f).nodes.splice(M,1),S(y,a(f).nodes[0],!0),k.splice(M,1);let C=[];a(f).links.forEach((U,Qt)=>{(U.from===M||U.to===M)&&C.push(Qt)});for(const U of C)a(f).links.splice(U,1);bt(),K(),D.log("Delete node",`Node ID: ${M}, ${C.length} links destroyed`)}}else if(O===1){if(!v)return;S(A,!0)}else if(O===2){if(!v)return;x=d.clone().subtract(V.fromArray(a(y).position)),S(b,!0)}else if(O===3)if(v)if(a(P)){if(E.id===a(y).id||a(f).links.filter(M=>M.from===E.id&&M.to===a(y).id||M.from===a(y).id&&M.to===E.id).length!==0)return;a(f).links.push({from:E.id,to:a(y).id,name:"",description:""}),S(P,!1),K(),D.log("Create link",`node ${E.id} -> ${a(y).id}`)}else E=v,S(P,!0),h=d;else{if(!w)return;a(f).links.splice(N,1),K(),D.log("Delete link",`node ${E.id} -> ${a(y).id}`)}else if(O===4){if(!w)return;S(z,!0)}}l.button===2&&(S(t,!0),u=d,p=s.clone())},tt=l=>{if(a(A))return;const d=_(l);if(h=d,a(b)){let v=a(f).nodes.find(w=>w.id===a(y).id);if(v===void 0)throw new Error("uhhh focusNode error, it's not in the list...");v.position=d.clone().subtract(x).toArray()}else if(a(t)){const v=d.clone().subtract(u);s=p.clone().subtract(v)}},Ut=l=>{a(A)||(a(b)&&(S(b,!1),K(),D.log("Set node position")),S(t,!1))},qt=l=>{l.preventDefault()},Bt=(l,d,v,w)=>{let N=[l.name===d?"":"name",l.addend===v?"":"addend",l.image===w?"":"image"],M=[];N.forEach(U=>{U!==""&&M.push(U)});const C=M.join(", ");return C===""||!window.confirm("Save this node with new contents?")?!1:(l.name=d,l.addend=v,l.image=w,K(),D.log("Update node contents",C),!0)},Ht=(l,d)=>{!l&&d&&!window.confirm("Stop editing without saving?")||S(A,!1)},jt=(l,d,v)=>{let w=[l.name===d?"":"name",l.description===v?"":"description"],N=[];w.forEach(C=>{C!==""&&N.push(C)});const M=N.join(", ");return M===""||!window.confirm("Save this node with new contents?")?!1:(l.name=d,l.description=v,K(),D.log("Update node contents",M),!0)},Ft=(l,d)=>{!l&&d&&!window.confirm("Stop editing without saving?")||S(z,!1)},K=()=>{g>1&&(m.splice(-g+1,g-1),g=1),m.push(e(a(f))),console.log(m),console.log(g)},Vt=()=>{g>m.length-1||(g++,o(),D.undo(),console.log(m),console.log(g))},Wt=()=>{g<2||(g--,o(),D.redo(),console.log(m),console.log(g))},bt=()=>{const l=new Map(a(f).nodes.map((d,v)=>[d.id,v]));a(f).nodes.forEach((d,v)=>d.id=v),a(f).links.forEach(d=>{console.log(`${d.from}, ${d.to}`),d.from=l.get(d.from)??d.from,d.to=l.get(d.to)??d.to,console.log(`${d.from}, ${d.to}`)})};lt(()=>{k=a(f).nodes.map(l=>{let d=new Image;return d.src=l.image,d}),J()});var ut=gn(),B=j(ut);let _t;B.__mousemove=tt,B.__mousedown=$,B.__mouseup=Ut,B.__keydown=[hn,P,f],B.__contextmenu=[pn],G(B,l=>i=l,()=>i);var ft=T(B,2),Gt=j(ft);{var Jt=l=>{Ze(l,{get node(){return a(y)},saveNode:Bt,exitNode:Ht})},Kt=(l,d)=>{{var v=w=>{cn(w,{get link(){return a(R)},saveLink:jt,exitLink:Ft})};xt(l,w=>{a(z)&&w(v)},d)}};xt(Gt,l=>{a(A)?l(Jt):l(Kt,!1)})}q(ft);var wt=T(ft,2);G(ln(wt,{}),l=>D=l,()=>D);var kt=T(wt,2);fn(kt,{undo:Vt,redo:Wt});var Zt=T(kt,2);tn(Zt,{$$events:{modeChanged:l=>O=l.detail}}),q(ut),nt(l=>_t=X(B,1,"bg-neutral-100",null,_t,l),[()=>({"cursor-grabbing":a(b)||a(t)})]),re("wheel",B,qt),H(n,ut),it()}rt(["mousemove","mousedown","mouseup","keydown","contextmenu"]);function kn(n){yn(n,{})}export{kn as component};
