import"../chunks/CWj6FrbW.js";import{o as ie}from"../chunks/D4UJGxAj.js";import{aF as et,i as tt,O as ot,K as nt,a1 as q,a3 as D,W as K,f as O,c as W,s as k,g as e,d as f,r as j,t as Z,b as M,a2 as Y,aj as Oe,au as at,a as rt,aG as oe,aD as Ce,a4 as Me}from"../chunks/DCiFBwZK.js";import{l as it,d as Q,r as Pe,h as lt,e as Re}from"../chunks/GnwKRTTK.js";import{i as X}from"../chunks/CLeLst1N.js";import{a as Te,s as A,t as ne,b as B,e as st,i as dt,h as ct,V as J,C as ut,c as Ue,f as ft,g as he,d as te}from"../chunks/7kg2MtJh.js";import{b as T}from"../chunks/CvNMPwJY.js";import{r as je,s as ae}from"../chunks/jEiHzXEX.js";import{b as Ge}from"../chunks/CBBT1DNg.js";function re(r,d,v=d){var i=et();it(r,"input",a=>{var c=a?r.defaultValue:r.value;if(c=be(r)?_e(c):c,v(c),i&&c!==(c=d())){var _=r.selectionStart,w=r.selectionEnd;r.value=c??"",w!==null&&(r.selectionStart=_,r.selectionEnd=Math.min(w,r.value.length))}}),(tt&&r.defaultValue!==r.value||ot(d)==null&&r.value)&&v(be(r)?_e(r.value):r.value),nt(()=>{var a=d();be(r)&&a===_e(r.value)||r.type==="date"&&!a&&!r.value||a!==r.value&&(r.value=a??"")})}function be(r){var d=r.type;return d==="number"||d==="range"}function _e(r){return r===""?null:+r}var gt=O('<img alt="Uploaded Icon" class="rounded-lg w-[150px]"/>'),vt=O('<img alt="Uploaded Icon" class="rounded-lg w-[150px]"/>'),mt=O('<div class="flex flex-col gap-3.5 max-w-[350px] h-fit bg-neutral-950 text-white p-2.5 rounded-xl"><input type="text" placeholder="Node Title"/> <textarea rows="6" maxlength="400" placeholder="Link Description"></textarea> <!> <button>Upload Image</button> <input type="file" accept="image/*"/> <div class="relative inline-block h-fit"><button>Save</button> <button>Exit</button></div></div>');function pt(r,d){q(d,!0);let v=D(K(d.node.name)),i=D(K(d.node.description)),a=D(K(d.node.image)),c,_,w,E=!1,R=!1;ie(()=>{_.value=d.node.name});const N=()=>{E=!0};var S=mt(),h=W(S);je(h),h.__change=N,T(h,p=>_=p,()=>_);var o=k(h,2);Pe(o),o.__change=N,T(o,p=>w=p,()=>w);var y=k(o,2);{var g=p=>{var C=gt();Z(()=>ae(C,"src",e(a))),M(p,C)},L=p=>{var C=vt();Z(()=>ae(C,"src",`${Ge??""}/landscape-placeholder.svg`)),M(p,C)};X(y,p=>{e(a)!=""?p(g):p(L,!1)})}var b=k(y,2);b.__click=p=>{c.click()};var m=k(b,2);m.__change=p=>{const C=p.target;if(!C.files||C.files.length===0)return;const z=C.files[0],I=new FileReader;I.onload=()=>{typeof I.result=="string"&&f(a,I.result,!0)},I.readAsDataURL(z),N()},Te(m,"",{},{display:"none"}),T(m,p=>c=p,()=>c);var x=k(m,2),F=W(x);F.__click=()=>{R=d.saveNode(d.node,e(v),e(a))};var U=k(F,2);U.__click=()=>d.exitNode(R,E),j(x),j(S),Z(()=>{A(h,1,ne),A(o,1,`${ne} placeholder:text-neutral-400 resize-none overflow-scroll`),A(b,1,B),A(F,1,`${B} float-left`),A(U,1,`${B} float-right`)}),re(h,()=>e(v),p=>f(v,p)),re(o,()=>e(i),p=>f(i,p)),M(r,S),Y()}Q(["change","click"]);var ht=O('<div class="w-[5px] bg-neutral-300 rounded-full m-3"></div>'),bt=O("<button><img/></button>"),_t=O('<div class="flex absolute rounded-xl bg-neutral-200 border-blue-300 border-2 p-[10px] pt-[5px] pb-[5px] h-fit bottom-6 left-[50%] transform -translate-[50%]"></div>');function wt(r,d){q(d,!0);let v=D(2),i=["node_add.png","node_edit.png","node_drag.png","","link_add.png","link_edit.png"];Oe(()=>{d.modeChanged(e(v))});var a=_t();st(a,21,()=>i,dt,(c,_,w)=>{var E=at(),R=rt(E);{var N=h=>{var o=ht();M(h,o)},S=h=>{var o=bt();o.__click=()=>f(v,w-i.slice(0,w).filter(g=>g==="").length);var y=W(o);j(o),Z((g,L,b)=>{A(o,1,`p-2.5 rounded-xl border-none outline-none transition duration-200 hover:bg-blue-300 ${g??""}`),ae(y,"src",`${Ge??""}/mode_icons/${e(_)??""}`),ae(y,"alt",L),A(y,1,b)},[()=>e(v)===w-i.slice(0,w).filter(g=>g==="").length?"bg-gray-500 mt-auto mb-auto":"mt-[10px] mb-[10px]",()=>i[w].split(".")[0],()=>ct(e(v)===w-i.slice(0,w).filter(g=>g==="").length?"max-w-[40px] rounded-xl":"max-w-[30px] rounded-lg")]),M(h,o)};X(R,h=>{e(_)===""?h(N):h(S,!1)})}M(c,E)}),j(a),M(r,a),Y()}Q(["click"]);var xt=O('<button aria-label="Close Menu"><i class="fa-solid fa-chevron-down"></i></button>'),kt=O('<button aria-label="Open Menu"><i class="fa-solid fa-chevron-up"></i></button>'),yt=O(`<div class="absolute bottom-1 left-1 transition duration-200"><!> <div class="flex flex-col gap-0 w-fit p-1 rounded-xl font-mono text-blue-300 bg-gray-800 border-2 border-blue-500"><p class="text-center">------------------ Edit Log ------------------</p> <textarea class="resize-none overflow-y-scroll text-wrap outline-none" readonly="" cols="48" rows="8">
        </textarea></div></div>`);function St(r,d){q(d,!0);let v=K([]),i,a=D(0),c=K([]),_=D(!0),w,E;const R=(m,x)=>{e(a)>0&&(v.splice(-e(a),e(a)),f(a,0)),c.push(m),v.push(x===void 0?m:m+`:
	`+x)},N=()=>{e(a)>c.length-1||(oe(a),v.push("Undo: "+c.at(-e(a))))},S=()=>{e(a)<1||(v.push("Redo: "+c.at(-e(a))),oe(a,-1))};Oe(()=>{i.value+=`
`+v.at(-1),i.scrollTop=i.scrollHeight}),ie(()=>{i.value=""});var h=yt(),o=W(h);{var y=m=>{var x=xt();x.__click=F=>{f(_,!1),w.style.bottom=`-${E.offsetHeight}px`},M(m,x)},g=m=>{var x=kt();x.__click=F=>{f(_,!0),w.style.bottom="4px"},M(m,x)};X(o,m=>{e(_)?m(y):m(g,!1)})}var L=k(o,2),b=k(W(L),2);return T(b,m=>i=m,()=>i),j(L),T(L,m=>E=m,()=>E),j(h),T(h,m=>w=m,()=>w),M(r,h),Y({log:R,undo:N,redo:S})}Q(["click"]);var Lt=O('<div class="flex flex-row gap-3 w-min h-min p-3 absolute top-1 left-1 text-2xl pointer-events-none"><button aria-label="Undo"><i class="fas fa-undo"></i></button> <button aria-label="Redo"><i class="fas fa-redo"></i></button></div>');function Dt(r,d){q(d,!0);var v=Lt(),i=W(v);i.__click=function(...c){var _;(_=d.undo)==null||_.apply(this,c)};var a=k(i,2);a.__click=function(...c){var _;(_=d.redo)==null||_.apply(this,c)},j(v),Z(()=>{A(i,1,`border-none rounded-full w-fit h-fit p-2 pt-0.5 pb-1 text-center ${d.undoable?"bg-gray-300":"bg-gray-400"} pointer-events-auto`),A(a,1,`border-none rounded-full w-fit h-fit p-2 pt-0.5 pb-1 text-center ${d.redoable?"bg-gray-300":"bg-gray-400"} pointer-events-auto`)}),M(r,v),Y()}Q(["click"]);var Et=O('<div class="flex flex-col gap-3.5 max-w-[350px] h-fit bg-neutral-950 text-white p-2.5 rounded-xl"><input type="text" placeholder="Link Title"/> <textarea rows="6" maxlength="400" placeholder="Link Description"></textarea> <div class="relative inline-block h-fit"><button>Save</button> <button>Exit</button></div></div>');function Nt(r,d){q(d,!0);let v=D(""),i=D(""),a,c,_=!1,w=!1;ie(()=>{a.value=d.link.name,c.value=d.link.description});const E=()=>{w=!0};var R=Et(),N=W(R);je(N),N.__change=E,T(N,g=>a=g,()=>a);var S=k(N,2);Pe(S),S.__change=E,T(S,g=>c=g,()=>c);var h=k(S,2),o=W(h);o.__click=()=>{_=d.saveLink(d.link,e(v),e(i))};var y=k(o,2);y.__click=()=>d.exitLink(_,w),j(h),j(R),Z(()=>{A(N,1,ne),A(S,1,`${ne} placeholder:text-neutral-400 resize-none overflow-scroll`),A(o,1,`${B} float-left`),A(y,1,`${B} float-right`)}),re(N,()=>e(v),g=>f(v,g)),re(S,()=>e(i),g=>f(i,g)),M(r,R),Y()}Q(["change","click"]);var It=O(`<style>body {
            overflow-y: hidden;
        }</style>`),At=r=>r.preventDefault(),Ct=O('<div id="canvas-box" class="relative inline-block overflow-hidden"><canvas tabindex="0"></canvas> <div class="absolute right-2.5 bottom-15"><!></div> <div class="absolute right-2.5 bottom-2.5"><button aria-label="Save Image">Save Image</button> <button aria-label="Save Graph">Save Graph</button> <button aria-label="Load Graph">Load Graph</button> <input type="file" accept=".json"/></div> <!> <!> <!> <!></div>');function zt(r,d){q(d,!0);const v=()=>{const t=e(y).at(-e(g))??e(o);if(f(o,te(t),!0),L.length!==e(o).nodes.length){for(;L.length<e(o).nodes.length;)L.push(new Image);for(;L.length>e(o).nodes.length;)L.pop()}e(o).nodes.forEach((l,s)=>{L[s].src=l.image});const n=e(o).nodes.findIndex(l=>l.id===e(b));n?f(b,n,!0):f(b,-1)};let i,a=new J(0,0),c=1;const _=.5,w=2;let E=D(!1),R,N,S,h=new J(0,0),o=D(K({nodes:[{id:0,name:"Node",description:"",image:"",position:[200,300]}],links:[]})),y=D(K([{nodes:[{id:0,name:"Node",description:"",image:"",position:[200,300]}],links:[]}])),g=D(1),L=[],b=D(-1),m=D(!1),x=D(!1),F=D(-1),U=D(!1),p,C=D(!1),z=D(0),I;const we=()=>{const t=i.getContext("2d");if(t===null)throw new Error("DRAW LOOP - ctx is null");i.width=window.innerWidth,i.height=window.innerHeight,t.clearRect(0,0,i.width,i.height),t.setTransform(c,0,0,c,-a.x,-a.y),e(C)&&(t.beginPath(),t.moveTo(e(o).nodes[e(b)].position[0],e(o).nodes[e(b)].position[1]),t.lineTo(S.x,S.y),t.lineWidth=10,t.strokeStyle="rgba(0, 0, 0, 0.35)",t.stroke()),e(o).links.forEach(n=>{t.beginPath();const l=e(o).nodes.find(u=>u.id===n.from)??e(o).nodes[0],s=e(o).nodes.find(u=>u.id===n.to)??e(o).nodes[0];t.moveTo(l.position[0],l.position[1]),t.lineTo(s.position[0],s.position[1]),t.lineWidth=10,t.strokeStyle="black",t.stroke()}),e(o).nodes.forEach((n,l)=>{const s=J.fromArray(n.position),u=25;t.beginPath(),t.arc(s.x,s.y,20,0,Math.PI*2),t.fillStyle="black",t.fill(),t.drawImage(L[l],s.x-u/2,s.y-u/2,u,u)}),requestAnimationFrame(we)},We=t=>{if(e(x)||e(U))return;const n=Ue(t,i,a,c);let l=e(o).nodes.find(u=>J.fromArray(u.position).distanceSq(n)<400);l&&f(b,l.id,!0);let s=e(o).links.find(u=>{const G=e(o).nodes[u.from],P=e(o).nodes[u.to];return ft(J.fromArray(G.position),J.fromArray(P.position),n)<10});if(s&&f(F,e(o).links.indexOf(s),!0),t.button===0){if(e(z)===0){if(!l)e(o).nodes.push({id:-1,name:"",description:"",image:"",position:n.toArray()}),de(),L.push(new Image),H(),I.log("Create node");else if(window.confirm("Delete node and its links?")){const u=l.id;e(o).nodes.splice(u,1),f(b,0),L.splice(u,1);let G=[];e(o).links.forEach((P,ee)=>{(P.from===u||P.to===u)&&G.push(ee)});for(const P of G)e(o).links.splice(P,1);de(),H(),I.log("Delete node",`Node ID: ${u}, ${G.length} links destroyed`)}}else if(e(z)===1){if(!l)return;f(x,!0)}else if(e(z)===2){if(!l)return;h=n.clone().subtract(J.fromArray(e(o).nodes[e(b)].position)),f(m,!0)}else if(e(z)===3)if(l)if(e(C)){if(p.id===e(b)||e(o).links.filter(u=>u.from===p.id&&u.to===e(b)||u.from===e(b)&&u.to===p.id).length!==0)return;e(o).links.push({from:p.id,to:e(b),name:"",description:""}),f(C,!1),H(),I.log("Create link",`node ${p.id} -> ${e(b)}`)}else p=l,f(C,!0),S=n;else{if(!s)return;e(o).links.splice(e(F),1),H(),I.log("Delete link",`node ${p.id} -> ${e(b)}`)}else if(e(z)===4){if(!s)return;f(U,!0)}}t.button===2&&(f(E,!0),R=he(t,i),N=a.clone())},ze=t=>{if(e(x)||e(U))return;const n=Ue(t,i,a,c);if(S=n,e(m)){let l=e(o).nodes.find(s=>s.id===e(b));if(!l)throw new Error("uhhh focusNode error, it's not in the list...");l.position=n.clone().subtract(h).toArray()}else if(e(E)){const s=he(t,i).clone().subtract(R);a=N.clone().subtract(s)}},Fe=t=>{e(x)||e(U)||(e(m)&&(f(m,!1),H(),I.log("Set node position")),f(E,!1))},Ve=t=>{t.preventDefault();const n=he(t,i),l=n.clone().add(a).divideScalar(c),s=Math.sign(t.deltaY);c-=s*.125,c=Math.max(_,Math.min(w,c)),a=l.clone().multiplyScalar(c).subtract(n)},Be=t=>{t.key==="Escape"&&e(C)&&f(C,!1),t.ctrlKey&&(t.key==="o"&&(t.preventDefault(),$.click()),t.key==="s"&&(t.preventDefault(),ye()),t.key==="z"&&xe(),t.key==="y"&&ke(),t.shiftKey&&t.key==="s"&&(t.preventDefault(),Se()))},He=(t,n,l,s)=>{let u=[t.name===n?"":"name",t.image===s?"":"image",t.description===l?"":"description"],G=[];u.forEach(Ae=>{Ae!==""&&G.push(Ae)});const P=G.join(", ");if(P===""||!window.confirm("Save this node with new contents?"))return!1;t.name=n,t.image=s;const ee=e(o).nodes.indexOf(t);return ee!==-1&&(L[ee].src=t.image),H(),I.log("Update node contents",P),!0},Je=(t,n)=>{!t&&n&&!window.confirm("Stop editing without saving?")||f(x,!1)},Ke=(t,n,l)=>{let s=[t.name===n?"":"name",t.description===l?"":"description"],u=[];s.forEach(P=>{P!==""&&u.push(P)});const G=u.join(", ");return G===""||!window.confirm("Save this node with new contents?")?!1:(t.name=n,t.description=l,H(),I.log("Update node contents",G),!0)},Ze=(t,n)=>{!t&&n&&!window.confirm("Stop editing without saving?")||f(U,!1)},H=()=>{e(g)>1&&(e(y).splice(-e(g)+1,e(g)-1),f(g,1)),e(y).push(te(e(o))),console.log(e(y)),console.log(e(g))};let le=Ce(()=>e(g)<e(y).length),se=Ce(()=>e(g)>1);const xe=()=>{e(x)||e(U)||e(le)&&(oe(g),v(),I.undo(),console.log(e(y)),console.log(e(g)))},ke=()=>{e(x)||e(U)||e(se)&&(oe(g,-1),v(),I.redo(),console.log(e(y)),console.log(e(g)))},qe=t=>{if(e(x)||e(U))return;const n=t.target;if(!n.files||n.files.length===0)return;const l=n.files[0],s=new FileReader;s.onload=()=>{if(typeof s.result=="string")try{const u=JSON.parse(s.result);if(!u.nodes||!u.links)throw new Error("Invalid graph data");f(o,te(u),!0),de(),f(g,1),f(y,[te(e(o))],!0),v(),I.log("Load new graph data")}catch(u){alert("Failed to load graph: "+u.message)}},s.readAsText(l)},ye=()=>{if(window.confirm("Download new JSON?")){const t=JSON.stringify(e(o),null,4),n=new Blob([t],{type:"application/json"}),l=URL.createObjectURL(n),s=document.createElement("a");s.href=l,s.download="graph.json",s.click(),URL.revokeObjectURL(l)}},Se=()=>{if(window.confirm("Download image? It will look as your canvas does now.")){const t=document.createElement("a");t.href=i.toDataURL("image/png"),t.download="graph.png",t.click()}};let $,Le;const de=()=>{if(e(x)||e(U))return;const t=new Map(e(o).nodes.map((n,l)=>[n.id,l]));e(o).nodes.forEach((n,l)=>n.id=l),e(o).links.forEach(n=>{console.log(`${n.from}, ${n.to}`),n.from=t.get(n.from)??n.from,n.to=t.get(n.to)??n.to,console.log(`${n.from}, ${n.to}`)})};ie(()=>{L=e(o).nodes.map(t=>{let n=new Image;return n.src=t.image,n}),we()});var ce=Ct();lt(t=>{var n=It();Me.title="Graph Editor",M(t,n)}),Re("keydown",Me,Be);var V=W(ce);let De;V.__mousemove=ze,V.__mousedown=We,V.__mouseup=Fe,V.__contextmenu=[At],T(V,t=>i=t,()=>i);var ue=k(V,2),Ye=W(ue);{var Qe=t=>{pt(t,{get node(){return e(o).nodes[e(b)]},saveNode:He,exitNode:Je})},Xe=(t,n)=>{{var l=s=>{Nt(s,{get link(){return e(o).links[e(F)]},saveLink:Ke,exitLink:Ze})};X(t,s=>{e(U)&&s(l)},n)}};X(Ye,t=>{e(x)?t(Qe):t(Xe,!1)})}j(ue);var fe=k(ue,2),ge=W(fe);ge.__click=Se;var ve=k(ge,2);ve.__click=ye;var me=k(ve,2);me.__click=t=>$.click();var pe=k(me,2);pe.__change=qe,Te(pe,"",{},{display:"none"}),T(pe,t=>$=t,()=>$),j(fe);var Ee=k(fe,2);T(St(Ee,{}),t=>I=t,()=>I);var Ne=k(Ee,2);Dt(Ne,{undo:xe,redo:ke,get undoable(){return e(le)},set undoable(t){f(le,t)},get redoable(){return e(se)},set redoable(t){f(se,t)}});var Ie=k(Ne,2);T(wt(Ie,{modeChanged:t=>f(z,t,!0)}),t=>Le=t,()=>Le);var $e=k(Ie,2);ut($e,{controls:{"Right Click and Drag":"move viewport","Scroll Wheel":"zoom in and out","Ctrl-Z":"undo","Ctrl-Y":"redo","Ctrl-O":"open graph","Ctrl-S":"save graph","Ctrl-Shift-S":"save graph as image"},get mode(){return e(z)},set mode(t){f(z,t,!0)}}),j(ce),Z(t=>{De=A(V,1,"bg-neutral-100",null,De,t),A(ge,1,B),A(ve,1,B),A(me,1,B)},[()=>({"cursor-grabbing":e(m)||e(E)})]),Re("wheel",V,Ve),M(r,ce),Y()}Q(["mousemove","mousedown","mouseup","contextmenu","click","change"]);export{zt as component};
