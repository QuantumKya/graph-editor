import"../chunks/CWj6FrbW.js";import"../chunks/CwZKfcDM.js";import{a as Vt,l as Wt,d as et,o as yt,r as Gt,c as Kt,e as $t}from"../chunks/BYhcaexx.js";import{a4 as jt,b as Jt,s as st,h as T,M as Zt,a as Qt,A as u,ak as te,r as ee,c as re,d as mt,f as ut,j as J,Y as ne,$ as oe,g as Tt,i as Dt,p as ie,aw as lt,a2 as It,R as bt,ax as ae,as as se,ay as _t,az as ue,aA as le,N as fe,aB as ce,aC as de,aD as he,aE as pe,Z as ye,W as ge,aF as ve,aG as xe,aH as me,aI as be,aJ as _e,aK as we,u as Ae,l as Me,D as rt,at as X,al as V,F as B,J as W,L as Y,am as E,K as H,t as U,I as nt,G as tt,x as Yt,aL as wt}from"../chunks/BKZJkl96.js";import{b as $,i as Xt}from"../chunks/4slWvAw0.js";import{b as zt}from"../chunks/DkNz5Rt6.js";function Se(r,n){return n}function Ee(r,n,e,o){for(var i=[],a=n.length,c=0;c<a;c++)le(n[c].e,i,!0);var t=a>0&&i.length===0&&e!==null;if(t){var s=e.parentNode;fe(s),s.append(e),o.clear(),L(r,n[0].prev,n[a-1].next)}ce(i,()=>{for(var h=0;h<a;h++){var d=n[h];t||(o.delete(d.k),L(r,d.prev,d.next)),de(d.e,!t)}})}function ke(r,n,e,o,i,a=null){var c=r,t={flags:n,items:new Map,first:null};{var s=r;c=T?st(Zt(s)):s.appendChild(jt())}T&&Qt();var h=null,d=!1,x=te(()=>{var f=e();return ge(f)?f:f==null?[]:It(f)});Jt(()=>{var f=u(x),v=f.length;if(d&&v===0)return;d=v===0;let p=!1;if(T){var A=ee(c)===re;A!==(v===0)&&(c=mt(),st(c),ut(!1),p=!0)}if(T){for(var b=null,g,_=0;_<v;_++){if(J.nodeType===ne&&J.data===oe){c=J,p=!0,ut(!1);break}var I=f[_],k=o(I,_);g=Ct(J,t,b,null,I,k,_,i,n,e),t.items.set(k,g),b=g}v>0&&st(mt())}T||Ne(f,t,c,i,n,o,e),a!==null&&(v===0?h?Tt(h):h=Dt(()=>a(c)):h!==null&&ie(h,()=>{h=null})),p&&ut(!0),u(x)}),T&&(c=J)}function Ne(r,n,e,o,i,a,c){var t=r.length,s=n.items,h=n.first,d=h,x,f=null,v=[],p=[],A,b,g,_;for(_=0;_<t;_+=1){if(A=r[_],b=a(A,_),g=s.get(b),g===void 0){var I=d?d.e.nodes_start:e;f=Ct(I,n,f,f===null?n.first:f.next,A,b,_,o,i,c),s.set(b,f),v=[],p=[],d=f.next;continue}if(Te(g,A,_),(g.e.f&lt)!==0&&Tt(g.e),g!==d){if(x!==void 0&&x.has(g)){if(v.length<p.length){var k=p[0],S;f=k.prev;var N=v[0],z=v[v.length-1];for(S=0;S<v.length;S+=1)At(v[S],k,e);for(S=0;S<p.length;S+=1)x.delete(p[S]);L(n,N.prev,z.next),L(n,f,N),L(n,z,k),d=k,f=z,_-=1,v=[],p=[]}else x.delete(g),At(g,d,e),L(n,g.prev,g.next),L(n,g,f===null?n.first:f.next),L(n,f,g),f=g;continue}for(v=[],p=[];d!==null&&d.k!==b;)(d.e.f&lt)===0&&(x??(x=new Set)).add(d),p.push(d),d=d.next;if(d===null)continue;g=d}v.push(g),f=g,d=g.next}if(d!==null||x!==void 0){for(var O=x===void 0?[]:It(x);d!==null;)(d.e.f&lt)===0&&O.push(d),d=d.next;var M=O.length;if(M>0){var D=t===0?e:null;Ee(n,O,D,s)}}bt.first=n.first&&n.first.e,bt.last=f&&f.e}function Te(r,n,e,o){ae(r.v,n),r.i=e}function Ct(r,n,e,o,i,a,c,t,s,h){var d=(s&he)!==0,x=(s&pe)===0,f=d?x?se(i,!1,!1):_t(i):i,v=(s&ue)===0?c:_t(c),p={i:v,v:f,k:a,a:null,e:null,prev:e,next:o};try{return p.e=Dt(()=>t(r,f,v,h),T),p.e.prev=e&&e.e,p.e.next=o&&o.e,e===null?n.first=p:(e.next=p,e.e.next=p.e),o!==null&&(o.prev=p,o.e.prev=p.e),p}finally{}}function At(r,n,e){for(var o=r.next?r.next.e.nodes_start:e,i=n?n.e.nodes_start:e,a=r.e.nodes_start;a!==o;){var c=ye(a);i.before(a),a=c}}function L(r,n,e){n===null?r.first=e:(n.next=e,n.e.next=e&&e.e),e!==null&&(e.prev=n,e.e.prev=n&&n.e)}function Pt(r){var n,e,o="";if(typeof r=="string"||typeof r=="number")o+=r;else if(typeof r=="object")if(Array.isArray(r)){var i=r.length;for(n=0;n<i;n++)r[n]&&(e=Pt(r[n]))&&(o&&(o+=" "),o+=e)}else for(e in r)r[e]&&(o&&(o+=" "),o+=e);return o}function De(){for(var r,n,e=0,o="",i=arguments.length;e<i;e++)(r=arguments[e])&&(n=Pt(r))&&(o&&(o+=" "),o+=n);return o}function Ie(r){return typeof r=="object"?De(r):r??""}const Mt=[...` 	
\r\fÂ \v\uFEFF`];function Ye(r,n,e){var o=r==null?"":""+r;if(n&&(o=o?o+" "+n:n),e){for(var i in e)if(e[i])o=o?o+" "+i:i;else if(o.length)for(var a=i.length,c=0;(c=o.indexOf(i,c))>=0;){var t=c+a;(c===0||Mt.includes(o[c-1]))&&(t===o.length||Mt.includes(o[t]))?o=(c===0?"":o.substring(0,c))+o.substring(t+1):c=t}}return o===""?null:o}function St(r,n=!1){var e=n?" !important;":";",o="";for(var i in r){var a=r[i];a!=null&&a!==""&&(o+=" "+i+": "+a+e)}return o}function Xe(r,n){if(n){var e="",o,i;return Array.isArray(n)?(o=n[0],i=n[1]):o=n,o&&(e+=St(o)),i&&(e+=St(i,!0)),e=e.trim(),e===""?null:e}return String(r)}function P(r,n,e,o,i,a){var c=r.__className;if(T||c!==e||c===void 0){var t=Ye(e,o,a);(!T||t!==r.getAttribute("class"))&&(t==null?r.removeAttribute("class"):r.className=t),r.__className=e}else if(a&&i!==a)for(var s in a){var h=!!a[s];(i==null||h!==!!i[s])&&r.classList.toggle(s,h)}return a}function ft(r,n={},e,o){for(var i in e){var a=e[i];n[i]!==a&&(e[i]==null?r.style.removeProperty(i):r.style.setProperty(i,a,o))}}function ze(r,n,e,o){var i=r.__style;if(T||i!==n){var a=Xe(n,o);(!T||a!==r.getAttribute("style"))&&(a==null?r.removeAttribute("style"):r.style.cssText=a),r.__style=n}else o&&(Array.isArray(o)?(ft(r,e==null?void 0:e[0],o[0]),ft(r,e==null?void 0:e[1],o[1],"important")):ft(r,e,o));return o}const Ce=Symbol("is custom element"),Pe=Symbol("is html");function Oe(r){if(T){var n=!1,e=()=>{if(!n){if(n=!0,r.hasAttribute("value")){var o=r.value;j(r,"value",null),r.value=o}if(r.hasAttribute("checked")){var i=r.checked;j(r,"checked",null),r.checked=i}}};r.__on_r=e,be(e),Vt()}}function j(r,n,e,o){var i=qe(r);T&&(i[n]=r.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&r.nodeName==="LINK")||i[n]!==(i[n]=e)&&(n==="loading"&&(r[ve]=e),e==null?r.removeAttribute(n):typeof e!="string"&&Re(r).includes(n)?r[n]=e:r.setAttribute(n,e))}function qe(r){return r.__attributes??(r.__attributes={[Ce]:r.nodeName.includes("-"),[Pe]:r.namespaceURI===xe})}var Et=new Map;function Re(r){var n=Et.get(r.nodeName);if(n)return n;Et.set(r.nodeName,n=[]);for(var e,o=r,i=Element.prototype;i!==o;){e=_e(o);for(var a in e)e[a].set&&n.push(a);o=me(o)}return n}function kt(r,n,e=n){var o=we();Wt(r,"input",i=>{var a=i?r.defaultValue:r.value;if(a=ct(r)?dt(a):a,e(a),o&&a!==(a=n())){var c=r.selectionStart,t=r.selectionEnd;r.value=a??"",t!==null&&(r.selectionStart=c,r.selectionEnd=Math.min(t,r.value.length))}}),(T&&r.defaultValue!==r.value||Ae(n)==null&&r.value)&&e(ct(r)?dt(r.value):r.value),Me(()=>{var i=n();ct(r)&&i===dt(r.value)||r.type==="date"&&!i&&!r.value||i!==r.value&&(r.value=i??"")})}function ct(r){var n=r.type;return n==="number"||n==="range"}function dt(r){return r===""?null:+r}var Le=B('<img alt="Uploaded Icon" class="rounded-lg w-[300px]"/>'),Ue=B('<img alt="Uploaded Icon" class="rounded-lg w-[300px]"/>'),He=B('<div class="flex flex-col gap-3.5 max-w-[350px] h-fit bg-neutral-950 text-white p-2.5 rounded-xl"><input type="text" placeholder="Node Title"/> <button>Upload Image</button> <input type="file" accept="image/*"/> <!> <textarea rows="6" maxlength="400" placeholder="Node Description"></textarea> <div class="relative inline-block h-fit"><button>Save</button> <button>Exit</button></div></div>');function Be(r,n){rt(n,!0);const e=n.nodes[n.node_id];let o=X(V(e.name)),i=X(V(e.description)),a=X(V(e.image)),c,t,s,h=!1,d=!1;yt(()=>{t.value=e.name,s.value=e.description});const x=()=>{h=!0},f="bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700",v="font-mono text-lg bg-neutral-800 text-white rounded-xl p-2 pl-3 transition duration-300 focus:bg-gray-700 focus:ring-2 focus:ring-blue-500 outline-none";var p=He(),A=W(p);Oe(A),P(A,1,v),A.__change=x,$(A,M=>t=M,()=>t);var b=Y(A,2);P(b,1,f),b.__click=M=>{c.click()};var g=Y(b,2);g.__change=M=>{const D=M.target;if(!D.files||D.files.length===0)return;const ot=D.files[0],G=new FileReader;G.onload=()=>{typeof G.result=="string"&&E(a,G.result,!0)},G.readAsDataURL(ot),x()},ze(g,"",{},{display:"none"}),$(g,M=>c=M,()=>c);var _=Y(g,2);{var I=M=>{var D=Le();tt(()=>j(D,"src",u(a))),U(M,D)},k=M=>{var D=Ue();tt(()=>j(D,"src",`${zt??""}/landscape-placeholder.svg`)),U(M,D)};Xt(_,M=>{u(a)!=""?M(I):M(k,!1)})}var S=Y(_,2);Gt(S),P(S,1,"font-mono text-lg bg-neutral-800 text-white rounded-xl p-2 pl-3 transition duration-300 focus:bg-gray-700 focus:ring-2 focus:ring-blue-500 outline-none placeholder:text-neutral-400 resize-none overflow-scroll"),S.__change=x,$(S,M=>s=M,()=>s);var N=Y(S,2),z=W(N);P(z,1,"bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700 float-left"),z.__click=()=>{d=n.saveNode(n.node_id,u(o),u(i),u(a))};var O=Y(z,2);P(O,1,"bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700 float-right"),O.__click=()=>n.exitNode(d,h),H(N),H(p),kt(A,()=>u(o),M=>E(o,M)),kt(S,()=>u(i),M=>E(i,M)),U(r,p),nt()}et(["change","click"]);var Fe=B("<button><img/></button>"),Ve=B('<div class="flex absolute rounded-xl bg-neutral-200 border-blue-300 border-2 p-[15px] pt-[5px] pb-[5px] h-fit bottom-6 left-[50%] transform -translate-[50%]"></div>');function We(r,n){rt(n,!0);let e=X(2),o=["node_add.png","node_edit.png","node_drag.png","link.png"];const i=Kt();Yt(()=>{i("modeChanged",u(e))});var a=Ve();ke(a,21,()=>o,Se,(c,t,s)=>{var h=Fe();h.__click=()=>E(e,s,!0);var d=W(h);H(h),tt(x=>{P(h,1,`p-2.5 rounded-xl border-none outline-none transition duration-200 hover:bg-blue-300 ${u(e)===s?"bg-gray-500 mt-auto mb-auto":"mt-[10px] mb-[10px]"}`),j(d,"src",`${zt??""}/mode_icons/${u(t)??""}`),j(d,"alt",x),P(d,1,Ie(u(e)===s?"max-w-[40px] rounded-xl":"max-w-[30px] rounded-lg"))},[()=>o[u(e)].split(".")[0]]),U(c,h)}),H(a),U(r,a),nt()}et(["click"]);function Ge(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var ht={exports:{}},Nt;function Ke(){return Nt||(Nt=1,function(r,n){r.exports=e;function e(t,s){if(!(this instanceof e))return new e(t,s);this.x=t||0,this.y=s||0}e.fromArray=function(t){return new e(t[0]||0,t[1]||0)},e.fromObject=function(t){return new e(t.x||0,t.y||0)},e.prototype.addX=function(t){return this.x+=t.x,this},e.prototype.addY=function(t){return this.y+=t.y,this},e.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},e.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this},e.prototype.addScalarX=function(t){return this.x+=t,this},e.prototype.addScalarY=function(t){return this.y+=t,this},e.prototype.subtractX=function(t){return this.x-=t.x,this},e.prototype.subtractY=function(t){return this.y-=t.y,this},e.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},e.prototype.subtractScalar=function(t){return this.x-=t,this.y-=t,this},e.prototype.subtractScalarX=function(t){return this.x-=t,this},e.prototype.subtractScalarY=function(t){return this.y-=t,this},e.prototype.divideX=function(t){return this.x/=t.x,this},e.prototype.divideY=function(t){return this.y/=t.y,this},e.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this},e.prototype.divideScalar=function(t){return t!==0?(this.x/=t,this.y/=t):(this.x=0,this.y=0),this},e.prototype.divideScalarX=function(t){return t!==0?this.x/=t:this.x=0,this},e.prototype.divideScalarY=function(t){return t!==0?this.y/=t:this.y=0,this},e.prototype.invertX=function(){return this.x*=-1,this},e.prototype.invertY=function(){return this.y*=-1,this},e.prototype.invert=function(){return this.invertX(),this.invertY(),this},e.prototype.multiplyX=function(t){return this.x*=t.x,this},e.prototype.multiplyY=function(t){return this.y*=t.y,this},e.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},e.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},e.prototype.multiplyScalarX=function(t){return this.x*=t,this},e.prototype.multiplyScalarY=function(t){return this.y*=t,this},e.prototype.normalize=function(){var t=this.length();return t===0?(this.x=1,this.y=0):this.divide(e(t,t)),this},e.prototype.norm=e.prototype.normalize,e.prototype.limit=function(t,s){return Math.abs(this.x)>t&&(this.x*=s),Math.abs(this.y)>t&&(this.y*=s),this},e.prototype.randomize=function(t,s){return this.randomizeX(t,s),this.randomizeY(t,s),this},e.prototype.randomizeX=function(t,s){var h=Math.min(t.x,s.x),d=Math.max(t.x,s.x);return this.x=i(h,d),this},e.prototype.randomizeY=function(t,s){var h=Math.min(t.y,s.y),d=Math.max(t.y,s.y);return this.y=i(h,d),this},e.prototype.randomizeAny=function(t,s){return Math.round(Math.random())?this.randomizeX(t,s):this.randomizeY(t,s),this},e.prototype.unfloat=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},e.prototype.toFixed=function(t){return typeof t>"u"&&(t=8),this.x=this.x.toFixed(t),this.y=this.y.toFixed(t),this},e.prototype.mixX=function(t,s){return typeof s>"u"&&(s=.5),this.x=(1-s)*this.x+s*t.x,this},e.prototype.mixY=function(t,s){return typeof s>"u"&&(s=.5),this.y=(1-s)*this.y+s*t.y,this},e.prototype.mix=function(t,s){return this.mixX(t,s),this.mixY(t,s),this},e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.copyX=function(t){return this.x=t.x,this},e.prototype.copyY=function(t){return this.y=t.y,this},e.prototype.copy=function(t){return this.copyX(t),this.copyY(t),this},e.prototype.zero=function(){return this.x=this.y=0,this},e.prototype.dot=function(t){return this.x*t.x+this.y*t.y},e.prototype.cross=function(t){return this.x*t.y-this.y*t.x},e.prototype.projectOnto=function(t){var s=(this.x*t.x+this.y*t.y)/(t.x*t.x+t.y*t.y);return this.x=s*t.x,this.y=s*t.y,this},e.prototype.horizontalAngle=function(){return Math.atan2(this.y,this.x)},e.prototype.horizontalAngleDeg=function(){return a(this.horizontalAngle())},e.prototype.verticalAngle=function(){return Math.atan2(this.x,this.y)},e.prototype.verticalAngleDeg=function(){return a(this.verticalAngle())},e.prototype.angle=e.prototype.horizontalAngle,e.prototype.angleDeg=e.prototype.horizontalAngleDeg,e.prototype.direction=e.prototype.horizontalAngle,e.prototype.rotate=function(t){var s=this.x*Math.cos(t)-this.y*Math.sin(t),h=this.x*Math.sin(t)+this.y*Math.cos(t);return this.x=s,this.y=h,this},e.prototype.rotateDeg=function(t){return t=c(t),this.rotate(t)},e.prototype.rotateTo=function(t){return this.rotate(t-this.angle())},e.prototype.rotateToDeg=function(t){return t=c(t),this.rotateTo(t)},e.prototype.rotateBy=function(t){var s=this.angle()+t;return this.rotate(s)},e.prototype.rotateByDeg=function(t){return t=c(t),this.rotateBy(t)},e.prototype.distanceX=function(t){return this.x-t.x},e.prototype.absDistanceX=function(t){return Math.abs(this.distanceX(t))},e.prototype.distanceY=function(t){return this.y-t.y},e.prototype.absDistanceY=function(t){return Math.abs(this.distanceY(t))},e.prototype.distance=function(t){return Math.sqrt(this.distanceSq(t))},e.prototype.distanceSq=function(t){var s=this.distanceX(t),h=this.distanceY(t);return s*s+h*h},e.prototype.length=function(){return Math.sqrt(this.lengthSq())},e.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},e.prototype.magnitude=e.prototype.length,e.prototype.isZero=function(){return this.x===0&&this.y===0},e.prototype.isEqualTo=function(t){return this.x===t.x&&this.y===t.y},e.prototype.toString=function(){return"x:"+this.x+", y:"+this.y},e.prototype.toArray=function(){return[this.x,this.y]},e.prototype.toObject=function(){return{x:this.x,y:this.y}};var o=180/Math.PI;function i(t,s){return Math.floor(Math.random()*(s-t+1)+t)}function a(t){return t*o}function c(t){return t/o}}(ht)),ht.exports}var $e=Ke();const R=Ge($e),je=[{id:0,name:"Addition",description:"",image:"",position:[100,100]},{id:1,name:"Subtraction",description:"",image:"",position:[300,150]},{id:2,name:"Multiplication",description:"",image:"",position:[200,300]},{id:3,name:"Division",description:"",image:"",position:[300,450]}],Je=[{from:0,to:1},{from:0,to:2},{from:2,to:3}],pt={nodes:je,links:Je};var Ze=B(`<div class="flex flex-col gap-0 absolute w-fit p-1 rounded-xl bottom-1 left-1 font-mono text-blue-300 bg-gray-700"><p class="text-center">------------------ Edit Log ------------------</p> <textarea class="resize-none h-[200px] max-h-[350px] overflow-y-scroll text-wrap outline-none" readonly="" cols="48">
    </textarea></div>`);function Qe(r,n){rt(n,!0);let e=V([]),o,i=X(0),a=V([]);const c=(x,f)=>{u(i)>0&&(e.splice(-u(i),u(i)),E(i,0)),a.push(x),e.push(f===void 0?x:x+`:
	`+f)},t=()=>{u(i)>a.length-1||(wt(i),e.push("Undo: "+a.at(-u(i))))},s=()=>{u(i)<1||(e.push("Redo: "+a.at(-u(i))),wt(i,-1))};Yt(()=>{o.value+=`
`+e.at(-1),o.scrollTop=o.scrollHeight}),yt(()=>{o.value=""});var h=Ze(),d=Y(W(h),2);return $(d,x=>o=x,()=>o),H(h),U(r,h),nt({log:c,undo:t,redo:s})}var tr=B('<div class="flex flex-row gap-3 w-min h-min p-3 absolute top-1 left-1 text-2xl"><button aria-label="Undo"><i class="fas fa-undo"></i></button> <button aria-label="Redo"><i class="fas fa-redo"></i></button></div>');function er(r,n){const e="border-none rounded-full w-fit h-fit bg-gray-300 p-2 pt-0.5 pb-1 text-center";var o=tr(),i=W(o);P(i,1,e),i.__click=function(...c){var t;(t=n.undo)==null||t.apply(this,c)};var a=Y(i,2);P(a,1,e),a.__click=function(...c){var t;(t=n.redo)==null||t.apply(this,c)},H(o),U(r,o)}et(["click"]);const rr=(r,n)=>{r.key=="Escape"&&u(n)&&E(n,!1)};var nr=r=>r.preventDefault(),or=B('<div id="canvas-box" class="relative inline-block overflow-hidden"><canvas tabindex="0"></canvas> <div class="absolute right-2.5 top-2.5"><!></div> <!> <!> <!></div>');function ir(r,n){rt(n,!0);const e=l=>({nodes:l.nodes.map(y=>({...y,position:[...y.position]})),links:l.links.map(y=>({...y}))}),o=()=>{const l=v.at(-p)??u(f);if(E(f,e(l),!0),A.length!==u(f).nodes.length){for(;A.length<u(f).nodes.length;)A.push(new Image);for(;A.length>u(f).nodes.length;)A.pop()}u(f).nodes.forEach((m,w)=>{A[w].src=m.image});const y=u(f).nodes.find(m=>m.id===u(b).id);y?E(b,y,!0):E(b,u(f).nodes[0],!0)};let i,a=new R(0,0),c=1,t=X(!1),s,h,d,x=new R(0,0),f=X(V(e(pt))),v=[e(pt)],p=1,A=[],b=X(V(pt.nodes[0])),g=X(!1),_=X(!1),I,k=X(!1),S=0,N;const z=()=>{const l=i.getContext("2d");if(l===null)throw new Error("DRAW LOOP - ctx is null");i.width=window.innerWidth,i.height=window.innerHeight,l.clearRect(0,0,i.width,i.height),u(k)&&(l.beginPath(),l.moveTo(u(b).position[0]-a.x,u(b).position[1]-a.y),l.lineTo(d.x,d.y),l.lineWidth=10,l.strokeStyle="rgba(0, 0, 0, 0.35)",l.stroke()),u(f).links.forEach(y=>{l.beginPath();const m=u(f).nodes[y.from],w=u(f).nodes[y.to];l.moveTo(m.position[0]-a.x,m.position[1]-a.y),l.lineTo(w.position[0]-a.x,w.position[1]-a.y),l.lineWidth=10,l.strokeStyle="black",l.stroke()}),u(f).nodes.forEach((y,m)=>{A[m].src=y.image;const w=R.fromArray(y.position).subtract(a),C=25;l.beginPath(),l.arc(w.x,w.y,20,0,Math.PI*2),l.fillStyle="black",l.fill(),l.drawImage(A[m],w.x-C/2,w.y-C/2,C,C)}),requestAnimationFrame(z)},O=l=>{const y=i.getBoundingClientRect(),m=(l.clientX-y.left+a.x)/c,w=(l.clientY-y.top+a.y)/c;return new R(m,w)},M=(l,y,m)=>{const w=y.clone().subtract(l),F=m.clone().subtract(l).dot(w)/w.lengthSq();if(F<0||F>1)return 1e6;const K=Math.abs(y.clone().subtract(l).cross(m.clone().subtract(l))),Q=y.clone().subtract(l).length();return K/Q},D=l=>{if(u(_))return;const y=O(l);let m=u(f).nodes.find(w=>R.fromArray(w.position).distanceSq(y)<400);if(E(b,m??u(b),!0),l.button===0){if(S===1){if(!m)return;E(_,!0)}else if(S===2){if(!m)return;x=y.clone().subtract(R.fromArray(u(b).position)),E(g,!0)}else if(S===3)if(m)if(u(k)){if(I.id===u(b).id)return;u(f).links.push({from:I.id,to:u(b).id}),E(k,!1),Z(),N.log("Create link",`node ${I.id} -> ${u(b).id}`)}else I=m,E(k,!0),d=y;else{const w=u(f).links.findIndex(C=>{const F=u(f).nodes[C.from],K=u(f).nodes[C.to];return M(R.fromArray(F.position),R.fromArray(K.position),y)<10});w!==-1&&(u(f).links.splice(w,1),Z(),N.log("Delete link",`node ${I.id} -> ${u(b).id}`))}}l.button===2&&(E(t,!0),s=y,h=a.clone())},ot=l=>{if(u(_))return;const y=O(l);if(d=y,u(g)){let m=u(f).nodes.find(w=>w.id===u(b).id);if(m===void 0)throw new Error("uhhh focusNode error, it's not in the list...");m.position=y.clone().subtract(x).toArray()}else if(u(t)){const m=y.clone().subtract(s);a=h.clone().subtract(m)}},G=l=>{u(_)||(u(g)&&(E(g,!1),Z(),N.log("Set node position")),E(t,!1))},Ot=l=>{l.preventDefault()},qt=(l,y,m,w)=>{let C=[u(f).nodes[l].name===y?"":"name",u(f).nodes[l].description===m?"":"description",u(f).nodes[l].image===w?"":"image"],F=[];C.forEach(Q=>{Q!==""&&F.push(Q)});const K=F.join(", ");return K===""||!window.confirm("Save this node with new contents?")?!1:(u(f).nodes[l].name=y,u(f).nodes[l].description=m,u(f).nodes[l].image=w,Z(),N.log("Update node contents",K),!0)},Rt=(l,y)=>{!l&&y&&!window.confirm("Stop editing without saving?")||E(_,!1)},Z=()=>{p>1&&(v.splice(-p+1,p-1),p=1),v.push(e(u(f))),console.log(v),console.log(p)},Lt=()=>{p>v.length-1||(p++,o(),N.undo(),console.log(v),console.log(p))},Ut=()=>{p<2||(p--,o(),N.redo(),console.log(v),console.log(p))};yt(()=>{A=u(f).nodes.map(l=>{let y=new Image;return y.src=l.image,y}),z()});var it=or(),q=W(it);let gt;q.__mousemove=ot,q.__mousedown=D,q.__mouseup=G,q.__keydown=[rr,k],q.__contextmenu=[nr],$(q,l=>i=l,()=>i);var at=Y(q,2),Ht=W(at);{var Bt=l=>{Be(l,{get node_id(){return u(b).id},saveNode:qt,exitNode:Rt,get nodes(){return u(f).nodes}})};Xt(Ht,l=>{u(_)&&l(Bt)})}H(at);var vt=Y(at,2);$(Qe(vt,{}),l=>N=l,()=>N);var xt=Y(vt,2);er(xt,{undo:Lt,redo:Ut});var Ft=Y(xt,2);We(Ft,{$$events:{modeChanged:l=>S=l.detail}}),H(it),tt(l=>gt=P(q,1,"bg-neutral-100",null,gt,l),[()=>({"cursor-grabbing":u(g)||u(t)})]),$t("wheel",q,Ot),U(r,it),nt()}et(["mousemove","mousedown","mouseup","keydown","contextmenu"]);function dr(r){ir(r,{})}export{dr as component};
