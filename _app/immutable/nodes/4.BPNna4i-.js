import"../chunks/CWj6FrbW.js";import{o as ve}from"../chunks/D4UJGxAj.js";import{a1 as te,f as L,c as k,s as p,r as S,t as j,b as D,a2 as ae,a as Q,a3 as I,W as q,g as a,d as g,a4 as X}from"../chunks/DCiFBwZK.js";import{d as B,r as O,h as we,e as $}from"../chunks/GnwKRTTK.js";import{i as ne}from"../chunks/CLeLst1N.js";import{s as y,b as A,V as x,a as ee,C as xe,g as P,c as be,f as _e,d as ye}from"../chunks/7kg2MtJh.js";import{b as oe}from"../chunks/CvNMPwJY.js";import{a as R}from"../chunks/jEiHzXEX.js";import{p as ke}from"../chunks/DlpU1sNi.js";B(["click"]);var Se=L('<textarea rows="1" readonly="" placeholder="Node Name" class="font-mono text-lg bg-neutral-800 text-white rounded-xl p-2 pl-3 placeholder:text-neutral-400 resize-none overflow-scroll"></textarea> <textarea rows="6" maxlength="400" readonly="" placeholder="Node Description" class="font-mono text-lg bg-neutral-800 text-white rounded-xl p-2 pl-3 placeholder:text-neutral-400 resize-none overflow-scroll focus:outline-none"></textarea>',1),De=L('<textarea rows="1" readonly="" placeholder="Link Name" class="font-mono text-lg bg-neutral-800 text-white rounded-xl p-2 pl-3 placeholder:text-neutral-400 resize-none overflow-scroll"></textarea> <textarea rows="6" maxlength="400" readonly="" placeholder="Link Description" class="font-mono text-lg bg-neutral-800 text-white rounded-xl p-2 pl-3 placeholder:text-neutral-400 resize-none overflow-scroll focus:outline-none"></textarea>',1),Le=(v,c)=>c(!1),Ne=L('<div class="flex flex-col gap-3.5 max-w-[350px] bg-neutral-950 text-white p-2.5 rounded-xl"><!> <div class="relative inline-block h-fit"><button>Exit</button></div></div>');function Ee(v,c){te(c,!0);let l=ke(c,"open",15);var f=Ne(),u=k(f);{var G=m=>{var t=Se(),i=Q(t);O(i);var d=p(i,2);O(d),j(()=>{R(i,c.node.name),R(d,c.node.description)}),D(m,t)},z=m=>{var t=De(),i=Q(t);O(i);var d=p(i,2);O(d),j(()=>{R(i,c.node.name),R(d,c.node.description)}),D(m,t)};ne(u,m=>{c.node.from===void 0?m(G):m(z,!1)})}var w=p(u,2),b=k(w);b.__click=[Le,l],S(w),S(f),j(()=>y(b,1,`${A} float-right`)),D(v,f),ae()}B(["click"]);const Me=(v,c)=>{g(c,!1)};var Ce=L(`<style>body {
            overflow-y: hidden;
        }</style>`),Ie=v=>v.preventDefault(),Oe=L('<div id="canvas-box" class="relative inline-block overflow-hidden"><canvas tabindex="0"></canvas> <div class="absolute w-fit h-fit"><!></div> <div class="absolute right-2.5 bottom-2.5"><button aria-label="Save Image">Save Image</button> <button aria-label="Save Graph">Save Graph</button> <button aria-label="Load Graph">Load Graph</button> <input type="file" accept=".json"/></div> <!></div>');function Ve(v,c){te(c,!0);let l,f=new x(0,0),u=1;const G=.5,z=2;let w=I(!1),b,m,t=I(q({nodes:[{id:0,name:"Node",description:"",image:"",position:[200,300]}],links:[]})),i=[],d=q({subset:!0,id:-1}),_=I(!1),N=I(q(new x(0,0)));const K=()=>{const e=l.getContext("2d");if(e===null)throw new Error("DRAW LOOP - ctx is null");l.width=window.innerWidth,l.height=window.innerHeight,e.clearRect(0,0,l.width,l.height),e.setTransform(u,0,0,u,-f.x,-f.y),a(t).links.forEach(o=>{e.beginPath();const r=a(t).nodes.find(s=>s.id===o.from)??a(t).nodes[0],n=a(t).nodes.find(s=>s.id===o.to)??a(t).nodes[0];e.moveTo(r.position[0],r.position[1]),e.lineTo(n.position[0],n.position[1]),e.lineWidth=10,e.strokeStyle="black",e.stroke()}),a(t).nodes.forEach((o,r)=>{const n=x.fromArray(o.position),s=25;e.beginPath(),e.arc(n.x,n.y,20,0,Math.PI*2),e.fillStyle="black",e.fill(),o.image!==""&&e.drawImage(i[r],n.x-s/2,n.y-s/2,s,s)}),requestAnimationFrame(K)},re=e=>{if(e.button===0){const o=P(e,l),r=be(e,l,f,u);let n=a(t).nodes.find(C=>x.fromArray(C.position).distanceSq(r)<400),s=a(t).links.find(C=>{const he=a(t).nodes[C.from],ge=a(t).nodes[C.to];return _e(x.fromArray(he.position),x.fromArray(ge.position),r)<10});n?(d.subset=!0,d.id=n.id,g(_,!0),g(N,o,!0)):s?(d.subset=!1,d.id=a(t).links.indexOf(s),g(_,!0),g(N,o,!0)):(g(w,!0),b=P(e,l),m=f.clone())}},se=e=>{if(a(w)){const r=P(e,l).clone().subtract(b);f=m.clone().subtract(r)}},le=e=>{e.preventDefault();const o=P(e,l),r=o.clone().add(f).divideScalar(u),n=Math.sign(e.deltaY);u-=n*.125,u=Math.max(G,Math.min(z,u)),f=r.clone().multiplyScalar(u).subtract(o)},ie=e=>{e.ctrlKey&&(e.key==="o"&&(e.preventDefault(),E.click()),e.key==="s"&&(e.preventDefault(),Z()),e.shiftKey&&e.key==="s"&&(e.preventDefault(),H()))},ce=()=>{if(i.length!==a(t).nodes.length){for(;i.length<a(t).nodes.length;)i.push(new Image);for(;i.length>a(t).nodes.length;)i.pop()}a(t).nodes.forEach((e,o)=>{i[o].src=e.image})},de=e=>{const o=e.target;if(!o.files||o.files.length===0)return;const r=o.files[0],n=new FileReader;n.onload=()=>{if(typeof n.result=="string")try{const s=JSON.parse(n.result);if(!s.nodes||!s.links)throw new Error("Invalid graph data");g(t,ye(s),!0),fe(),ce()}catch(s){alert("Failed to load graph: "+s.message)}console.log(a(t))},n.readAsText(r)},Z=()=>{if(window.confirm("Download new JSON?")){const e=JSON.stringify(a(t),null,4),o=new Blob([e],{type:"application/json"}),r=URL.createObjectURL(o),n=document.createElement("a");n.href=r,n.download="graph.json",n.click(),URL.revokeObjectURL(r)}},H=()=>{if(window.confirm("Download image? It will look as your canvas does now.")){const e=document.createElement("a");e.href=l.toDataURL("image/png"),e.download="graph.png",e.click()}},fe=()=>{const e=new Map(a(t).nodes.map((o,r)=>[o.id,r]));a(t).nodes.forEach((o,r)=>o.id=r),a(t).links.forEach(o=>{console.log(`${o.from}, ${o.to}`),o.from=e.get(o.from)??o.from,o.to=e.get(o.to)??o.to,console.log(`${o.from}, ${o.to}`)})};let E;ve(()=>{K()});var W=Oe();we(e=>{var o=Ce();X.title="Graph Viewer",D(e,o)}),$("keydown",X,ie);var h=k(W);let Y;h.__mousemove=se,h.__mousedown=re,h.__mouseup=[Me,w],h.__contextmenu=[Ie],oe(h,e=>l=e,()=>l);var M=p(h,2),ue=k(M);{var me=e=>{Ee(e,{get node(){return(d.subset?a(t).nodes:a(t).links)[d.id]},get open(){return a(_)},set open(o){g(_,o,!0)}})};ne(ue,e=>{a(_)&&e(me)})}S(M);var T=p(M,2),U=k(T);U.__click=H;var V=p(U,2);V.__click=Z;var F=p(V,2);F.__click=e=>E.click();var J=p(F,2);J.__change=de,ee(J,"",{},{display:"none"}),oe(J,e=>E=e,()=>E),S(T);var pe=p(T,2);xe(pe,{mode:-1,controls:{"Left Click (on graph)":"view node/link info","Left Click and Drag":"move viewport","Scroll Wheel":"zoom in and out","Ctrl-O":"open graph","Ctrl-S":"save graph","Ctrl-Shift-S":"save graph as image"}}),S(W),j(e=>{Y=y(h,1,"bg-neutral-100",null,Y,e),ee(M,`left: ${a(N).x??""}px; top: ${a(N).y??""}px;`),y(U,1,A),y(V,1,A),y(F,1,A)},[()=>({"cursor-grabbing":a(w)})]),$("wheel",h,le),D(v,W),ae()}B(["mousemove","mousedown","mouseup","contextmenu","click","change"]);export{Ve as component};
