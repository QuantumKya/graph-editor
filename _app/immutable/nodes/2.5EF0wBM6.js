import"../chunks/CWj6FrbW.js";import"../chunks/Di2cjJXv.js";import{X as le,b as ue,s as ht,h as O,M as ce,a as fe,A as s,al as de,r as he,c as pe,d as Nt,f as pt,j as Q,Z as ge,a1 as ve,g as Pt,i as Rt,p as ye,ax as gt,a4 as Ct,R as Dt,ay as xe,at as me,az as Tt,aA as be,aB as _e,N as we,aC as ke,aD as Ae,aE as Se,aF as Me,_ as Ee,W as Ne,aG as De,aH as Te,aI as Le,aJ as Ie,aK as Ye,aL as Xe,u as Oe,l as ze,D as $,au as X,am as Z,F as B,J as F,L as D,an as E,K as q,t as C,I as tt,G as rt,x as Ut,m as Pe,n as Re,aM as Lt,aN as Ce}from"../chunks/DIf7AYEm.js";import{a as Ue,l as qe,d as et,o as it,c as Be,r as Fe,e as je,b as Ge}from"../chunks/fZ3fxaW-.js";import{b as H,i as ot}from"../chunks/D-gA3m_S.js";import{b as qt}from"../chunks/-tg7TtSj.js";function He(n,r){return r}function Ve(n,r,t,o){for(var i=[],l=r.length,d=0;d<l;d++)_e(r[d].e,i,!0);var e=l>0&&i.length===0&&t!==null;if(e){var u=t.parentNode;we(u),u.append(t),o.clear(),W(n,r[0].prev,r[l-1].next)}ke(i,()=>{for(var v=0;v<l;v++){var p=r[v];e||(o.delete(p.k),W(n,p.prev,p.next)),Ae(p.e,!e)}})}function We(n,r,t,o,i,l=null){var d=n,e={flags:r,items:new Map,first:null};{var u=n;d=O?ht(ce(u)):u.appendChild(le())}O&&fe();var v=null,p=!1,w=de(()=>{var h=t();return Ne(h)?h:h==null?[]:Ct(h)});ue(()=>{var h=s(w),y=h.length;if(p&&y===0)return;p=y===0;let c=!1;if(O){var A=he(d)===pe;A!==(y===0)&&(d=Nt(),ht(d),pt(!1),c=!0)}if(O){for(var x=null,m,b=0;b<y;b++){if(Q.nodeType===ge&&Q.data===ve){d=Q,c=!0,pt(!1);break}var L=h[b],N=o(L,b);m=Bt(Q,e,x,null,L,N,b,i,r,t),e.items.set(N,m),x=m}y>0&&ht(Nt())}O||Je(h,e,d,i,r,o,t),l!==null&&(y===0?v?Pt(v):v=Rt(()=>l(d)):v!==null&&ye(v,()=>{v=null})),c&&pt(!0),s(w)}),O&&(d=Q)}function Je(n,r,t,o,i,l,d){var e=n.length,u=r.items,v=r.first,p=v,w,h=null,y=[],c=[],A,x,m,b;for(b=0;b<e;b+=1){if(A=n[b],x=l(A,b),m=u.get(x),m===void 0){var L=p?p.e.nodes_start:t;h=Bt(L,r,h,h===null?r.first:h.next,A,x,b,o,i,d),u.set(x,h),y=[],c=[],p=h.next;continue}if(Ze(m,A,b),(m.e.f&gt)!==0&&Pt(m.e),m!==p){if(w!==void 0&&w.has(m)){if(y.length<c.length){var N=c[0],k;h=N.prev;var T=y[0],z=y[y.length-1];for(k=0;k<y.length;k+=1)It(y[k],N,t);for(k=0;k<c.length;k+=1)w.delete(c[k]);W(r,T.prev,z.next),W(r,h,T),W(r,z,N),p=N,h=z,b-=1,y=[],c=[]}else w.delete(m),It(m,p,t),W(r,m.prev,m.next),W(r,m,h===null?r.first:h.next),W(r,h,m),h=m;continue}for(y=[],c=[];p!==null&&p.k!==x;)(p.e.f&gt)===0&&(w??(w=new Set)).add(p),c.push(p),p=p.next;if(p===null)continue;m=p}y.push(m),h=m,p=m.next}if(p!==null||w!==void 0){for(var I=w===void 0?[]:Ct(w);p!==null;)(p.e.f&gt)===0&&I.push(p),p=p.next;var V=I.length;if(V>0){var Y=e===0?t:null;Ve(r,I,Y,u)}}Dt.first=r.first&&r.first.e,Dt.last=h&&h.e}function Ze(n,r,t,o){xe(n.v,r),n.i=t}function Bt(n,r,t,o,i,l,d,e,u,v){var p=(u&Se)!==0,w=(u&Me)===0,h=p?w?me(i,!1,!1):Tt(i):i,y=(u&be)===0?d:Tt(d),c={i:y,v:h,k:l,a:null,e:null,prev:t,next:o};try{return c.e=Rt(()=>e(n,h,y,v),O),c.e.prev=t&&t.e,c.e.next=o&&o.e,t===null?r.first=c:(t.next=c,t.e.next=c.e),o!==null&&(o.prev=c,o.e.prev=c.e),c}finally{}}function It(n,r,t){for(var o=n.next?n.next.e.nodes_start:t,i=r?r.e.nodes_start:t,l=n.e.nodes_start;l!==o;){var d=Ee(l);i.before(l),l=d}}function W(n,r,t){r===null?n.first=t:(r.next=t,r.e.next=t&&t.e),t!==null&&(t.prev=r,t.e.prev=r&&r.e)}function Ft(n){var r,t,o="";if(typeof n=="string"||typeof n=="number")o+=n;else if(typeof n=="object")if(Array.isArray(n)){var i=n.length;for(r=0;r<i;r++)n[r]&&(t=Ft(n[r]))&&(o&&(o+=" "),o+=t)}else for(t in n)n[t]&&(o&&(o+=" "),o+=t);return o}function Ke(){for(var n,r,t=0,o="",i=arguments.length;t<i;t++)(n=arguments[t])&&(r=Ft(n))&&(o&&(o+=" "),o+=r);return o}function Qe(n){return typeof n=="object"?Ke(n):n??""}const Yt=[...` 	
\r\fÂ \v\uFEFF`];function $e(n,r,t){var o=n==null?"":""+n;if(r&&(o=o?o+" "+r:r),t){for(var i in t)if(t[i])o=o?o+" "+i:i;else if(o.length)for(var l=i.length,d=0;(d=o.indexOf(i,d))>=0;){var e=d+l;(d===0||Yt.includes(o[d-1]))&&(e===o.length||Yt.includes(o[e]))?o=(d===0?"":o.substring(0,d))+o.substring(e+1):d=e}}return o===""?null:o}function Xt(n,r=!1){var t=r?" !important;":";",o="";for(var i in n){var l=n[i];l!=null&&l!==""&&(o+=" "+i+": "+l+t)}return o}function tn(n,r){if(r){var t="",o,i;return Array.isArray(r)?(o=r[0],i=r[1]):o=r,o&&(t+=Xt(o)),i&&(t+=Xt(i,!0)),t=t.trim(),t===""?null:t}return String(n)}function R(n,r,t,o,i,l){var d=n.__className;if(O||d!==t||d===void 0){var e=$e(t,o,l);(!O||e!==n.getAttribute("class"))&&(e==null?n.removeAttribute("class"):n.className=e),n.__className=t}else if(l&&i!==l)for(var u in l){var v=!!l[u];(i==null||v!==!!i[u])&&n.classList.toggle(u,v)}return l}function vt(n,r={},t,o){for(var i in t){var l=t[i];r[i]!==l&&(t[i]==null?n.style.removeProperty(i):n.style.setProperty(i,l,o))}}function jt(n,r,t,o){var i=n.__style;if(O||i!==r){var l=tn(r,o);(!O||l!==n.getAttribute("style"))&&(l==null?n.removeAttribute("style"):n.style.cssText=l),n.__style=r}else o&&(Array.isArray(o)?(vt(n,t==null?void 0:t[0],o[0]),vt(n,t==null?void 0:t[1],o[1],"important")):vt(n,t,o));return o}const en=Symbol("is custom element"),nn=Symbol("is html");function Gt(n){if(O){var r=!1,t=()=>{if(!r){if(r=!0,n.hasAttribute("value")){var o=n.value;K(n,"value",null),n.value=o}if(n.hasAttribute("checked")){var i=n.checked;K(n,"checked",null),n.checked=i}}};n.__on_r=t,Ie(t),Ue()}}function K(n,r,t,o){var i=rn(n);O&&(i[r]=n.getAttribute(r),r==="src"||r==="srcset"||r==="href"&&n.nodeName==="LINK")||i[r]!==(i[r]=t)&&(r==="loading"&&(n[De]=t),t==null?n.removeAttribute(r):typeof t!="string"&&on(n).includes(r)?n[r]=t:n.setAttribute(r,t))}function rn(n){return n.__attributes??(n.__attributes={[en]:n.nodeName.includes("-"),[nn]:n.namespaceURI===Te})}var Ot=new Map;function on(n){var r=Ot.get(n.nodeName);if(r)return r;Ot.set(n.nodeName,r=[]);for(var t,o=n,i=Element.prototype;i!==o;){t=Ye(o);for(var l in t)t[l].set&&r.push(l);o=Le(o)}return r}function bt(n,r,t=r){var o=Xe();qe(n,"input",i=>{var l=i?n.defaultValue:n.value;if(l=yt(n)?xt(l):l,t(l),o&&l!==(l=r())){var d=n.selectionStart,e=n.selectionEnd;n.value=l??"",e!==null&&(n.selectionStart=d,n.selectionEnd=Math.min(e,n.value.length))}}),(O&&n.defaultValue!==n.value||Oe(r)==null&&n.value)&&t(yt(n)?xt(n.value):n.value),ze(()=>{var i=r();yt(n)&&i===xt(n.value)||n.type==="date"&&!i&&!n.value||i!==n.value&&(n.value=i??"")})}function yt(n){var r=n.type;return r==="number"||r==="range"}function xt(n){return n===""?null:+n}var an=B('<img alt="Uploaded Icon" class="rounded-lg w-[300px]"/>'),sn=B('<img alt="Uploaded Icon" class="rounded-lg w-[300px]"/>'),ln=B('<div class="flex flex-col gap-3.5 max-w-[350px] h-fit bg-neutral-950 text-white p-2.5 rounded-xl"><input type="text" placeholder="Node Title"/> <button>Upload Image</button> <input type="file" accept="image/*"/> <!> <div class="relative inline-block h-fit"><button>Save</button> <button>Exit</button></div></div>');function un(n,r){$(r,!0);let t=X(Z(r.node.name)),o=X(Z(r.node.image)),i,l,d=!1,e=!1;it(()=>{l.value=r.node.name});const u=()=>{d=!0},v="bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700",p="font-mono text-lg bg-neutral-800 text-white rounded-xl p-2 pl-3 transition duration-300 focus:bg-gray-700 focus:ring-2 focus:ring-blue-500 outline-none";var w=ln(),h=F(w);Gt(h),R(h,1,p),h.__change=u,H(h,k=>l=k,()=>l);var y=D(h,2);R(y,1,v),y.__click=k=>{i.click()};var c=D(y,2);c.__change=k=>{const T=k.target;if(!T.files||T.files.length===0)return;const z=T.files[0],I=new FileReader;I.onload=()=>{typeof I.result=="string"&&E(o,I.result,!0)},I.readAsDataURL(z),u()},jt(c,"",{},{display:"none"}),H(c,k=>i=k,()=>i);var A=D(c,2);{var x=k=>{var T=an();rt(()=>K(T,"src",s(o))),C(k,T)},m=k=>{var T=sn();rt(()=>K(T,"src",`${qt??""}/landscape-placeholder.svg`)),C(k,T)};ot(A,k=>{s(o)!=""?k(x):k(m,!1)})}var b=D(A,2),L=F(b);R(L,1,"bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700 float-left"),L.__click=()=>{e=r.saveNode(r.node,s(t),s(o))};var N=D(L,2);R(N,1,"bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700 float-right"),N.__click=()=>r.exitNode(e,d),q(b),q(w),bt(h,()=>s(t),k=>E(t,k)),C(n,w),tt()}et(["change","click"]);var cn=B('<div class="w-[5px] bg-neutral-300 rounded-full m-3"></div>'),fn=B("<button><img/></button>"),dn=B('<div class="flex absolute rounded-xl bg-neutral-200 border-blue-300 border-2 p-[10px] pt-[5px] pb-[5px] h-fit bottom-6 left-[50%] transform -translate-[50%]"></div>');function hn(n,r){$(r,!0);let t=X(2),o=["node_add.png","node_edit.png","node_drag.png","","link_add.png","link_edit.png"];const i=Be();Ut(()=>{i("modeChanged",s(t))});var l=dn();We(l,21,()=>o,He,(d,e,u)=>{var v=Pe(),p=Re(v);{var w=y=>{var c=cn();C(y,c)},h=y=>{var c=fn();c.__click=()=>E(t,u-o.slice(0,u).filter(x=>x==="").length);var A=F(c);q(c),rt((x,m,b)=>{R(c,1,`p-2.5 rounded-xl border-none outline-none transition duration-200 hover:bg-blue-300 ${x??""}`),K(A,"src",`${qt??""}/mode_icons/${s(e)??""}`),K(A,"alt",m),R(A,1,b)},[()=>s(t)===u-o.slice(0,u).filter(x=>x==="").length?"bg-gray-500 mt-auto mb-auto":"mt-[10px] mb-[10px]",()=>o[u].split(".")[0],()=>Qe(s(t)===u-o.slice(0,u).filter(x=>x==="").length?"max-w-[40px] rounded-xl":"max-w-[30px] rounded-lg")]),C(y,c)};ot(p,y=>{s(e)===""?y(w):y(h,!1)})}C(d,v)}),q(l),C(n,l),tt()}et(["click"]);function pn(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var mt={exports:{}},zt;function gn(){return zt||(zt=1,function(n,r){n.exports=t;function t(e,u){if(!(this instanceof t))return new t(e,u);this.x=e||0,this.y=u||0}t.fromArray=function(e){return new t(e[0]||0,e[1]||0)},t.fromObject=function(e){return new t(e.x||0,e.y||0)},t.prototype.addX=function(e){return this.x+=e.x,this},t.prototype.addY=function(e){return this.y+=e.y,this},t.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},t.prototype.addScalar=function(e){return this.x+=e,this.y+=e,this},t.prototype.addScalarX=function(e){return this.x+=e,this},t.prototype.addScalarY=function(e){return this.y+=e,this},t.prototype.subtractX=function(e){return this.x-=e.x,this},t.prototype.subtractY=function(e){return this.y-=e.y,this},t.prototype.subtract=function(e){return this.x-=e.x,this.y-=e.y,this},t.prototype.subtractScalar=function(e){return this.x-=e,this.y-=e,this},t.prototype.subtractScalarX=function(e){return this.x-=e,this},t.prototype.subtractScalarY=function(e){return this.y-=e,this},t.prototype.divideX=function(e){return this.x/=e.x,this},t.prototype.divideY=function(e){return this.y/=e.y,this},t.prototype.divide=function(e){return this.x/=e.x,this.y/=e.y,this},t.prototype.divideScalar=function(e){return e!==0?(this.x/=e,this.y/=e):(this.x=0,this.y=0),this},t.prototype.divideScalarX=function(e){return e!==0?this.x/=e:this.x=0,this},t.prototype.divideScalarY=function(e){return e!==0?this.y/=e:this.y=0,this},t.prototype.invertX=function(){return this.x*=-1,this},t.prototype.invertY=function(){return this.y*=-1,this},t.prototype.invert=function(){return this.invertX(),this.invertY(),this},t.prototype.multiplyX=function(e){return this.x*=e.x,this},t.prototype.multiplyY=function(e){return this.y*=e.y,this},t.prototype.multiply=function(e){return this.x*=e.x,this.y*=e.y,this},t.prototype.multiplyScalar=function(e){return this.x*=e,this.y*=e,this},t.prototype.multiplyScalarX=function(e){return this.x*=e,this},t.prototype.multiplyScalarY=function(e){return this.y*=e,this},t.prototype.normalize=function(){var e=this.length();return e===0?(this.x=1,this.y=0):this.divide(t(e,e)),this},t.prototype.norm=t.prototype.normalize,t.prototype.limit=function(e,u){return Math.abs(this.x)>e&&(this.x*=u),Math.abs(this.y)>e&&(this.y*=u),this},t.prototype.randomize=function(e,u){return this.randomizeX(e,u),this.randomizeY(e,u),this},t.prototype.randomizeX=function(e,u){var v=Math.min(e.x,u.x),p=Math.max(e.x,u.x);return this.x=i(v,p),this},t.prototype.randomizeY=function(e,u){var v=Math.min(e.y,u.y),p=Math.max(e.y,u.y);return this.y=i(v,p),this},t.prototype.randomizeAny=function(e,u){return Math.round(Math.random())?this.randomizeX(e,u):this.randomizeY(e,u),this},t.prototype.unfloat=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},t.prototype.toFixed=function(e){return typeof e>"u"&&(e=8),this.x=this.x.toFixed(e),this.y=this.y.toFixed(e),this},t.prototype.mixX=function(e,u){return typeof u>"u"&&(u=.5),this.x=(1-u)*this.x+u*e.x,this},t.prototype.mixY=function(e,u){return typeof u>"u"&&(u=.5),this.y=(1-u)*this.y+u*e.y,this},t.prototype.mix=function(e,u){return this.mixX(e,u),this.mixY(e,u),this},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copyX=function(e){return this.x=e.x,this},t.prototype.copyY=function(e){return this.y=e.y,this},t.prototype.copy=function(e){return this.copyX(e),this.copyY(e),this},t.prototype.zero=function(){return this.x=this.y=0,this},t.prototype.dot=function(e){return this.x*e.x+this.y*e.y},t.prototype.cross=function(e){return this.x*e.y-this.y*e.x},t.prototype.projectOnto=function(e){var u=(this.x*e.x+this.y*e.y)/(e.x*e.x+e.y*e.y);return this.x=u*e.x,this.y=u*e.y,this},t.prototype.horizontalAngle=function(){return Math.atan2(this.y,this.x)},t.prototype.horizontalAngleDeg=function(){return l(this.horizontalAngle())},t.prototype.verticalAngle=function(){return Math.atan2(this.x,this.y)},t.prototype.verticalAngleDeg=function(){return l(this.verticalAngle())},t.prototype.angle=t.prototype.horizontalAngle,t.prototype.angleDeg=t.prototype.horizontalAngleDeg,t.prototype.direction=t.prototype.horizontalAngle,t.prototype.rotate=function(e){var u=this.x*Math.cos(e)-this.y*Math.sin(e),v=this.x*Math.sin(e)+this.y*Math.cos(e);return this.x=u,this.y=v,this},t.prototype.rotateDeg=function(e){return e=d(e),this.rotate(e)},t.prototype.rotateTo=function(e){return this.rotate(e-this.angle())},t.prototype.rotateToDeg=function(e){return e=d(e),this.rotateTo(e)},t.prototype.rotateBy=function(e){var u=this.angle()+e;return this.rotate(u)},t.prototype.rotateByDeg=function(e){return e=d(e),this.rotateBy(e)},t.prototype.distanceX=function(e){return this.x-e.x},t.prototype.absDistanceX=function(e){return Math.abs(this.distanceX(e))},t.prototype.distanceY=function(e){return this.y-e.y},t.prototype.absDistanceY=function(e){return Math.abs(this.distanceY(e))},t.prototype.distance=function(e){return Math.sqrt(this.distanceSq(e))},t.prototype.distanceSq=function(e){var u=this.distanceX(e),v=this.distanceY(e);return u*u+v*v},t.prototype.length=function(){return Math.sqrt(this.lengthSq())},t.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},t.prototype.magnitude=t.prototype.length,t.prototype.isZero=function(){return this.x===0&&this.y===0},t.prototype.isEqualTo=function(e){return this.x===e.x&&this.y===e.y},t.prototype.toString=function(){return"x:"+this.x+", y:"+this.y},t.prototype.toArray=function(){return[this.x,this.y]},t.prototype.toObject=function(){return{x:this.x,y:this.y}};var o=180/Math.PI;function i(e,u){return Math.floor(Math.random()*(u-e+1)+e)}function l(e){return e*o}function d(e){return e/o}}(mt)),mt.exports}var vn=gn();const G=pn(vn),yn=[{id:0,name:"Addition",image:"",position:[100,100]},{id:1,name:"Subtraction",image:"",position:[300,150]},{id:2,name:"Multiplication",image:"",position:[200,300]},{id:3,name:"Division",image:"",position:[300,450]}],xn=[{from:0,to:1,name:"",description:""},{from:0,to:2,name:"",description:""},{from:2,to:3,name:"",description:""}],nt={nodes:yn,links:xn};var mn=B(`<div class="flex flex-col gap-0 absolute w-fit p-1 rounded-xl bottom-1 left-1 font-mono text-blue-300 bg-gray-700 transition duration-200"><p class="text-center">------------------ Edit Log ------------------</p> <textarea class="resize-none overflow-y-scroll text-wrap outline-none" readonly="" cols="48" rows="8">
    </textarea></div>`);function bn(n,r){$(r,!0);let t=Z([]),o,i=X(0),l=Z([]),d;const e=(h,y)=>{s(i)>0&&(t.splice(-s(i),s(i)),E(i,0)),l.push(h),t.push(y===void 0?h:h+`:
	`+y)},u=()=>{s(i)>l.length-1||(Lt(i),t.push("Undo: "+l.at(-s(i))))},v=()=>{s(i)<1||(t.push("Redo: "+l.at(-s(i))),Lt(i,-1))};Ut(()=>{o.value+=`
`+t.at(-1),o.scrollTop=o.scrollHeight}),it(()=>{o.value=""});var p=mn(),w=D(F(p),2);return H(w,h=>o=h,()=>o),q(p),H(p,h=>d=h,()=>d),C(n,p),tt({log:e,undo:u,redo:v})}var _n=B('<div class="flex flex-row gap-3 w-min h-min p-3 absolute top-1 left-1 text-2xl "><button aria-label="Undo"><i class="fas fa-undo"></i></button> <button aria-label="Redo"><i class="fas fa-redo"></i></button></div>');function wn(n,r){const t="border-none rounded-full w-fit h-fit bg-gray-300 p-2 pt-0.5 pb-1 text-center";var o=_n(),i=F(o);R(i,1,t),i.__click=function(...d){var e;(e=r.undo)==null||e.apply(this,d)};var l=D(i,2);R(l,1,t),l.__click=function(...d){var e;(e=r.redo)==null||e.apply(this,d)},q(o),C(n,o)}et(["click"]);var kn=B('<div class="flex flex-col gap-3.5 max-w-[350px] h-fit bg-neutral-950 text-white p-2.5 rounded-xl"><input type="text" placeholder="Link Title"/> <textarea rows="6" maxlength="400" placeholder="Link Description"></textarea> <div class="relative inline-block h-fit"><button>Save</button> <button>Exit</button></div></div>');function An(n,r){$(r,!0);let t=X(""),o=X(""),i,l,d=!1,e=!1;it(()=>{i.value=r.link.name,l.value=r.link.description});const u=()=>{e=!0},v="font-mono text-lg bg-neutral-800 text-white rounded-xl p-2 pl-3 transition duration-300 focus:bg-gray-700 focus:ring-2 focus:ring-blue-500 outline-none";var p=kn(),w=F(p);Gt(w),R(w,1,v),w.__change=u,H(w,x=>i=x,()=>i);var h=D(w,2);Fe(h),R(h,1,"font-mono text-lg bg-neutral-800 text-white rounded-xl p-2 pl-3 transition duration-300 focus:bg-gray-700 focus:ring-2 focus:ring-blue-500 outline-none placeholder:text-neutral-400 resize-none overflow-scroll"),h.__change=u,H(h,x=>l=x,()=>l);var y=D(h,2),c=F(y);R(c,1,"bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700 float-left"),c.__click=()=>{d=r.saveLink(r.link,s(t),s(o))};var A=D(c,2);R(A,1,"bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700 float-right"),A.__click=()=>r.exitLink(d,e),q(y),q(p),bt(w,()=>s(t),x=>E(t,x)),bt(h,()=>s(o),x=>E(o,x)),C(n,p),tt()}et(["change","click"]);const Sn=(n,r)=>{n.key==="Escape"&&s(r)&&E(r,!1)},Mn=(n,r)=>{if(window.confirm("Download new JSON?")){const t=JSON.stringify(s(r),null,4),o=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(o),l=document.createElement("a");l.href=i,l.download="data.json",l.click(),URL.revokeObjectURL(i)}};var En=n=>n.preventDefault(),Nn=B('<div id="canvas-box" class="relative inline-block overflow-hidden"><canvas tabindex="0"></canvas> <div class="absolute right-2.5 top-2.5"><!></div> <div class="absolute right-2.5 bottom-2.5"><button class="bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700" aria-label="Save Graph">Save Graph</button> <button class="bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700" aria-label="Load Graph">Load Graph</button> <input type="file" accept=".json"/></div> <!> <!> <!></div>');function Dn(n,r){$(r,!0);const t=a=>({nodes:a.nodes.map(f=>({...f,position:[...f.position]})),links:a.links.map(f=>({...f}))}),o=()=>{const a=A.at(-x)??s(c);if(E(c,t(a),!0),m.length!==s(c).nodes.length){for(;m.length<s(c).nodes.length;)m.push(new Image);for(;m.length>s(c).nodes.length;)m.pop()}s(c).nodes.forEach((g,_)=>{m[_].src=g.image});const f=s(c).nodes.find(g=>g.id===s(b).id);f?E(b,f,!0):E(b,s(c).nodes[0],!0)};let i,l=new G(0,0),d=1;const e=.5,u=2;let v=X(!1),p,w,h,y=new G(0,0),c=X(Z(t(nt))),A=[t(nt)],x=1,m=[],b=X(Z(nt.nodes[0])),L=X(!1),N=X(!1),k=X(Z(nt.links[0])),T=X(!1),z,I=X(!1),V=0,Y;const _t=()=>{const a=i.getContext("2d");if(a===null)throw new Error("DRAW LOOP - ctx is null");i.width=window.innerWidth,i.height=window.innerHeight,a.clearRect(0,0,i.width,i.height),a.setTransform(d,0,0,d,-l.x,-l.y),s(I)&&(a.beginPath(),a.moveTo(s(b).position[0],s(b).position[1]),a.lineTo(h.x,h.y),a.lineWidth=10,a.strokeStyle="rgba(0, 0, 0, 0.35)",a.stroke()),s(c).links.forEach(f=>{a.beginPath();const g=s(c).nodes.find(S=>S.id===f.from)??s(c).nodes[0],_=s(c).nodes.find(S=>S.id===f.to)??s(c).nodes[0];a.moveTo(g.position[0],g.position[1]),a.lineTo(_.position[0],_.position[1]),a.lineWidth=10,a.strokeStyle="black",a.stroke()}),s(c).nodes.forEach((f,g)=>{const _=G.fromArray(f.position),S=25;a.beginPath(),a.arc(_.x,_.y,20,0,Math.PI*2),a.fillStyle="black",a.fill(),a.drawImage(m[g],_.x-S/2,_.y-S/2,S,S)}),requestAnimationFrame(_t)},at=a=>{const f=i.getBoundingClientRect();return new G(a.clientX-f.left,a.clientY-f.top)},wt=a=>{const f=i.getBoundingClientRect(),g=(a.clientX-f.left+l.x)/d,_=(a.clientY-f.top+l.y)/d;return new G(g,_)},Ht=(a,f,g)=>{const _=f.clone().subtract(a),M=g.clone().subtract(a).dot(_)/_.lengthSq();if(M<0||M>1)return 1e6;const P=Math.abs(f.clone().subtract(a).cross(g.clone().subtract(a))),U=f.clone().subtract(a).length();return P/U},Vt=a=>{if(s(N))return;const f=wt(a);let g=s(c).nodes.find(M=>G.fromArray(M.position).distanceSq(f)<400);E(b,g??s(b),!0);let _=s(c).links.find(M=>{const P=s(c).nodes[M.from],U=s(c).nodes[M.to];return Ht(G.fromArray(P.position),G.fromArray(U.position),f)<10});E(k,_??s(k),!0);const S=s(c).links.indexOf(s(k));if(a.button===0){if(V===0){if(!g)s(c).nodes.push({id:-1,name:"",image:"",position:f.toArray()}),lt(),m.push(new Image),J(),Y.log("Create node");else if(window.confirm("Delete node and its links?")){const M=g.id;s(c).nodes.splice(M,1),E(b,s(c).nodes[0],!0),m.splice(M,1);let P=[];s(c).links.forEach((U,se)=>{(U.from===M||U.to===M)&&P.push(se)});for(const U of P)s(c).links.splice(U,1);lt(),J(),Y.log("Delete node",`Node ID: ${M}, ${P.length} links destroyed`)}}else if(V===1){if(!g)return;E(N,!0)}else if(V===2){if(!g)return;y=f.clone().subtract(G.fromArray(s(b).position)),E(L,!0)}else if(V===3)if(g)if(s(I)){if(z.id===s(b).id||s(c).links.filter(M=>M.from===z.id&&M.to===s(b).id||M.from===s(b).id&&M.to===z.id).length!==0)return;s(c).links.push({from:z.id,to:s(b).id,name:"",description:""}),E(I,!1),J(),Y.log("Create link",`node ${z.id} -> ${s(b).id}`)}else z=g,E(I,!0),h=f;else{if(!_)return;s(c).links.splice(S,1),J(),Y.log("Delete link",`node ${z.id} -> ${s(b).id}`)}else if(V===4){if(!_)return;E(T,!0)}}a.button===2&&(E(v,!0),p=at(a),w=l.clone())},Wt=a=>{if(s(N))return;const f=wt(a);if(h=f,s(L)){let g=s(c).nodes.find(_=>_.id===s(b).id);if(!g)throw new Error("uhhh focusNode error, it's not in the list...");g.position=f.clone().subtract(y).toArray()}else if(s(v)){const _=at(a).clone().subtract(p);l=w.clone().subtract(_)}},Jt=a=>{s(N)||(s(L)&&(E(L,!1),J(),Y.log("Set node position")),E(v,!1))},Zt=a=>{a.preventDefault();const f=at(a),g=f.clone().add(l).divideScalar(d),_=Math.sign(a.deltaY);d-=_*.125,d=Math.max(e,Math.min(u,d)),l=g.clone().multiplyScalar(d).subtract(f)},Kt=(a,f,g)=>{let _=[a.name===f?"":"name",a.image===g?"":"image"],S=[];_.forEach(U=>{U!==""&&S.push(U)});const M=S.join(", ");if(M===""||!window.confirm("Save this node with new contents?"))return!1;a.name=f,a.image=g;const P=s(c).nodes.indexOf(a);return P>=0&&(m[P].src=a.image),J(),Y.log("Update node contents",M),!0},Qt=(a,f)=>{!a&&f&&!window.confirm("Stop editing without saving?")||E(N,!1)},$t=(a,f,g)=>{let _=[a.name===f?"":"name",a.description===g?"":"description"],S=[];_.forEach(P=>{P!==""&&S.push(P)});const M=S.join(", ");return M===""||!window.confirm("Save this node with new contents?")?!1:(a.name=f,a.description=g,J(),Y.log("Update node contents",M),!0)},te=(a,f)=>{!a&&f&&!window.confirm("Stop editing without saving?")||E(T,!1)},J=()=>{x>1&&(A.splice(-x+1,x-1),x=1),A.push(t(s(c))),console.log(A),console.log(x)},ee=()=>{x>A.length-1||(x++,o(),Y.undo(),console.log(A),console.log(x))},ne=()=>{x<2||(x--,o(),Y.redo(),console.log(A),console.log(x))};let st;const lt=()=>{const a=new Map(s(c).nodes.map((f,g)=>[f.id,g]));s(c).nodes.forEach((f,g)=>f.id=g),s(c).links.forEach(f=>{console.log(`${f.from}, ${f.to}`),f.from=a.get(f.from)??f.from,f.to=a.get(f.to)??f.to,console.log(`${f.from}, ${f.to}`)})};it(()=>{m=s(c).nodes.map(a=>{let f=new Image;return f.src=a.image,f}),_t()});var ut=Nn(),j=F(ut);let kt;j.__mousemove=Wt,j.__mousedown=Vt,j.__mouseup=Jt,j.__keydown=[Sn,I],j.__contextmenu=[En],H(j,a=>i=a,()=>i);var ct=D(j,2),re=F(ct);{var oe=a=>{un(a,{get node(){return s(b)},saveNode:Kt,exitNode:Qt})},ie=(a,f)=>{{var g=_=>{An(_,{get link(){return s(k)},saveLink:$t,exitLink:te})};ot(a,_=>{s(T)&&_(g)},f)}};ot(re,a=>{s(N)?a(oe):a(ie,!1)})}q(ct);var ft=D(ct,2),At=F(ft);At.__click=[Mn,c];var St=D(At,2);St.__click=a=>st.click();var dt=D(St,2);dt.__change=a=>{const f=a.target;if(!f.files||f.files.length===0)return;const g=f.files[0],_=new FileReader;_.onload=()=>{if(typeof _.result=="string")try{const S=JSON.parse(_.result);if(!S.nodes||!S.links)throw new Error("Invalid graph data");E(c,t(S),!0),lt(),x=1,A=[t(s(c))],o(),Y.log("Load new graph data")}catch(S){alert("Failed to load graph: "+S.message)}},_.readAsText(g)},jt(dt,"",{},{display:"none"}),H(dt,a=>st=a,()=>st),q(ft);var Mt=D(ft,2);H(bn(Mt,{}),a=>Y=a,()=>Y);var Et=D(Mt,2);wn(Et,{undo:ee,redo:ne});var ae=D(Et,2);hn(ae,{$$events:{modeChanged:a=>V=a.detail}}),q(ut),rt(a=>kt=R(j,1,"bg-neutral-100",null,kt,a),[()=>({"cursor-grabbing":s(L)||s(v)})]),je("wheel",j,Zt),C(n,ut),tt()}et(["mousemove","mousedown","mouseup","keydown","contextmenu","click","change"]);var Tn=B(`<style>body {
            overflow-y: hidden;
        }</style>`);function Pn(n){Ge(r=>{var t=Tn();Ce.title="Graph Editor",C(r,t)}),Dn(n,{})}export{Pn as component};
