import"../chunks/CWj6FrbW.js";import"../chunks/CwZKfcDM.js";import{a as Vt,l as jt,d as et,o as yt,r as Wt,c as Gt,e as Jt}from"../chunks/BYhcaexx.js";import{a4 as Kt,b as $t,s as st,h as D,M as Zt,a as Qt,A as u,ak as te,r as ee,c as ne,d as mt,f as ut,j as $,Y as re,$ as oe,g as Dt,i as Tt,p as ie,aw as lt,a2 as It,R as bt,ax as ae,as as se,ay as _t,az as ue,aA as le,N as ce,aB as fe,aC as de,aD as he,aE as pe,Z as ye,W as ge,aF as ve,aG as xe,aH as me,aI as be,aJ as _e,aK as we,u as Ae,l as Me,D as nt,at as X,al as V,F as H,J as j,L as Y,am as E,K as B,t as q,I as rt,G as tt,x as Yt,aL as wt}from"../chunks/BKZJkl96.js";import{b as J,i as Xt}from"../chunks/4slWvAw0.js";import{b as zt}from"../chunks/CcvPZVxA.js";function Se(n,r){return r}function Ee(n,r,e,o){for(var i=[],a=r.length,f=0;f<a;f++)le(r[f].e,i,!0);var t=a>0&&i.length===0&&e!==null;if(t){var s=e.parentNode;ce(s),s.append(e),o.clear(),U(n,r[0].prev,r[a-1].next)}fe(i,()=>{for(var h=0;h<a;h++){var d=r[h];t||(o.delete(d.k),U(n,d.prev,d.next)),de(d.e,!t)}})}function ke(n,r,e,o,i,a=null){var f=n,t={flags:r,items:new Map,first:null};{var s=n;f=D?st(Zt(s)):s.appendChild(Kt())}D&&Qt();var h=null,d=!1,x=te(()=>{var c=e();return ge(c)?c:c==null?[]:It(c)});$t(()=>{var c=u(x),v=c.length;if(d&&v===0)return;d=v===0;let p=!1;if(D){var A=ee(f)===ne;A!==(v===0)&&(f=mt(),st(f),ut(!1),p=!0)}if(D){for(var b=null,g,_=0;_<v;_++){if($.nodeType===re&&$.data===oe){f=$,p=!0,ut(!1);break}var I=c[_],k=o(I,_);g=Ot($,t,b,null,I,k,_,i,r,e),t.items.set(k,g),b=g}v>0&&st(mt())}D||Ne(c,t,f,i,r,o,e),a!==null&&(v===0?h?Dt(h):h=Tt(()=>a(f)):h!==null&&ie(h,()=>{h=null})),p&&ut(!0),u(x)}),D&&(f=$)}function Ne(n,r,e,o,i,a,f){var t=n.length,s=r.items,h=r.first,d=h,x,c=null,v=[],p=[],A,b,g,_;for(_=0;_<t;_+=1){if(A=n[_],b=a(A,_),g=s.get(b),g===void 0){var I=d?d.e.nodes_start:e;c=Ot(I,r,c,c===null?r.first:c.next,A,b,_,o,i,f),s.set(b,c),v=[],p=[],d=c.next;continue}if(De(g,A,_),(g.e.f&lt)!==0&&Dt(g.e),g!==d){if(x!==void 0&&x.has(g)){if(v.length<p.length){var k=p[0],S;c=k.prev;var N=v[0],z=v[v.length-1];for(S=0;S<v.length;S+=1)At(v[S],k,e);for(S=0;S<p.length;S+=1)x.delete(p[S]);U(r,N.prev,z.next),U(r,c,N),U(r,z,k),d=k,c=z,_-=1,v=[],p=[]}else x.delete(g),At(g,d,e),U(r,g.prev,g.next),U(r,g,c===null?r.first:c.next),U(r,c,g),c=g;continue}for(v=[],p=[];d!==null&&d.k!==b;)(d.e.f&lt)===0&&(x??(x=new Set)).add(d),p.push(d),d=d.next;if(d===null)continue;g=d}v.push(g),c=g,d=g.next}if(d!==null||x!==void 0){for(var C=x===void 0?[]:It(x);d!==null;)(d.e.f&lt)===0&&C.push(d),d=d.next;var M=C.length;if(M>0){var T=t===0?e:null;Ee(r,C,T,s)}}bt.first=r.first&&r.first.e,bt.last=c&&c.e}function De(n,r,e,o){ae(n.v,r),n.i=e}function Ot(n,r,e,o,i,a,f,t,s,h){var d=(s&he)!==0,x=(s&pe)===0,c=d?x?se(i,!1,!1):_t(i):i,v=(s&ue)===0?f:_t(f),p={i:v,v:c,k:a,a:null,e:null,prev:e,next:o};try{return p.e=Tt(()=>t(n,c,v,h),D),p.e.prev=e&&e.e,p.e.next=o&&o.e,e===null?r.first=p:(e.next=p,e.e.next=p.e),o!==null&&(o.prev=p,o.e.prev=p.e),p}finally{}}function At(n,r,e){for(var o=n.next?n.next.e.nodes_start:e,i=r?r.e.nodes_start:e,a=n.e.nodes_start;a!==o;){var f=ye(a);i.before(a),a=f}}function U(n,r,e){r===null?n.first=e:(r.next=e,r.e.next=e&&e.e),e!==null&&(e.prev=r,e.e.prev=r&&r.e)}function Rt(n){var r,e,o="";if(typeof n=="string"||typeof n=="number")o+=n;else if(typeof n=="object")if(Array.isArray(n)){var i=n.length;for(r=0;r<i;r++)n[r]&&(e=Rt(n[r]))&&(o&&(o+=" "),o+=e)}else for(e in n)n[e]&&(o&&(o+=" "),o+=e);return o}function Te(){for(var n,r,e=0,o="",i=arguments.length;e<i;e++)(n=arguments[e])&&(r=Rt(n))&&(o&&(o+=" "),o+=r);return o}function Ie(n){return typeof n=="object"?Te(n):n??""}const Mt=[...` 	
\r\fÂ \v\uFEFF`];function Ye(n,r,e){var o=n==null?"":""+n;if(r&&(o=o?o+" "+r:r),e){for(var i in e)if(e[i])o=o?o+" "+i:i;else if(o.length)for(var a=i.length,f=0;(f=o.indexOf(i,f))>=0;){var t=f+a;(f===0||Mt.includes(o[f-1]))&&(t===o.length||Mt.includes(o[t]))?o=(f===0?"":o.substring(0,f))+o.substring(t+1):f=t}}return o===""?null:o}function St(n,r=!1){var e=r?" !important;":";",o="";for(var i in n){var a=n[i];a!=null&&a!==""&&(o+=" "+i+": "+a+e)}return o}function Xe(n,r){if(r){var e="",o,i;return Array.isArray(r)?(o=r[0],i=r[1]):o=r,o&&(e+=St(o)),i&&(e+=St(i,!0)),e=e.trim(),e===""?null:e}return String(n)}function R(n,r,e,o,i,a){var f=n.__className;if(D||f!==e||f===void 0){var t=Ye(e,o,a);(!D||t!==n.getAttribute("class"))&&(t==null?n.removeAttribute("class"):n.className=t),n.__className=e}else if(a&&i!==a)for(var s in a){var h=!!a[s];(i==null||h!==!!i[s])&&n.classList.toggle(s,h)}return a}function ct(n,r={},e,o){for(var i in e){var a=e[i];r[i]!==a&&(e[i]==null?n.style.removeProperty(i):n.style.setProperty(i,a,o))}}function ze(n,r,e,o){var i=n.__style;if(D||i!==r){var a=Xe(r,o);(!D||a!==n.getAttribute("style"))&&(a==null?n.removeAttribute("style"):n.style.cssText=a),n.__style=r}else o&&(Array.isArray(o)?(ct(n,e==null?void 0:e[0],o[0]),ct(n,e==null?void 0:e[1],o[1],"important")):ct(n,e,o));return o}const Oe=Symbol("is custom element"),Re=Symbol("is html");function Ce(n){if(D){var r=!1,e=()=>{if(!r){if(r=!0,n.hasAttribute("value")){var o=n.value;K(n,"value",null),n.value=o}if(n.hasAttribute("checked")){var i=n.checked;K(n,"checked",null),n.checked=i}}};n.__on_r=e,be(e),Vt()}}function K(n,r,e,o){var i=Le(n);D&&(i[r]=n.getAttribute(r),r==="src"||r==="srcset"||r==="href"&&n.nodeName==="LINK")||i[r]!==(i[r]=e)&&(r==="loading"&&(n[ve]=e),e==null?n.removeAttribute(r):typeof e!="string"&&Pe(n).includes(r)?n[r]=e:n.setAttribute(r,e))}function Le(n){return n.__attributes??(n.__attributes={[Oe]:n.nodeName.includes("-"),[Re]:n.namespaceURI===xe})}var Et=new Map;function Pe(n){var r=Et.get(n.nodeName);if(r)return r;Et.set(n.nodeName,r=[]);for(var e,o=n,i=Element.prototype;i!==o;){e=_e(o);for(var a in e)e[a].set&&r.push(a);o=me(o)}return r}function kt(n,r,e=r){var o=we();jt(n,"input",i=>{var a=i?n.defaultValue:n.value;if(a=ft(n)?dt(a):a,e(a),o&&a!==(a=r())){var f=n.selectionStart,t=n.selectionEnd;n.value=a??"",t!==null&&(n.selectionStart=f,n.selectionEnd=Math.min(t,n.value.length))}}),(D&&n.defaultValue!==n.value||Ae(r)==null&&n.value)&&e(ft(n)?dt(n.value):n.value),Me(()=>{var i=r();ft(n)&&i===dt(n.value)||n.type==="date"&&!i&&!n.value||i!==n.value&&(n.value=i??"")})}function ft(n){var r=n.type;return r==="number"||r==="range"}function dt(n){return n===""?null:+n}var Ue=H('<img alt="Uploaded Icon" class="rounded-lg w-[300px]"/>'),qe=H('<img alt="Uploaded Icon" class="rounded-lg w-[300px]"/>'),Be=H('<div class="flex flex-col gap-3.5 max-w-[350px] h-fit bg-neutral-950 text-white p-2.5 rounded-xl"><input type="text" placeholder="Node Title"/> <button>Upload Image</button> <input type="file" accept="image/*"/> <!> <textarea rows="6" maxlength="400" placeholder="Node Description"></textarea> <div class="relative inline-block h-fit"><button>Save</button> <button>Exit</button></div></div>');function He(n,r){nt(r,!0);const e=r.nodes[r.node_id];let o=X(V(e.name)),i=X(V(e.description)),a=X(V(e.image)),f,t,s,h=!1,d=!1;yt(()=>{t.value=e.name,s.value=e.description});const x=()=>{h=!0},c="bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700",v="font-mono text-lg bg-neutral-800 text-white rounded-xl p-2 pl-3 transition duration-300 focus:bg-gray-700 focus:ring-2 focus:ring-blue-500 outline-none";var p=Be(),A=j(p);Ce(A),R(A,1,v),A.__change=x,J(A,M=>t=M,()=>t);var b=Y(A,2);R(b,1,c),b.__click=M=>{f.click()};var g=Y(b,2);g.__change=M=>{const T=M.target;if(!T.files||T.files.length===0)return;const ot=T.files[0],W=new FileReader;W.onload=()=>{typeof W.result=="string"&&E(a,W.result,!0)},W.readAsDataURL(ot),x()},ze(g,"",{},{display:"none"}),J(g,M=>f=M,()=>f);var _=Y(g,2);{var I=M=>{var T=Ue();tt(()=>K(T,"src",u(a))),q(M,T)},k=M=>{var T=qe();tt(()=>K(T,"src",`${zt??""}/landscape-placeholder.svg`)),q(M,T)};Xt(_,M=>{u(a)!=""?M(I):M(k,!1)})}var S=Y(_,2);Wt(S),R(S,1,"font-mono text-lg bg-neutral-800 text-white rounded-xl p-2 pl-3 transition duration-300 focus:bg-gray-700 focus:ring-2 focus:ring-blue-500 outline-none placeholder:text-neutral-400 resize-none overflow-scroll"),S.__change=x,J(S,M=>s=M,()=>s);var N=Y(S,2),z=j(N);R(z,1,"bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700 float-left"),z.__click=()=>{d=r.saveNode(r.node_id,u(o),u(i),u(a))};var C=Y(z,2);R(C,1,"bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700 float-right"),C.__click=()=>r.exitNode(d,h),B(N),B(p),kt(A,()=>u(o),M=>E(o,M)),kt(S,()=>u(i),M=>E(i,M)),q(n,p),rt()}et(["change","click"]);var Fe=H("<button><img/></button>"),Ve=H('<div class="flex absolute rounded-xl bg-neutral-200 border-blue-300 border-2 p-[15px] pt-[5px] pb-[5px] h-fit bottom-6 left-[50%] transform -translate-[50%]"></div>');function je(n,r){nt(r,!0);let e=X(2),o=["node_add.png","node_edit.png","node_drag.png","link.png"];const i=Gt();Yt(()=>{i("modeChanged",u(e))});var a=Ve();ke(a,21,()=>o,Se,(f,t,s)=>{var h=Fe();h.__click=()=>E(e,s,!0);var d=j(h);B(h),tt(x=>{R(h,1,`p-2.5 rounded-xl border-none outline-none transition duration-200 hover:bg-blue-300 ${u(e)===s?"bg-gray-500 mt-auto mb-auto":"mt-[10px] mb-[10px]"}`),K(d,"src",`${zt??""}/mode_icons/${u(t)??""}`),K(d,"alt",x),R(d,1,Ie(u(e)===s?"max-w-[40px] rounded-xl":"max-w-[30px] rounded-lg"))},[()=>o[u(e)].split(".")[0]]),q(f,h)}),B(a),q(n,a),rt()}et(["click"]);function We(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ht={exports:{}},Nt;function Ge(){return Nt||(Nt=1,function(n,r){n.exports=e;function e(t,s){if(!(this instanceof e))return new e(t,s);this.x=t||0,this.y=s||0}e.fromArray=function(t){return new e(t[0]||0,t[1]||0)},e.fromObject=function(t){return new e(t.x||0,t.y||0)},e.prototype.addX=function(t){return this.x+=t.x,this},e.prototype.addY=function(t){return this.y+=t.y,this},e.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},e.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this},e.prototype.addScalarX=function(t){return this.x+=t,this},e.prototype.addScalarY=function(t){return this.y+=t,this},e.prototype.subtractX=function(t){return this.x-=t.x,this},e.prototype.subtractY=function(t){return this.y-=t.y,this},e.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},e.prototype.subtractScalar=function(t){return this.x-=t,this.y-=t,this},e.prototype.subtractScalarX=function(t){return this.x-=t,this},e.prototype.subtractScalarY=function(t){return this.y-=t,this},e.prototype.divideX=function(t){return this.x/=t.x,this},e.prototype.divideY=function(t){return this.y/=t.y,this},e.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this},e.prototype.divideScalar=function(t){return t!==0?(this.x/=t,this.y/=t):(this.x=0,this.y=0),this},e.prototype.divideScalarX=function(t){return t!==0?this.x/=t:this.x=0,this},e.prototype.divideScalarY=function(t){return t!==0?this.y/=t:this.y=0,this},e.prototype.invertX=function(){return this.x*=-1,this},e.prototype.invertY=function(){return this.y*=-1,this},e.prototype.invert=function(){return this.invertX(),this.invertY(),this},e.prototype.multiplyX=function(t){return this.x*=t.x,this},e.prototype.multiplyY=function(t){return this.y*=t.y,this},e.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},e.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},e.prototype.multiplyScalarX=function(t){return this.x*=t,this},e.prototype.multiplyScalarY=function(t){return this.y*=t,this},e.prototype.normalize=function(){var t=this.length();return t===0?(this.x=1,this.y=0):this.divide(e(t,t)),this},e.prototype.norm=e.prototype.normalize,e.prototype.limit=function(t,s){return Math.abs(this.x)>t&&(this.x*=s),Math.abs(this.y)>t&&(this.y*=s),this},e.prototype.randomize=function(t,s){return this.randomizeX(t,s),this.randomizeY(t,s),this},e.prototype.randomizeX=function(t,s){var h=Math.min(t.x,s.x),d=Math.max(t.x,s.x);return this.x=i(h,d),this},e.prototype.randomizeY=function(t,s){var h=Math.min(t.y,s.y),d=Math.max(t.y,s.y);return this.y=i(h,d),this},e.prototype.randomizeAny=function(t,s){return Math.round(Math.random())?this.randomizeX(t,s):this.randomizeY(t,s),this},e.prototype.unfloat=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},e.prototype.toFixed=function(t){return typeof t>"u"&&(t=8),this.x=this.x.toFixed(t),this.y=this.y.toFixed(t),this},e.prototype.mixX=function(t,s){return typeof s>"u"&&(s=.5),this.x=(1-s)*this.x+s*t.x,this},e.prototype.mixY=function(t,s){return typeof s>"u"&&(s=.5),this.y=(1-s)*this.y+s*t.y,this},e.prototype.mix=function(t,s){return this.mixX(t,s),this.mixY(t,s),this},e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.copyX=function(t){return this.x=t.x,this},e.prototype.copyY=function(t){return this.y=t.y,this},e.prototype.copy=function(t){return this.copyX(t),this.copyY(t),this},e.prototype.zero=function(){return this.x=this.y=0,this},e.prototype.dot=function(t){return this.x*t.x+this.y*t.y},e.prototype.cross=function(t){return this.x*t.y-this.y*t.x},e.prototype.projectOnto=function(t){var s=(this.x*t.x+this.y*t.y)/(t.x*t.x+t.y*t.y);return this.x=s*t.x,this.y=s*t.y,this},e.prototype.horizontalAngle=function(){return Math.atan2(this.y,this.x)},e.prototype.horizontalAngleDeg=function(){return a(this.horizontalAngle())},e.prototype.verticalAngle=function(){return Math.atan2(this.x,this.y)},e.prototype.verticalAngleDeg=function(){return a(this.verticalAngle())},e.prototype.angle=e.prototype.horizontalAngle,e.prototype.angleDeg=e.prototype.horizontalAngleDeg,e.prototype.direction=e.prototype.horizontalAngle,e.prototype.rotate=function(t){var s=this.x*Math.cos(t)-this.y*Math.sin(t),h=this.x*Math.sin(t)+this.y*Math.cos(t);return this.x=s,this.y=h,this},e.prototype.rotateDeg=function(t){return t=f(t),this.rotate(t)},e.prototype.rotateTo=function(t){return this.rotate(t-this.angle())},e.prototype.rotateToDeg=function(t){return t=f(t),this.rotateTo(t)},e.prototype.rotateBy=function(t){var s=this.angle()+t;return this.rotate(s)},e.prototype.rotateByDeg=function(t){return t=f(t),this.rotateBy(t)},e.prototype.distanceX=function(t){return this.x-t.x},e.prototype.absDistanceX=function(t){return Math.abs(this.distanceX(t))},e.prototype.distanceY=function(t){return this.y-t.y},e.prototype.absDistanceY=function(t){return Math.abs(this.distanceY(t))},e.prototype.distance=function(t){return Math.sqrt(this.distanceSq(t))},e.prototype.distanceSq=function(t){var s=this.distanceX(t),h=this.distanceY(t);return s*s+h*h},e.prototype.length=function(){return Math.sqrt(this.lengthSq())},e.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},e.prototype.magnitude=e.prototype.length,e.prototype.isZero=function(){return this.x===0&&this.y===0},e.prototype.isEqualTo=function(t){return this.x===t.x&&this.y===t.y},e.prototype.toString=function(){return"x:"+this.x+", y:"+this.y},e.prototype.toArray=function(){return[this.x,this.y]},e.prototype.toObject=function(){return{x:this.x,y:this.y}};var o=180/Math.PI;function i(t,s){return Math.floor(Math.random()*(s-t+1)+t)}function a(t){return t*o}function f(t){return t/o}}(ht)),ht.exports}var Je=Ge();const P=We(Je),Ke=[{id:0,name:"Addition",description:"",image:"",position:[100,100]},{id:1,name:"Subtraction",description:"",image:"",position:[300,150]},{id:2,name:"Multiplication",description:"",image:"",position:[200,300]},{id:3,name:"Division",description:"",image:"",position:[300,450]}],$e=[{from:0,to:1},{from:0,to:2},{from:2,to:3}],pt={nodes:Ke,links:$e};var Ze=H(`<div class="flex flex-col gap-0 absolute w-fit p-1 rounded-xl bottom-1 left-1 font-mono text-blue-300 bg-gray-700"><p class="text-center">------------------ Edit Log ------------------</p> <textarea class="resize-none h-[200px] max-h-[350px] overflow-y-scroll text-wrap outline-none" readonly="" cols="48">
    </textarea></div>`);function Qe(n,r){nt(r,!0);let e=V([]),o,i=X(0),a=V([]);const f=(x,c)=>{u(i)>0&&(e.splice(-u(i),u(i)),E(i,0)),a.push(x),e.push(c===void 0?x:x+`:
	`+c)},t=()=>{u(i)>a.length-1||(wt(i),e.push("Undo: "+a.at(-u(i))))},s=()=>{u(i)<1||(e.push("Redo: "+a.at(-u(i))),wt(i,-1))};Yt(()=>{o.value+=`
`+e.at(-1),o.scrollTop=o.scrollHeight}),yt(()=>{o.value=""});var h=Ze(),d=Y(j(h),2);return J(d,x=>o=x,()=>o),B(h),q(n,h),rt({log:f,undo:t,redo:s})}var tn=H('<div class="flex flex-row gap-3 w-min h-min p-3 absolute top-1 left-1 text-2xl"><button aria-label="Undo"><i class="fas fa-undo"></i></button> <button aria-label="Redo"><i class="fas fa-redo"></i></button></div>');function en(n,r){const e="border-none rounded-full w-fit h-fit bg-gray-300 p-2 pt-0.5 pb-1 text-center";var o=tn(),i=j(o);R(i,1,e),i.__click=function(...f){var t;(t=r.undo)==null||t.apply(this,f)};var a=Y(i,2);R(a,1,e),a.__click=function(...f){var t;(t=r.redo)==null||t.apply(this,f)},B(o),q(n,o)}et(["click"]);const nn=(n,r,e)=>{if(n.key==="Escape"&&u(r)&&E(r,!1),n.key==="o"&&window.confirm("Download new JSON?")){const o=JSON.stringify(u(e),null,4),i=new Blob([o],{type:"application/json"}),a=URL.createObjectURL(i),f=document.createElement("a");f.href=a,f.download="data.json",f.click(),URL.revokeObjectURL(a)}};var rn=n=>n.preventDefault(),on=H('<div id="canvas-box" class="relative inline-block overflow-hidden"><canvas tabindex="0"></canvas> <div class="absolute right-2.5 top-2.5"><!></div> <!> <!> <!></div>');function an(n,r){nt(r,!0);const e=l=>({nodes:l.nodes.map(y=>({...y,position:[...y.position]})),links:l.links.map(y=>({...y}))}),o=()=>{const l=v.at(-p)??u(c);if(E(c,e(l),!0),A.length!==u(c).nodes.length){for(;A.length<u(c).nodes.length;)A.push(new Image);for(;A.length>u(c).nodes.length;)A.pop()}u(c).nodes.forEach((m,w)=>{A[w].src=m.image});const y=u(c).nodes.find(m=>m.id===u(b).id);y?E(b,y,!0):E(b,u(c).nodes[0],!0)};let i,a=new P(0,0),f=1,t=X(!1),s,h,d,x=new P(0,0),c=X(V(e(pt))),v=[e(pt)],p=1,A=[],b=X(V(pt.nodes[0])),g=X(!1),_=X(!1),I,k=X(!1),S=0,N;const z=()=>{const l=i.getContext("2d");if(l===null)throw new Error("DRAW LOOP - ctx is null");i.width=window.innerWidth,i.height=window.innerHeight,l.clearRect(0,0,i.width,i.height),u(k)&&(l.beginPath(),l.moveTo(u(b).position[0]-a.x,u(b).position[1]-a.y),l.lineTo(d.x,d.y),l.lineWidth=10,l.strokeStyle="rgba(0, 0, 0, 0.35)",l.stroke()),u(c).links.forEach(y=>{l.beginPath();const m=u(c).nodes[y.from],w=u(c).nodes[y.to];l.moveTo(m.position[0]-a.x,m.position[1]-a.y),l.lineTo(w.position[0]-a.x,w.position[1]-a.y),l.lineWidth=10,l.strokeStyle="black",l.stroke()}),u(c).nodes.forEach((y,m)=>{A[m].src=y.image;const w=P.fromArray(y.position).subtract(a),O=25;l.beginPath(),l.arc(w.x,w.y,20,0,Math.PI*2),l.fillStyle="black",l.fill(),l.drawImage(A[m],w.x-O/2,w.y-O/2,O,O)}),requestAnimationFrame(z)},C=l=>{const y=i.getBoundingClientRect(),m=(l.clientX-y.left+a.x)/f,w=(l.clientY-y.top+a.y)/f;return new P(m,w)},M=(l,y,m)=>{const w=y.clone().subtract(l),F=m.clone().subtract(l).dot(w)/w.lengthSq();if(F<0||F>1)return 1e6;const G=Math.abs(y.clone().subtract(l).cross(m.clone().subtract(l))),Q=y.clone().subtract(l).length();return G/Q},T=l=>{if(u(_))return;const y=C(l);let m=u(c).nodes.find(w=>P.fromArray(w.position).distanceSq(y)<400);if(E(b,m??u(b),!0),l.button===0){if(S===1){if(!m)return;E(_,!0)}else if(S===2){if(!m)return;x=y.clone().subtract(P.fromArray(u(b).position)),E(g,!0)}else if(S===3)if(m)if(u(k)){if(I.id===u(b).id)return;u(c).links.push({from:I.id,to:u(b).id}),E(k,!1),Z(),N.log("Create link",`node ${I.id} -> ${u(b).id}`)}else I=m,E(k,!0),d=y;else{const w=u(c).links.findIndex(O=>{const F=u(c).nodes[O.from],G=u(c).nodes[O.to];return M(P.fromArray(F.position),P.fromArray(G.position),y)<10});w!==-1&&(u(c).links.splice(w,1),Z(),N.log("Delete link",`node ${I.id} -> ${u(b).id}`))}}l.button===2&&(E(t,!0),s=y,h=a.clone())},ot=l=>{if(u(_))return;const y=C(l);if(d=y,u(g)){let m=u(c).nodes.find(w=>w.id===u(b).id);if(m===void 0)throw new Error("uhhh focusNode error, it's not in the list...");m.position=y.clone().subtract(x).toArray()}else if(u(t)){const m=y.clone().subtract(s);a=h.clone().subtract(m)}},W=l=>{u(_)||(u(g)&&(E(g,!1),Z(),N.log("Set node position")),E(t,!1))},Ct=l=>{l.preventDefault()},Lt=(l,y,m,w)=>{let O=[u(c).nodes[l].name===y?"":"name",u(c).nodes[l].description===m?"":"description",u(c).nodes[l].image===w?"":"image"],F=[];O.forEach(Q=>{Q!==""&&F.push(Q)});const G=F.join(", ");return G===""||!window.confirm("Save this node with new contents?")?!1:(u(c).nodes[l].name=y,u(c).nodes[l].description=m,u(c).nodes[l].image=w,Z(),N.log("Update node contents",G),!0)},Pt=(l,y)=>{!l&&y&&!window.confirm("Stop editing without saving?")||E(_,!1)},Z=()=>{p>1&&(v.splice(-p+1,p-1),p=1),v.push(e(u(c))),console.log(v),console.log(p)},Ut=()=>{p>v.length-1||(p++,o(),N.undo(),console.log(v),console.log(p))},qt=()=>{p<2||(p--,o(),N.redo(),console.log(v),console.log(p))};yt(()=>{A=u(c).nodes.map(l=>{let y=new Image;return y.src=l.image,y}),z()});var it=on(),L=j(it);let gt;L.__mousemove=ot,L.__mousedown=T,L.__mouseup=W,L.__keydown=[nn,k,c],L.__contextmenu=[rn],J(L,l=>i=l,()=>i);var at=Y(L,2),Bt=j(at);{var Ht=l=>{He(l,{get node_id(){return u(b).id},saveNode:Lt,exitNode:Pt,get nodes(){return u(c).nodes}})};Xt(Bt,l=>{u(_)&&l(Ht)})}B(at);var vt=Y(at,2);J(Qe(vt,{}),l=>N=l,()=>N);var xt=Y(vt,2);en(xt,{undo:Ut,redo:qt});var Ft=Y(xt,2);je(Ft,{$$events:{modeChanged:l=>S=l.detail}}),B(it),tt(l=>gt=R(L,1,"bg-neutral-100",null,gt,l),[()=>({"cursor-grabbing":u(g)||u(t)})]),Jt("wheel",L,Ct),q(n,it),rt()}et(["mousemove","mousedown","mouseup","keydown","contextmenu"]);function hn(n){an(n,{})}export{hn as component};
