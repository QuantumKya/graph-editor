import"../chunks/CWj6FrbW.js";import"../chunks/CwZKfcDM.js";import{a as Vt,l as jt,d as et,o as yt,r as Wt,c as Gt,e as Jt}from"../chunks/BYhcaexx.js";import{a4 as Kt,b as Zt,s as at,h as T,M as Qt,a as te,A as a,ak as ee,r as ne,c as re,d as bt,f as lt,j as Z,Y as oe,$ as ie,g as Tt,i as It,p as se,aw as ut,a2 as Yt,R as _t,ax as ae,as as le,ay as wt,az as ue,aA as ce,N as fe,aB as de,aC as he,aD as pe,aE as ye,Z as ge,W as ve,aF as xe,aG as me,aH as be,aI as _e,aJ as we,aK as Ae,u as Me,l as Ee,D as nt,at as O,al as V,F as $,J as j,L as z,am as S,K as F,t as H,I as rt,G as tt,x as Xt,aL as At}from"../chunks/BKZJkl96.js";import{b as J,i as zt}from"../chunks/4slWvAw0.js";import{b as Ot}from"../chunks/CucUKgKY.js";function Se(n,r){return r}function ke(n,r,e,o){for(var i=[],s=r.length,f=0;f<s;f++)ce(r[f].e,i,!0);var t=s>0&&i.length===0&&e!==null;if(t){var l=e.parentNode;fe(l),l.append(e),o.clear(),B(n,r[0].prev,r[s-1].next)}de(i,()=>{for(var p=0;p<s;p++){var h=r[p];t||(o.delete(h.k),B(n,h.prev,h.next)),he(h.e,!t)}})}function De(n,r,e,o,i,s=null){var f=n,t={flags:r,items:new Map,first:null};{var l=n;f=T?at(Qt(l)):l.appendChild(Kt())}T&&te();var p=null,h=!1,b=ee(()=>{var u=e();return ve(u)?u:u==null?[]:Yt(u)});Zt(()=>{var u=a(b),x=u.length;if(h&&x===0)return;h=x===0;let y=!1;if(T){var w=ne(f)===re;w!==(x===0)&&(f=bt(),at(f),lt(!1),y=!0)}if(T){for(var _=null,g,A=0;A<x;A++){if(Z.nodeType===oe&&Z.data===ie){f=Z,y=!0,lt(!1);break}var Y=u[A],N=o(Y,A);g=Ct(Z,t,_,null,Y,N,A,i,r,e),t.items.set(N,g),_=g}x>0&&at(bt())}T||Ne(u,t,f,i,r,o,e),s!==null&&(x===0?p?Tt(p):p=It(()=>s(f)):p!==null&&se(p,()=>{p=null})),y&&lt(!0),a(b)}),T&&(f=Z)}function Ne(n,r,e,o,i,s,f){var t=n.length,l=r.items,p=r.first,h=p,b,u=null,x=[],y=[],w,_,g,A;for(A=0;A<t;A+=1){if(w=n[A],_=s(w,A),g=l.get(_),g===void 0){var Y=h?h.e.nodes_start:e;u=Ct(Y,r,u,u===null?r.first:u.next,w,_,A,o,i,f),l.set(_,u),x=[],y=[],h=u.next;continue}if(Te(g,w,A),(g.e.f&ut)!==0&&Tt(g.e),g!==h){if(b!==void 0&&b.has(g)){if(x.length<y.length){var N=y[0],E;u=N.prev;var D=x[0],C=x[x.length-1];for(E=0;E<x.length;E+=1)Mt(x[E],N,e);for(E=0;E<y.length;E+=1)b.delete(y[E]);B(r,D.prev,C.next),B(r,u,D),B(r,C,N),h=N,u=C,A-=1,x=[],y=[]}else b.delete(g),Mt(g,h,e),B(r,g.prev,g.next),B(r,g,u===null?r.first:u.next),B(r,u,g),u=g;continue}for(x=[],y=[];h!==null&&h.k!==_;)(h.e.f&ut)===0&&(b??(b=new Set)).add(h),y.push(h),h=h.next;if(h===null)continue;g=h}x.push(g),u=g,h=g.next}if(h!==null||b!==void 0){for(var R=b===void 0?[]:Yt(b);h!==null;)(h.e.f&ut)===0&&R.push(h),h=h.next;var M=R.length;if(M>0){var I=t===0?e:null;ke(r,R,I,l)}}_t.first=r.first&&r.first.e,_t.last=u&&u.e}function Te(n,r,e,o){ae(n.v,r),n.i=e}function Ct(n,r,e,o,i,s,f,t,l,p){var h=(l&pe)!==0,b=(l&ye)===0,u=h?b?le(i,!1,!1):wt(i):i,x=(l&ue)===0?f:wt(f),y={i:x,v:u,k:s,a:null,e:null,prev:e,next:o};try{return y.e=It(()=>t(n,u,x,p),T),y.e.prev=e&&e.e,y.e.next=o&&o.e,e===null?r.first=y:(e.next=y,e.e.next=y.e),o!==null&&(o.prev=y,o.e.prev=y.e),y}finally{}}function Mt(n,r,e){for(var o=n.next?n.next.e.nodes_start:e,i=r?r.e.nodes_start:e,s=n.e.nodes_start;s!==o;){var f=ge(s);i.before(s),s=f}}function B(n,r,e){r===null?n.first=e:(r.next=e,r.e.next=e&&e.e),e!==null&&(e.prev=r,e.e.prev=r&&r.e)}function Lt(n){var r,e,o="";if(typeof n=="string"||typeof n=="number")o+=n;else if(typeof n=="object")if(Array.isArray(n)){var i=n.length;for(r=0;r<i;r++)n[r]&&(e=Lt(n[r]))&&(o&&(o+=" "),o+=e)}else for(e in n)n[e]&&(o&&(o+=" "),o+=e);return o}function Ie(){for(var n,r,e=0,o="",i=arguments.length;e<i;e++)(n=arguments[e])&&(r=Lt(n))&&(o&&(o+=" "),o+=r);return o}function Ye(n){return typeof n=="object"?Ie(n):n??""}const Et=[...` 	
\r\fÂ \v\uFEFF`];function Xe(n,r,e){var o=n==null?"":""+n;if(r&&(o=o?o+" "+r:r),e){for(var i in e)if(e[i])o=o?o+" "+i:i;else if(o.length)for(var s=i.length,f=0;(f=o.indexOf(i,f))>=0;){var t=f+s;(f===0||Et.includes(o[f-1]))&&(t===o.length||Et.includes(o[t]))?o=(f===0?"":o.substring(0,f))+o.substring(t+1):f=t}}return o===""?null:o}function St(n,r=!1){var e=r?" !important;":";",o="";for(var i in n){var s=n[i];s!=null&&s!==""&&(o+=" "+i+": "+s+e)}return o}function ze(n,r){if(r){var e="",o,i;return Array.isArray(r)?(o=r[0],i=r[1]):o=r,o&&(e+=St(o)),i&&(e+=St(i,!0)),e=e.trim(),e===""?null:e}return String(n)}function L(n,r,e,o,i,s){var f=n.__className;if(T||f!==e||f===void 0){var t=Xe(e,o,s);(!T||t!==n.getAttribute("class"))&&(t==null?n.removeAttribute("class"):n.className=t),n.__className=e}else if(s&&i!==s)for(var l in s){var p=!!s[l];(i==null||p!==!!i[l])&&n.classList.toggle(l,p)}return s}function ct(n,r={},e,o){for(var i in e){var s=e[i];r[i]!==s&&(e[i]==null?n.style.removeProperty(i):n.style.setProperty(i,s,o))}}function Oe(n,r,e,o){var i=n.__style;if(T||i!==r){var s=ze(r,o);(!T||s!==n.getAttribute("style"))&&(s==null?n.removeAttribute("style"):n.style.cssText=s),n.__style=r}else o&&(Array.isArray(o)?(ct(n,e==null?void 0:e[0],o[0]),ct(n,e==null?void 0:e[1],o[1],"important")):ct(n,e,o));return o}const Ce=Symbol("is custom element"),Le=Symbol("is html");function Re(n){if(T){var r=!1,e=()=>{if(!r){if(r=!0,n.hasAttribute("value")){var o=n.value;K(n,"value",null),n.value=o}if(n.hasAttribute("checked")){var i=n.checked;K(n,"checked",null),n.checked=i}}};n.__on_r=e,_e(e),Vt()}}function K(n,r,e,o){var i=Pe(n);T&&(i[r]=n.getAttribute(r),r==="src"||r==="srcset"||r==="href"&&n.nodeName==="LINK")||i[r]!==(i[r]=e)&&(r==="loading"&&(n[xe]=e),e==null?n.removeAttribute(r):typeof e!="string"&&Ue(n).includes(r)?n[r]=e:n.setAttribute(r,e))}function Pe(n){return n.__attributes??(n.__attributes={[Ce]:n.nodeName.includes("-"),[Le]:n.namespaceURI===me})}var kt=new Map;function Ue(n){var r=kt.get(n.nodeName);if(r)return r;kt.set(n.nodeName,r=[]);for(var e,o=n,i=Element.prototype;i!==o;){e=we(o);for(var s in e)e[s].set&&r.push(s);o=be(o)}return r}function Dt(n,r,e=r){var o=Ae();jt(n,"input",i=>{var s=i?n.defaultValue:n.value;if(s=ft(n)?dt(s):s,e(s),o&&s!==(s=r())){var f=n.selectionStart,t=n.selectionEnd;n.value=s??"",t!==null&&(n.selectionStart=f,n.selectionEnd=Math.min(t,n.value.length))}}),(T&&n.defaultValue!==n.value||Me(r)==null&&n.value)&&e(ft(n)?dt(n.value):n.value),Ee(()=>{var i=r();ft(n)&&i===dt(n.value)||n.type==="date"&&!i&&!n.value||i!==n.value&&(n.value=i??"")})}function ft(n){var r=n.type;return r==="number"||r==="range"}function dt(n){return n===""?null:+n}var qe=$('<img alt="Uploaded Icon" class="rounded-lg w-[300px]"/>'),Be=$('<img alt="Uploaded Icon" class="rounded-lg w-[300px]"/>'),He=$('<div class="flex flex-col gap-3.5 max-w-[350px] h-fit bg-neutral-950 text-white p-2.5 rounded-xl"><input type="text" placeholder="Node Title"/> <button>Upload Image</button> <input type="file" accept="image/*"/> <!> <textarea rows="6" maxlength="400" placeholder="Node Description"></textarea> <div class="relative inline-block h-fit"><button>Save</button> <button>Exit</button></div></div>');function Fe(n,r){nt(r,!0);const e=r.nodes[r.node_id];let o=O(V(e.name)),i=O(V(e.description)),s=O(V(e.image)),f,t,l,p=!1,h=!1;yt(()=>{t.value=e.name,l.value=e.description});const b=()=>{p=!0},u="bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700",x="font-mono text-lg bg-neutral-800 text-white rounded-xl p-2 pl-3 transition duration-300 focus:bg-gray-700 focus:ring-2 focus:ring-blue-500 outline-none";var y=He(),w=j(y);Re(w),L(w,1,x),w.__change=b,J(w,M=>t=M,()=>t);var _=z(w,2);L(_,1,u),_.__click=M=>{f.click()};var g=z(_,2);g.__change=M=>{const I=M.target;if(!I.files||I.files.length===0)return;const ot=I.files[0],W=new FileReader;W.onload=()=>{typeof W.result=="string"&&S(s,W.result,!0)},W.readAsDataURL(ot),b()},Oe(g,"",{},{display:"none"}),J(g,M=>f=M,()=>f);var A=z(g,2);{var Y=M=>{var I=qe();tt(()=>K(I,"src",a(s))),H(M,I)},N=M=>{var I=Be();tt(()=>K(I,"src",`${Ot??""}/landscape-placeholder.svg`)),H(M,I)};zt(A,M=>{a(s)!=""?M(Y):M(N,!1)})}var E=z(A,2);Wt(E),L(E,1,"font-mono text-lg bg-neutral-800 text-white rounded-xl p-2 pl-3 transition duration-300 focus:bg-gray-700 focus:ring-2 focus:ring-blue-500 outline-none placeholder:text-neutral-400 resize-none overflow-scroll"),E.__change=b,J(E,M=>l=M,()=>l);var D=z(E,2),C=j(D);L(C,1,"bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700 float-left"),C.__click=()=>{h=r.saveNode(r.node_id,a(o),a(i),a(s))};var R=z(C,2);L(R,1,"bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700 float-right"),R.__click=()=>r.exitNode(h,p),F(D),F(y),Dt(w,()=>a(o),M=>S(o,M)),Dt(E,()=>a(i),M=>S(i,M)),H(n,y),rt()}et(["change","click"]);var $e=$("<button><img/></button>"),Ve=$('<div class="flex absolute rounded-xl bg-neutral-200 border-blue-300 border-2 p-[15px] pt-[5px] pb-[5px] h-fit bottom-6 left-[50%] transform -translate-[50%]"></div>');function je(n,r){nt(r,!0);let e=O(2),o=["node_add.png","node_edit.png","node_drag.png","link.png"];const i=Gt();Xt(()=>{i("modeChanged",a(e))});var s=Ve();De(s,21,()=>o,Se,(f,t,l)=>{var p=$e();p.__click=()=>S(e,l,!0);var h=j(p);F(p),tt(b=>{L(p,1,`p-2.5 rounded-xl border-none outline-none transition duration-200 hover:bg-blue-300 ${a(e)===l?"bg-gray-500 mt-auto mb-auto":"mt-[10px] mb-[10px]"}`),K(h,"src",`${Ot??""}/mode_icons/${a(t)??""}`),K(h,"alt",b),L(h,1,Ye(a(e)===l?"max-w-[40px] rounded-xl":"max-w-[30px] rounded-lg"))},[()=>o[a(e)].split(".")[0]]),H(f,p)}),F(s),H(n,s),rt()}et(["click"]);function We(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ht={exports:{}},Nt;function Ge(){return Nt||(Nt=1,function(n,r){n.exports=e;function e(t,l){if(!(this instanceof e))return new e(t,l);this.x=t||0,this.y=l||0}e.fromArray=function(t){return new e(t[0]||0,t[1]||0)},e.fromObject=function(t){return new e(t.x||0,t.y||0)},e.prototype.addX=function(t){return this.x+=t.x,this},e.prototype.addY=function(t){return this.y+=t.y,this},e.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},e.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this},e.prototype.addScalarX=function(t){return this.x+=t,this},e.prototype.addScalarY=function(t){return this.y+=t,this},e.prototype.subtractX=function(t){return this.x-=t.x,this},e.prototype.subtractY=function(t){return this.y-=t.y,this},e.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},e.prototype.subtractScalar=function(t){return this.x-=t,this.y-=t,this},e.prototype.subtractScalarX=function(t){return this.x-=t,this},e.prototype.subtractScalarY=function(t){return this.y-=t,this},e.prototype.divideX=function(t){return this.x/=t.x,this},e.prototype.divideY=function(t){return this.y/=t.y,this},e.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this},e.prototype.divideScalar=function(t){return t!==0?(this.x/=t,this.y/=t):(this.x=0,this.y=0),this},e.prototype.divideScalarX=function(t){return t!==0?this.x/=t:this.x=0,this},e.prototype.divideScalarY=function(t){return t!==0?this.y/=t:this.y=0,this},e.prototype.invertX=function(){return this.x*=-1,this},e.prototype.invertY=function(){return this.y*=-1,this},e.prototype.invert=function(){return this.invertX(),this.invertY(),this},e.prototype.multiplyX=function(t){return this.x*=t.x,this},e.prototype.multiplyY=function(t){return this.y*=t.y,this},e.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},e.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},e.prototype.multiplyScalarX=function(t){return this.x*=t,this},e.prototype.multiplyScalarY=function(t){return this.y*=t,this},e.prototype.normalize=function(){var t=this.length();return t===0?(this.x=1,this.y=0):this.divide(e(t,t)),this},e.prototype.norm=e.prototype.normalize,e.prototype.limit=function(t,l){return Math.abs(this.x)>t&&(this.x*=l),Math.abs(this.y)>t&&(this.y*=l),this},e.prototype.randomize=function(t,l){return this.randomizeX(t,l),this.randomizeY(t,l),this},e.prototype.randomizeX=function(t,l){var p=Math.min(t.x,l.x),h=Math.max(t.x,l.x);return this.x=i(p,h),this},e.prototype.randomizeY=function(t,l){var p=Math.min(t.y,l.y),h=Math.max(t.y,l.y);return this.y=i(p,h),this},e.prototype.randomizeAny=function(t,l){return Math.round(Math.random())?this.randomizeX(t,l):this.randomizeY(t,l),this},e.prototype.unfloat=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},e.prototype.toFixed=function(t){return typeof t>"u"&&(t=8),this.x=this.x.toFixed(t),this.y=this.y.toFixed(t),this},e.prototype.mixX=function(t,l){return typeof l>"u"&&(l=.5),this.x=(1-l)*this.x+l*t.x,this},e.prototype.mixY=function(t,l){return typeof l>"u"&&(l=.5),this.y=(1-l)*this.y+l*t.y,this},e.prototype.mix=function(t,l){return this.mixX(t,l),this.mixY(t,l),this},e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.copyX=function(t){return this.x=t.x,this},e.prototype.copyY=function(t){return this.y=t.y,this},e.prototype.copy=function(t){return this.copyX(t),this.copyY(t),this},e.prototype.zero=function(){return this.x=this.y=0,this},e.prototype.dot=function(t){return this.x*t.x+this.y*t.y},e.prototype.cross=function(t){return this.x*t.y-this.y*t.x},e.prototype.projectOnto=function(t){var l=(this.x*t.x+this.y*t.y)/(t.x*t.x+t.y*t.y);return this.x=l*t.x,this.y=l*t.y,this},e.prototype.horizontalAngle=function(){return Math.atan2(this.y,this.x)},e.prototype.horizontalAngleDeg=function(){return s(this.horizontalAngle())},e.prototype.verticalAngle=function(){return Math.atan2(this.x,this.y)},e.prototype.verticalAngleDeg=function(){return s(this.verticalAngle())},e.prototype.angle=e.prototype.horizontalAngle,e.prototype.angleDeg=e.prototype.horizontalAngleDeg,e.prototype.direction=e.prototype.horizontalAngle,e.prototype.rotate=function(t){var l=this.x*Math.cos(t)-this.y*Math.sin(t),p=this.x*Math.sin(t)+this.y*Math.cos(t);return this.x=l,this.y=p,this},e.prototype.rotateDeg=function(t){return t=f(t),this.rotate(t)},e.prototype.rotateTo=function(t){return this.rotate(t-this.angle())},e.prototype.rotateToDeg=function(t){return t=f(t),this.rotateTo(t)},e.prototype.rotateBy=function(t){var l=this.angle()+t;return this.rotate(l)},e.prototype.rotateByDeg=function(t){return t=f(t),this.rotateBy(t)},e.prototype.distanceX=function(t){return this.x-t.x},e.prototype.absDistanceX=function(t){return Math.abs(this.distanceX(t))},e.prototype.distanceY=function(t){return this.y-t.y},e.prototype.absDistanceY=function(t){return Math.abs(this.distanceY(t))},e.prototype.distance=function(t){return Math.sqrt(this.distanceSq(t))},e.prototype.distanceSq=function(t){var l=this.distanceX(t),p=this.distanceY(t);return l*l+p*p},e.prototype.length=function(){return Math.sqrt(this.lengthSq())},e.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},e.prototype.magnitude=e.prototype.length,e.prototype.isZero=function(){return this.x===0&&this.y===0},e.prototype.isEqualTo=function(t){return this.x===t.x&&this.y===t.y},e.prototype.toString=function(){return"x:"+this.x+", y:"+this.y},e.prototype.toArray=function(){return[this.x,this.y]},e.prototype.toObject=function(){return{x:this.x,y:this.y}};var o=180/Math.PI;function i(t,l){return Math.floor(Math.random()*(l-t+1)+t)}function s(t){return t*o}function f(t){return t/o}}(ht)),ht.exports}var Je=Ge();const q=We(Je),Ke=[{id:0,name:"Addition",description:"",image:"",position:[100,100]},{id:1,name:"Subtraction",description:"",image:"",position:[300,150]},{id:2,name:"Multiplication",description:"",image:"",position:[200,300]},{id:3,name:"Division",description:"",image:"",position:[300,450]}],Ze=[{from:0,to:1},{from:0,to:2},{from:2,to:3}],pt={nodes:Ke,links:Ze};var Qe=$(`<div class="flex flex-col gap-0 absolute w-fit p-1 rounded-xl bottom-1 left-1 font-mono text-blue-300 bg-gray-700"><p class="text-center">------------------ Edit Log ------------------</p> <textarea class="resize-none overflow-y-scroll text-wrap outline-none" readonly="" cols="48" rows="8">
    </textarea></div>`);function tn(n,r){nt(r,!0);let e=V([]),o,i=O(0),s=V([]);const f=(b,u)=>{a(i)>0&&(e.splice(-a(i),a(i)),S(i,0)),s.push(b),e.push(u===void 0?b:b+`:
	`+u)},t=()=>{a(i)>s.length-1||(At(i),e.push("Undo: "+s.at(-a(i))))},l=()=>{a(i)<1||(e.push("Redo: "+s.at(-a(i))),At(i,-1))};Xt(()=>{o.value+=`
`+e.at(-1),o.scrollTop=o.scrollHeight}),yt(()=>{o.value=""});var p=Qe(),h=z(j(p),2);return J(h,b=>o=b,()=>o),F(p),H(n,p),rt({log:f,undo:t,redo:l})}var en=$('<div class="flex flex-row gap-3 w-min h-min p-3 absolute top-1 left-1 text-2xl"><button aria-label="Undo"><i class="fas fa-undo"></i></button> <button aria-label="Redo"><i class="fas fa-redo"></i></button></div>');function nn(n,r){const e="border-none rounded-full w-fit h-fit bg-gray-300 p-2 pt-0.5 pb-1 text-center";var o=en(),i=j(o);L(i,1,e),i.__click=function(...f){var t;(t=r.undo)==null||t.apply(this,f)};var s=z(i,2);L(s,1,e),s.__click=function(...f){var t;(t=r.redo)==null||t.apply(this,f)},F(o),H(n,o)}et(["click"]);const rn=(n,r,e)=>{if(n.key==="Escape"&&a(r)&&S(r,!1),n.key==="o"&&window.confirm("Download new JSON?")){const o=JSON.stringify(a(e),null,4),i=new Blob([o],{type:"application/json"}),s=URL.createObjectURL(i),f=document.createElement("a");f.href=s,f.download="data.json",f.click(),URL.revokeObjectURL(s)}};var on=n=>n.preventDefault(),sn=$('<div id="canvas-box" class="relative inline-block overflow-hidden"><canvas tabindex="0"></canvas> <div class="absolute right-2.5 top-2.5"><!></div> <!> <!> <!></div>');function an(n,r){nt(r,!0);const e=c=>({nodes:c.nodes.map(d=>({...d,position:[...d.position]})),links:c.links.map(d=>({...d}))}),o=()=>{const c=x.at(-y)??a(u);if(S(u,e(c),!0),w.length!==a(u).nodes.length){for(;w.length<a(u).nodes.length;)w.push(new Image);for(;w.length>a(u).nodes.length;)w.pop()}a(u).nodes.forEach((v,m)=>{w[m].src=v.image});const d=a(u).nodes.find(v=>v.id===a(_).id);d?S(_,d,!0):S(_,a(u).nodes[0],!0)};let i,s=new q(0,0),f=1,t=O(!1),l,p,h,b=new q(0,0),u=O(V(e(pt))),x=[e(pt)],y=1,w=[],_=O(V(pt.nodes[0])),g=O(!1),A=O(!1),Y,N=O(!1),E=0,D;const C=()=>{const c=i.getContext("2d");if(c===null)throw new Error("DRAW LOOP - ctx is null");i.width=window.innerWidth,i.height=window.innerHeight,c.clearRect(0,0,i.width,i.height),a(N)&&(c.beginPath(),c.moveTo(a(_).position[0]-s.x,a(_).position[1]-s.y),c.lineTo(h.x,h.y),c.lineWidth=10,c.strokeStyle="rgba(0, 0, 0, 0.35)",c.stroke()),a(u).links.forEach(d=>{c.beginPath();const v=a(u).nodes.find(k=>k.id===d.from)??a(u).nodes[0],m=a(u).nodes.find(k=>k.id===d.to)??a(u).nodes[0];c.moveTo(v.position[0]-s.x,v.position[1]-s.y),c.lineTo(m.position[0]-s.x,m.position[1]-s.y),c.lineWidth=10,c.strokeStyle="black",c.stroke()}),a(u).nodes.forEach((d,v)=>{const m=q.fromArray(d.position).subtract(s),k=25;c.beginPath(),c.arc(m.x,m.y,20,0,Math.PI*2),c.fillStyle="black",c.fill(),c.drawImage(w[v],m.x-k/2,m.y-k/2,k,k)}),requestAnimationFrame(C)},R=c=>{const d=i.getBoundingClientRect(),v=(c.clientX-d.left+s.x)/f,m=(c.clientY-d.top+s.y)/f;return new q(v,m)},M=(c,d,v)=>{const m=d.clone().subtract(c),X=v.clone().subtract(c).dot(m)/m.lengthSq();if(X<0||X>1)return 1e6;const U=Math.abs(d.clone().subtract(c).cross(v.clone().subtract(c))),Q=d.clone().subtract(c).length();return U/Q},I=c=>{if(a(A))return;const d=R(c);let v=a(u).nodes.find(m=>q.fromArray(m.position).distanceSq(d)<400);if(S(_,v??a(_),!0),c.button===0){if(E===0){if(!v)a(u).nodes.push({id:-1,name:"",description:"",image:"",position:d.toArray()}),gt(),w.push(new Image),G(),D.log("Create node");else if(window.confirm("Delete node and its links?")){const m=v.id;a(u).nodes.splice(m,1),S(_,a(u).nodes[0],!0),w.splice(m,1);let k=[];a(u).links.forEach((X,U)=>{(X.from===m||X.to===m)&&k.push(U)});for(const X of k)a(u).links.splice(X,1);gt(),G(),D.log("Delete node",`Node ID: ${m}, ${k.length} links destroyed`)}}else if(E===1){if(!v)return;S(A,!0)}else if(E===2){if(!v)return;b=d.clone().subtract(q.fromArray(a(_).position)),S(g,!0)}else if(E===3)if(v)if(a(N)){if(Y.id===a(_).id)return;a(u).links.push({from:Y.id,to:a(_).id}),S(N,!1),G(),D.log("Create link",`node ${Y.id} -> ${a(_).id}`)}else Y=v,S(N,!0),h=d;else{const m=a(u).links.findIndex(k=>{const X=a(u).nodes[k.from],U=a(u).nodes[k.to];return M(q.fromArray(X.position),q.fromArray(U.position),d)<10});m!==-1&&(a(u).links.splice(m,1),G(),D.log("Delete link",`node ${Y.id} -> ${a(_).id}`))}}c.button===2&&(S(t,!0),l=d,p=s.clone())},ot=c=>{if(a(A))return;const d=R(c);if(h=d,a(g)){let v=a(u).nodes.find(m=>m.id===a(_).id);if(v===void 0)throw new Error("uhhh focusNode error, it's not in the list...");v.position=d.clone().subtract(b).toArray()}else if(a(t)){const v=d.clone().subtract(l);s=p.clone().subtract(v)}},W=c=>{a(A)||(a(g)&&(S(g,!1),G(),D.log("Set node position")),S(t,!1))},Rt=c=>{c.preventDefault()},Pt=(c,d,v,m)=>{let k=[a(u).nodes[c].name===d?"":"name",a(u).nodes[c].description===v?"":"description",a(u).nodes[c].image===m?"":"image"],X=[];k.forEach(Q=>{Q!==""&&X.push(Q)});const U=X.join(", ");return U===""||!window.confirm("Save this node with new contents?")?!1:(a(u).nodes[c].name=d,a(u).nodes[c].description=v,a(u).nodes[c].image=m,G(),D.log("Update node contents",U),!0)},Ut=(c,d)=>{!c&&d&&!window.confirm("Stop editing without saving?")||S(A,!1)},G=()=>{y>1&&(x.splice(-y+1,y-1),y=1),x.push(e(a(u))),console.log(x),console.log(y)},qt=()=>{y>x.length-1||(y++,o(),D.undo(),console.log(x),console.log(y))},Bt=()=>{y<2||(y--,o(),D.redo(),console.log(x),console.log(y))},gt=()=>{const c=new Map(a(u).nodes.map((d,v)=>[d.id,v]));a(u).nodes.forEach((d,v)=>d.id=v),a(u).links.forEach(d=>{console.log(`${d.from}, ${d.to}`),d.from=c.get(d.from)??d.from,d.to=c.get(d.to)??d.to,console.log(`${d.from}, ${d.to}`)})};yt(()=>{w=a(u).nodes.map(c=>{let d=new Image;return d.src=c.image,d}),C()});var it=sn(),P=j(it);let vt;P.__mousemove=ot,P.__mousedown=I,P.__mouseup=W,P.__keydown=[rn,N,u],P.__contextmenu=[on],J(P,c=>i=c,()=>i);var st=z(P,2),Ht=j(st);{var Ft=c=>{Fe(c,{get node_id(){return a(_).id},saveNode:Pt,exitNode:Ut,get nodes(){return a(u).nodes}})};zt(Ht,c=>{a(A)&&c(Ft)})}F(st);var xt=z(st,2);J(tn(xt,{}),c=>D=c,()=>D);var mt=z(xt,2);nn(mt,{undo:qt,redo:Bt});var $t=z(mt,2);je($t,{$$events:{modeChanged:c=>E=c.detail}}),F(it),tt(c=>vt=L(P,1,"bg-neutral-100",null,vt,c),[()=>({"cursor-grabbing":a(g)||a(t)})]),Jt("wheel",P,Rt),H(n,it),rt()}et(["mousemove","mousedown","mouseup","keydown","contextmenu"]);function pn(n){an(n,{})}export{pn as component};
