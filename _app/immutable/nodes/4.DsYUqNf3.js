import"../chunks/CWj6FrbW.js";import{o as ge}from"../chunks/a7uudO9m.js";import{P as te,f as L,c as k,s as m,r as S,t as j,b as D,Q as oe,a as Q,R as O,T as q,g as a,d as g,$ as Y}from"../chunks/CdiwDntd.js";import{d as ae,r as R,h as ve,e as X}from"../chunks/CMfIiZwR.js";import{i as ne}from"../chunks/C8ykwlrY.js";import{s as y,b as A,V as x,a as $,C as we,g as E,c as xe,f as be,d as _e}from"../chunks/DBmJ4lvL.js";import{b as ee}from"../chunks/BLMSFg2n.js";import{a as I}from"../chunks/59QRH0I1.js";import{p as ye}from"../chunks/B9DqHxAG.js";var ke=L('<textarea rows="1" readonly="" placeholder="Node Name" class="font-mono text-lg bg-neutral-800 text-white rounded-xl p-2 pl-3 placeholder:text-neutral-400 resize-none overflow-scroll"></textarea> <textarea rows="5" readonly="" placeholder="Node Description" class="font-mono text-lg bg-neutral-800 text-white rounded-xl p-2 pl-3 placeholder:text-neutral-400 resize-none overflow-scroll focus:outline-none"></textarea>',1),Se=L('<textarea rows="1" readonly="" placeholder="Link Name" class="font-mono text-lg bg-neutral-800 text-white rounded-xl p-2 pl-3 placeholder:text-neutral-400 resize-none overflow-scroll"></textarea> <textarea rows="5" readonly="" placeholder="Link Description" class="font-mono text-lg bg-neutral-800 text-white rounded-xl p-2 pl-3 placeholder:text-neutral-400 resize-none overflow-scroll focus:outline-none"></textarea>',1),De=(v,c)=>c(!1),Le=L('<div class="flex flex-col gap-3.5 max-w-[350px] bg-neutral-950 text-white p-2.5 rounded-xl"><!> <div class="relative inline-block h-fit"><button>Exit</button></div></div>');function Ne(v,c){te(c,!0);let l=ye(c,"open",15);var u=Le(),f=k(u);{var G=p=>{var t=ke(),i=Q(t);R(i);var d=m(i,2);R(d),j(()=>{I(i,c.node.name),I(d,c.node.description)}),D(p,t)},z=p=>{var t=Se(),i=Q(t);R(i);var d=m(i,2);R(d),j(()=>{I(i,c.node.name),I(d,c.node.description)}),D(p,t)};ne(f,p=>{c.node.from===void 0?p(G):p(z,!1)})}var w=m(f,2),b=k(w);b.__click=[De,l],S(w),S(u),j(()=>y(b,1,`${A} float-right`)),D(v,u),oe()}ae(["click"]);const Pe=(v,c)=>{g(c,!1)};var Ce=L(`<style>body {
            overflow-y: hidden;
        }</style>`),Me=v=>v.preventDefault(),Oe=L('<div id="canvas-box" class="relative inline-block overflow-hidden"><canvas tabindex="0"></canvas> <div class="absolute w-fit h-fit"><!></div> <div class="absolute right-2.5 bottom-2.5"><button aria-label="Save Image">Save Image</button> <button aria-label="Save Graph">Save Graph</button> <button aria-label="Load Graph">Load Graph</button> <input type="file" accept=".json"/></div> <!></div>');function We(v,c){te(c,!0);let l,u=new x(0,0),f=1;const G=.5,z=2;let w=O(!1),b,p,t=O(q({nodes:[{id:0,name:"Node",description:"",image:"",position:[200,300]}],links:[]})),i=[],d=q({subset:!0,id:-1}),_=O(!1),N=O(q(new x(0,0)));const B=()=>{const e=l.getContext("2d");if(e===null)throw new Error("DRAW LOOP - ctx is null");l.width=window.innerWidth,l.height=window.innerHeight,e.clearRect(0,0,l.width,l.height),e.setTransform(f,0,0,f,-u.x,-u.y),a(t).links.forEach(o=>{e.beginPath();const s=a(t).nodes.find(r=>r.id===o.from)??a(t).nodes[0],n=a(t).nodes.find(r=>r.id===o.to)??a(t).nodes[0];e.moveTo(s.position[0],s.position[1]),e.lineTo(n.position[0],n.position[1]),e.lineWidth=10,e.strokeStyle="black",e.stroke()}),a(t).nodes.forEach((o,s)=>{const n=x.fromArray(o.position),r=25;e.beginPath(),e.arc(n.x,n.y,20,0,Math.PI*2),e.fillStyle="black",e.fill(),o.image!==""&&e.drawImage(i[s],n.x-r/2,n.y-r/2,r,r)}),requestAnimationFrame(B)},re=e=>{if(e.button===0){const o=E(e,l),s=xe(e,l,u,f);let n=a(t).nodes.find(M=>x.fromArray(M.position).distanceSq(s)<400),r=a(t).links.find(M=>{const me=a(t).nodes[M.from],he=a(t).nodes[M.to];return be(x.fromArray(me.position),x.fromArray(he.position),s)<10});n?(d.subset=!0,d.id=n.id,g(_,!0),g(N,o,!0)):r?(d.subset=!1,d.id=a(t).links.indexOf(r),g(_,!0),g(N,o,!0)):(g(w,!0),b=E(e,l),p=u.clone())}},se=e=>{if(a(w)){const s=E(e,l).clone().subtract(b);u=p.clone().subtract(s)}},le=e=>{e.preventDefault();const o=E(e,l),s=o.clone().add(u).divideScalar(f),n=Math.sign(e.deltaY);f-=n*.125,f=Math.max(G,Math.min(z,f)),u=s.clone().multiplyScalar(f).subtract(o)},ie=e=>{e.ctrlKey&&(e.key==="o"&&(e.preventDefault(),P.click()),e.key==="s"&&(e.preventDefault(),K()),e.shiftKey&&e.key==="s"&&(e.preventDefault(),Z()))},ce=()=>{if(i.length!==a(t).nodes.length){for(;i.length<a(t).nodes.length;)i.push(new Image);for(;i.length>a(t).nodes.length;)i.pop()}a(t).nodes.forEach((e,o)=>{i[o].src=e.image})},de=e=>{const o=e.target;if(!o.files||o.files.length===0)return;const s=o.files[0],n=new FileReader;n.onload=()=>{if(typeof n.result=="string")try{const r=JSON.parse(n.result);if(!r.nodes||!r.links)throw new Error("Invalid graph data");g(t,_e(r),!0),ce()}catch(r){alert("Failed to load graph: "+r.message)}},n.readAsText(s)},K=()=>{if(window.confirm("Download new JSON?")){const e=JSON.stringify(a(t),null,4),o=new Blob([e],{type:"application/json"}),s=URL.createObjectURL(o),n=document.createElement("a");n.href=s,n.download="graph.json",n.click(),URL.revokeObjectURL(s)}},Z=()=>{if(window.confirm("Download image? It will look as your canvas does now.")){const e=document.createElement("a");e.href=l.toDataURL("image/png"),e.download="graph.png",e.click()}};let P;ge(()=>{B()});var T=Oe();ve(e=>{var o=Ce();Y.title="Graph Viewer",D(e,o)}),X("keydown",Y,ie);var h=k(T);let H;h.__mousemove=se,h.__mousedown=re,h.__mouseup=[Pe,w],h.__contextmenu=[Me],ee(h,e=>l=e,()=>l);var C=m(h,2),ue=k(C);{var fe=e=>{Ne(e,{get node(){return(d.subset?a(t).nodes:a(t).links)[d.id]},get open(){return a(_)},set open(o){g(_,o,!0)}})};ne(ue,e=>{a(_)&&e(fe)})}S(C);var U=m(C,2),W=k(U);W.__click=Z;var V=m(W,2);V.__click=K;var F=m(V,2);F.__click=e=>P.click();var J=m(F,2);J.__change=de,$(J,"",{},{display:"none"}),ee(J,e=>P=e,()=>P),S(U);var pe=m(U,2);we(pe,{mode:-1,controls:{"Left Click (on graph)":"view node/link info","Left Click and Drag":"move viewport","Scroll Wheel":"zoom in and out","Ctrl-O":"open graph","Ctrl-S":"save graph","Ctrl-Shift-S":"save graph as image"}}),S(T),j(e=>{H=y(h,1,"bg-neutral-100",null,H,e),$(C,`left: ${a(N).x??""}px; top: ${a(N).y??""}px;`),y(W,1,A),y(V,1,A),y(F,1,A)},[()=>({"cursor-grabbing":a(w)})]),X("wheel",h,le),D(v,T),oe()}ae(["mousemove","mousedown","mouseup","contextmenu","click","change"]);export{We as component};
