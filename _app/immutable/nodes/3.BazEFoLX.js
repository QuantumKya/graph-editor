import"../chunks/CWj6FrbW.js";import{o as oe}from"../chunks/DsjGDbIo.js";import{as as Je,h as Ze,R as qe,P as He,p as Y,k as E,l as q,f as M,c as j,s as y,g as t,d as b,r as O,b as D,n as K,t as ee,a6 as Ee,ai as Ye,a as Ke,at as Se,au as Qe}from"../chunks/BeWt66ZE.js";import{l as Xe,d as Z,g as $e,h as et,e as tt}from"../chunks/9tEt_Nny.js";import{i as H}from"../chunks/CKogC_md.js";import{b as A,s as Ne,e as ot,i as nt,d as at,V as B,C as rt,g as Le,f as it,a as se,c as $}from"../chunks/D3AxRAeF.js";import{b as W}from"../chunks/D_Y7g2-O.js";import{r as De,s as te}from"../chunks/DGEL4HPb.js";import{b as Ie}from"../chunks/Df33kf_W.js";function ue(r,f,p=f){var i=Je();Xe(r,"input",a=>{var u=a?r.defaultValue:r.value;if(u=de(r)?ce(u):u,p(u),i&&u!==(u=f())){var _=r.selectionStart,g=r.selectionEnd;r.value=u??"",g!==null&&(r.selectionStart=_,r.selectionEnd=Math.min(g,r.value.length))}}),(Ze&&r.defaultValue!==r.value||qe(f)==null&&r.value)&&p(de(r)?ce(r.value):r.value),He(()=>{var a=f();de(r)&&a===ce(r.value)||r.type==="date"&&!a&&!r.value||a!==r.value&&(r.value=a??"")})}function de(r){var f=r.type;return f==="number"||f==="range"}function ce(r){return r===""?null:+r}var lt=M('<img alt="Uploaded Icon" class="rounded-lg w-[150px]"/>'),st=M('<img alt="Uploaded Icon" class="rounded-lg w-[150px]"/>'),dt=M('<div class="flex flex-col gap-3.5 max-w-[350px] h-fit bg-neutral-950 text-white p-2.5 rounded-xl"><input type="text" placeholder="Node Title"/> <!> <button>Upload Image</button> <input type="file" accept="image/*"/> <div class="relative inline-block h-fit"><button>Save</button> <button>Exit</button></div></div>');function ct(r,f){Y(f,!0);let p=E(q(f.node.name)),i=E(q(f.node.image)),a,u,_=!1,g=!1;oe(()=>{u.value=f.node.name});const N=()=>{_=!0},G="bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700",R="font-mono text-lg bg-neutral-800 text-white rounded-xl p-2 pl-3 transition duration-300 focus:bg-gray-700 focus:ring-2 focus:ring-blue-500 outline-none";var x=dt(),h=j(x);De(h),A(h,1,R),h.__change=N,W(h,k=>u=k,()=>u);var n=y(h,2);{var w=k=>{var L=lt();ee(()=>te(L,"src",t(i))),D(k,L)},v=k=>{var L=st();ee(()=>te(L,"src",`${Ie??""}/landscape-placeholder.svg`)),D(k,L)};H(n,k=>{t(i)!=""?k(w):k(v,!1)})}var m=y(n,2);A(m,1,G),m.__click=k=>{a.click()};var s=y(m,2);s.__change=k=>{const L=k.target;if(!L.files||L.files.length===0)return;const F=L.files[0],I=new FileReader;I.onload=()=>{typeof I.result=="string"&&b(i,I.result,!0)},I.readAsDataURL(F),N()},Ne(s,"",{},{display:"none"}),W(s,k=>a=k,()=>a);var S=y(s,2),C=j(S);A(C,1,"bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700 float-left"),C.__click=()=>{g=f.saveNode(f.node,t(p),t(i))};var J=y(C,2);A(J,1,"bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700 float-right"),J.__click=()=>f.exitNode(g,_),O(S),O(x),ue(h,()=>t(p),k=>b(p,k)),D(r,x),K()}Z(["change","click"]);var ut=M('<div class="w-[5px] bg-neutral-300 rounded-full m-3"></div>'),ft=M("<button><img/></button>"),gt=M('<div class="flex absolute rounded-xl bg-neutral-200 border-blue-300 border-2 p-[10px] pt-[5px] pb-[5px] h-fit bottom-6 left-[50%] transform -translate-[50%]"></div>');function vt(r,f){Y(f,!0);let p=E(2),i=["node_add.png","node_edit.png","node_drag.png","","link_add.png","link_edit.png"];Ee(()=>{f.modeChanged(t(p))});var a=gt();ot(a,21,()=>i,nt,(u,_,g)=>{var N=Ye(),G=Ke(N);{var R=h=>{var n=ut();D(h,n)},x=h=>{var n=ft();n.__click=()=>b(p,g-i.slice(0,g).filter(v=>v==="").length);var w=j(n);O(n),ee((v,m,s)=>{A(n,1,`p-2.5 rounded-xl border-none outline-none transition duration-200 hover:bg-blue-300 ${v??""}`),te(w,"src",`${Ie??""}/mode_icons/${t(_)??""}`),te(w,"alt",m),A(w,1,s)},[()=>t(p)===g-i.slice(0,g).filter(v=>v==="").length?"bg-gray-500 mt-auto mb-auto":"mt-[10px] mb-[10px]",()=>i[g].split(".")[0],()=>at(t(p)===g-i.slice(0,g).filter(v=>v==="").length?"max-w-[40px] rounded-xl":"max-w-[30px] rounded-lg")]),D(h,n)};H(G,h=>{t(_)===""?h(R):h(x,!1)})}D(u,N)}),O(a),D(r,a),K()}Z(["click"]);var pt=M('<button aria-label="Close Menu"><i class="fa-solid fa-chevron-down"></i></button>'),bt=M('<button aria-label="Open Menu"><i class="fa-solid fa-chevron-up"></i></button>'),mt=M(`<div class="absolute bottom-1 left-1 transition duration-200"><!> <div class="flex flex-col gap-0 w-fit p-1 rounded-xl font-mono text-blue-300 bg-gray-700"><p class="text-center">------------------ Edit Log ------------------</p> <textarea class="resize-none overflow-y-scroll text-wrap outline-none" readonly="" cols="48" rows="8">
        </textarea></div></div>`);function ht(r,f){Y(f,!0);let p=q([]),i,a=E(0),u=q([]),_=E(!0),g;const N=(s,S)=>{t(a)>0&&(p.splice(-t(a),t(a)),b(a,0)),u.push(s),p.push(S===void 0?s:s+`:
	`+S)},G=()=>{t(a)>u.length-1||(Se(a),p.push("Undo: "+u.at(-t(a))))},R=()=>{t(a)<1||(p.push("Redo: "+u.at(-t(a))),Se(a,-1))};Ee(()=>{i.value+=`
`+p.at(-1),i.scrollTop=i.scrollHeight}),oe(()=>{i.value=""});var x=mt(),h=j(x);{var n=s=>{var S=pt();S.__click=C=>{b(_,!1),g.style.bottom="-225px"},D(s,S)},w=s=>{var S=bt();S.__click=C=>{b(_,!0),g.style.bottom="4px"},D(s,S)};H(h,s=>{t(_)?s(n):s(w,!1)})}var v=y(h,2),m=y(j(v),2);return W(m,s=>i=s,()=>i),O(v),O(x),W(x,s=>g=s,()=>g),D(r,x),K({log:N,undo:G,redo:R})}Z(["click"]);var xt=M('<div class="flex flex-row gap-3 w-min h-min p-3 absolute top-1 left-1 text-2xl "><button aria-label="Undo"><i class="fas fa-undo"></i></button> <button aria-label="Redo"><i class="fas fa-redo"></i></button></div>');function _t(r,f){const p="border-none rounded-full w-fit h-fit bg-gray-300 p-2 pt-0.5 pb-1 text-center";var i=xt(),a=j(i);A(a,1,p),a.__click=function(..._){var g;(g=f.undo)==null||g.apply(this,_)};var u=y(a,2);A(u,1,p),u.__click=function(..._){var g;(g=f.redo)==null||g.apply(this,_)},O(i),D(r,i)}Z(["click"]);var wt=M('<div class="flex flex-col gap-3.5 max-w-[350px] h-fit bg-neutral-950 text-white p-2.5 rounded-xl"><input type="text" placeholder="Link Title"/> <textarea rows="6" maxlength="400" placeholder="Link Description"></textarea> <div class="relative inline-block h-fit"><button>Save</button> <button>Exit</button></div></div>');function yt(r,f){Y(f,!0);let p=E(""),i=E(""),a,u,_=!1,g=!1;oe(()=>{a.value=f.link.name,u.value=f.link.description});const N=()=>{g=!0},G="font-mono text-lg bg-neutral-800 text-white rounded-xl p-2 pl-3 transition duration-300 focus:bg-gray-700 focus:ring-2 focus:ring-blue-500 outline-none";var R=wt(),x=j(R);De(x),A(x,1,G),x.__change=N,W(x,m=>a=m,()=>a);var h=y(x,2);$e(h),A(h,1,"font-mono text-lg bg-neutral-800 text-white rounded-xl p-2 pl-3 transition duration-300 focus:bg-gray-700 focus:ring-2 focus:ring-blue-500 outline-none placeholder:text-neutral-400 resize-none overflow-scroll"),h.__change=N,W(h,m=>u=m,()=>u);var n=y(h,2),w=j(n);A(w,1,"bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700 float-left"),w.__click=()=>{_=f.saveLink(f.link,t(p),t(i))};var v=y(w,2);A(v,1,"bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700 float-right"),v.__click=()=>f.exitLink(_,g),O(n),O(R),ue(x,()=>t(p),m=>b(p,m)),ue(h,()=>t(i),m=>b(i,m)),D(r,R),K()}Z(["change","click"]);var kt=M(`<style>body {
            overflow-y: hidden;
        }</style>`),St=r=>r.preventDefault(),Lt=M('<div id="canvas-box" class="relative inline-block overflow-hidden"><canvas tabindex="0"></canvas> <div class="absolute right-2.5 bottom-15"><!></div> <div class="absolute right-2.5 bottom-2.5"><button class="bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700" aria-label="Save Image">Save Image</button> <button class="bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700" aria-label="Save Graph">Save Graph</button> <button class="bg-neutral-800 text-white border-blue-500 text-center rounded-xl border-2 w-fit p-2 pt-1 transition duration-200 hover:bg-gray-700" aria-label="Load Graph">Load Graph</button> <input type="file" accept=".json"/></div> <!> <!> <!> <!></div>');function Ut(r,f){Y(f,!0);const p=()=>{const e=w.at(-v)??t(n);if(b(n,$(e),!0),m.length!==t(n).nodes.length){for(;m.length<t(n).nodes.length;)m.push(new Image);for(;m.length>t(n).nodes.length;)m.pop()}t(n).nodes.forEach((l,d)=>{m[d].src=l.image});const o=t(n).nodes.findIndex(l=>l.id===t(s));o?b(s,o,!0):b(s,0)};let i,a=new B(0,0),u=1;const _=.5,g=2;let N=E(!1),G,R,x,h=new B(0,0),n=E(q({nodes:[{id:0,name:"Node",image:"",position:[200,300]}],links:[]})),w=[{nodes:[{id:0,name:"Node",image:"",position:[200,300]}],links:[]}],v=1,m=[],s=E(0),S=E(!1),C=E(!1),J=E(0),k=E(!1),L,F=E(!1),I=E(0),P;const fe=()=>{const e=i.getContext("2d");if(e===null)throw new Error("DRAW LOOP - ctx is null");i.width=window.innerWidth,i.height=window.innerHeight,e.clearRect(0,0,i.width,i.height),e.setTransform(u,0,0,u,-a.x,-a.y),t(F)&&(e.beginPath(),e.moveTo(t(n).nodes[t(s)].position[0],t(n).nodes[t(s)].position[1]),e.lineTo(x.x,x.y),e.lineWidth=10,e.strokeStyle="rgba(0, 0, 0, 0.35)",e.stroke()),t(n).links.forEach(o=>{e.beginPath();const l=t(n).nodes.find(c=>c.id===o.from)??t(n).nodes[0],d=t(n).nodes.find(c=>c.id===o.to)??t(n).nodes[0];e.moveTo(l.position[0],l.position[1]),e.lineTo(d.position[0],d.position[1]),e.lineWidth=10,e.strokeStyle="black",e.stroke()}),t(n).nodes.forEach((o,l)=>{const d=B.fromArray(o.position),c=25;e.beginPath(),e.arc(d.x,d.y,20,0,Math.PI*2),e.fillStyle="black",e.fill(),e.drawImage(m[l],d.x-c/2,d.y-c/2,c,c)}),requestAnimationFrame(fe)},Ae=e=>{if(t(C))return;const o=Le(e,i,a,u);let l=t(n).nodes.find(c=>B.fromArray(c.position).distanceSq(o)<400);l&&b(s,l.id,!0);let d=t(n).links.find(c=>{const T=t(n).nodes[c.from],U=t(n).nodes[c.to];return it(B.fromArray(T.position),B.fromArray(U.position),o)<10});if(d&&b(J,t(n).links.indexOf(d),!0),e.button===0){if(t(I)===0){if(!l)t(n).nodes.push({id:-1,name:"",image:"",position:o.toArray()}),ne(),m.push(new Image),V(),P.log("Create node");else if(window.confirm("Delete node and its links?")){const c=l.id;t(n).nodes.splice(c,1),b(s,0),m.splice(c,1);let T=[];t(n).links.forEach((U,X)=>{(U.from===c||U.to===c)&&T.push(X)});for(const U of T)t(n).links.splice(U,1);ne(),V(),P.log("Delete node",`Node ID: ${c}, ${T.length} links destroyed`)}}else if(t(I)===1){if(!l)return;b(C,!0)}else if(t(I)===2){if(!l)return;h=o.clone().subtract(B.fromArray(t(n).nodes[t(s)].position)),b(S,!0)}else if(t(I)===3)if(l)if(t(F)){if(L.id===t(s)||t(n).links.filter(c=>c.from===L.id&&c.to===t(s)||c.from===t(s)&&c.to===L.id).length!==0)return;t(n).links.push({from:L.id,to:t(s),name:"",description:""}),b(F,!1),V(),P.log("Create link",`node ${L.id} -> ${t(s)}`)}else L=l,b(F,!0),x=o;else{if(!d)return;t(n).links.splice(t(J),1),V(),P.log("Delete link",`node ${L.id} -> ${t(s)}`)}else if(t(I)===4){if(!d)return;b(k,!0)}}e.button===2&&(b(N,!0),G=se(e,i),R=a.clone())},Me=e=>{if(t(C))return;const o=Le(e,i,a,u);if(x=o,t(S)){let l=t(n).nodes.find(d=>d.id===t(s));if(!l)throw new Error("uhhh focusNode error, it's not in the list...");l.position=o.clone().subtract(h).toArray()}else if(t(N)){const d=se(e,i).clone().subtract(G);a=R.clone().subtract(d)}},Re=e=>{t(C)||(t(S)&&(b(S,!1),V(),P.log("Set node position")),b(N,!1))},Ce=e=>{e.preventDefault();const o=se(e,i),l=o.clone().add(a).divideScalar(u),d=Math.sign(e.deltaY);u-=d*.125,u=Math.max(_,Math.min(g,u)),a=l.clone().multiplyScalar(u).subtract(o)},Pe=e=>{e.key==="Escape"&&t(F)&&b(F,!1),e.ctrlKey&&(e.key==="o"&&(e.preventDefault(),Q.click()),e.key==="s"&&(e.preventDefault(),pe()),e.key==="z"&&ge(),e.key==="y"&&ve())},Ue=(e,o,l)=>{let d=[e.name===o?"":"name",e.image===l?"":"image"],c=[];d.forEach(X=>{X!==""&&c.push(X)});const T=c.join(", ");if(T===""||!window.confirm("Save this node with new contents?"))return!1;e.name=o,e.image=l;const U=t(n).nodes.indexOf(e);return U!==-1&&(m[U].src=e.image),V(),P.log("Update node contents",T),!0},Oe=(e,o)=>{!e&&o&&!window.confirm("Stop editing without saving?")||b(C,!1)},Te=(e,o,l)=>{let d=[e.name===o?"":"name",e.description===l?"":"description"],c=[];d.forEach(U=>{U!==""&&c.push(U)});const T=c.join(", ");return T===""||!window.confirm("Save this node with new contents?")?!1:(e.name=o,e.description=l,V(),P.log("Update node contents",T),!0)},je=(e,o)=>{!e&&o&&!window.confirm("Stop editing without saving?")||b(k,!1)},V=()=>{v>1&&(w.splice(-v+1,v-1),v=1),w.push($(t(n))),console.log(w),console.log(v)},ge=()=>{v>w.length-1||(v++,p(),P.undo(),console.log(w),console.log(v))},ve=()=>{v<2||(v--,p(),P.redo(),console.log(w),console.log(v))},Ge=e=>{const o=e.target;if(!o.files||o.files.length===0)return;const l=o.files[0],d=new FileReader;d.onload=()=>{if(typeof d.result=="string")try{const c=JSON.parse(d.result);if(!c.nodes||!c.links)throw new Error("Invalid graph data");b(n,$(c),!0),ne(),v=1,w=[$(t(n))],p(),P.log("Load new graph data")}catch(c){alert("Failed to load graph: "+c.message)}},d.readAsText(l)},pe=()=>{if(window.confirm("Download new JSON?")){const e=JSON.stringify(t(n),null,4),o=new Blob([e],{type:"application/json"}),l=URL.createObjectURL(o),d=document.createElement("a");d.href=l,d.download="graph.json",d.click(),URL.revokeObjectURL(l)}},We=()=>{if(window.confirm("Download image? It will look as your canvas does now.")){const e=document.createElement("a");e.href=i.toDataURL("image/png"),e.download="graph.png",e.click()}};let Q,be;const ne=()=>{const e=new Map(t(n).nodes.map((o,l)=>[o.id,l]));t(n).nodes.forEach((o,l)=>o.id=l),t(n).links.forEach(o=>{console.log(`${o.from}, ${o.to}`),o.from=e.get(o.from)??o.from,o.to=e.get(o.to)??o.to,console.log(`${o.from}, ${o.to}`)})};oe(()=>{m=t(n).nodes.map(e=>{let o=new Image;return o.src=e.image,o}),fe()});var ae=Lt();et(e=>{var o=kt();Qe.title="Graph Editor",D(e,o)});var z=j(ae);let me;z.__mousemove=Me,z.__mousedown=Ae,z.__mouseup=Re,z.__keydown=Pe,z.__contextmenu=[St],W(z,e=>i=e,()=>i);var re=y(z,2),ze=j(re);{var Fe=e=>{ct(e,{get node(){return t(n).nodes[t(s)]},saveNode:Ue,exitNode:Oe})},Ve=(e,o)=>{{var l=d=>{yt(d,{get link(){return t(n).links[t(J)]},saveLink:Te,exitLink:je})};H(e,d=>{t(k)&&d(l)},o)}};H(ze,e=>{t(C)?e(Fe):e(Ve,!1)})}O(re);var ie=y(re,2),he=j(ie);he.__click=We;var xe=y(he,2);xe.__click=pe;var _e=y(xe,2);_e.__click=e=>Q.click();var le=y(_e,2);le.__change=Ge,Ne(le,"",{},{display:"none"}),W(le,e=>Q=e,()=>Q),O(ie);var we=y(ie,2);W(ht(we,{}),e=>P=e,()=>P);var ye=y(we,2);_t(ye,{undo:ge,redo:ve});var ke=y(ye,2);W(vt(ke,{modeChanged:e=>b(I,e,!0)}),e=>be=e,()=>be);var Be=y(ke,2);rt(Be,{controls:{"Right Click and Drag":"move viewport","Scroll Wheel":"zoom in and out","Ctrl-Z":"undo","Ctrl-Y":"redo","Ctrl-S":"save","Ctrl-O":"open"},get mode(){return t(I)},set mode(e){b(I,e,!0)}}),O(ae),ee(e=>me=A(z,1,"bg-neutral-100",null,me,e),[()=>({"cursor-grabbing":t(S)||t(N)})]),tt("wheel",z,Ce),D(r,ae),K()}Z(["mousemove","mousedown","mouseup","keydown","contextmenu","click","change"]);export{Ut as component};
